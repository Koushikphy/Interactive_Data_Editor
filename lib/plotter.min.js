var figurecontainer=document.getElementById("figurecontainer"),data=[],cols=[0,1,2],ldata=[],lIniData=[],ranges=[],swapped=!1,newCol=[0,0,0],curCol=!1;zCols=[];const Plotly=require("plotly.js-gl3d-dist"),fs=require("fs"),{ipcRenderer:ipcRenderer,remote:remote,shell:shell,Menu:Menu}=require("electron"),path=require("path"),{dialog:dialog}=remote;ipcRenderer.on("checkClose",function(e,o){ipcRenderer.send("checkClose","closeIt")}),$("#imRes").val("1500x2000");var trace={type:"surface",hoverinfo:"x+y+z",colorscale:"Portland",opacity:1,name:"surface",hoverlabel:{bgcolor:"#2ca02c"},z:[[1]],x:[[1]],y:[[1]],showscale:!1,cmin:0,cmax:0,cauto:!0,colorbar:{thickness:30,dtick:0,len:0,x:1.02,xpad:10,y:1.02,ypad:10,tickfont:{family:"Times New Roman",size:20}},contours:{x:{show:!1,start:0,end:0,size:1,color:"#000",usecolormap:!1,width:1},y:{show:!1,start:0,end:0,size:1,color:"#000",usecolormap:!1,width:1},z:{show:!1,start:0,end:0,size:0,color:"#000",usecolormap:!1,width:1}}},layout={height:window.innerHeight,width:window.innerWidth,margin:{t:0,r:0,b:0,l:0,pad:0},autorange:!0,spikesides:!1,showlegend:!0,autosize:!0,scene:{aspectmode:"manual",aspectratio:{x:1,y:1,z:1},zaxis:{range:["",""],autorange:!0,spikesides:!1,showgrid:!0,zeroline:!1,showline:!0,title:"",titlefont:{family:"Times New Roman",size:10},dtick:0,tickfont:{family:"Times New Roman",size:15},ticklen:2,tickwidth:1,tickcolor:"#000",ticksuffix:"",tickprefix:"",tickformat:"",ticks:"outside"},yaxis:{range:[],autorange:!0,spikesides:!1,showgrid:!0,zeroline:!1,showline:!0,automargin:!0,title:"",titlefont:{family:"Times New Roman",size:10},dtick:0,tickfont:{family:"Times New Roman",size:15},ticklen:2,tickwidth:1,tickcolor:"#000",ticksuffix:"",tickprefix:"",tickformat:"",ticks:"outside"},xaxis:{range:[],autorange:!0,spikesides:!1,showgrid:!0,zeroline:!1,showline:!0,title:"",titlefont:{family:"Times New Roman",size:10},dtick:0,tickfont:{family:"Times New Roman",size:15},ticklen:2,tickwidth:1,tickcolor:"#000",ticksuffix:"",tickprefix:"",tickformat:"",ticks:"outside"}}},mode={displaylogo:!1,modeBarButtonsToRemove:["toImage","sendDataToCloud"],modeBarButtonsToAdd:[[{name:"Save the image",icon:Plotly.Icons.camera,click:function(){$("#download").show()}}]]};function transpose(e){return e[0].map((o,t)=>e.map(e=>e[t]))}function fileLoader(){const e=dialog.showOpenDialog({properties:["openFile"]})[0];path.dirname(e);var o=path.basename(e),t=fs.readFileSync(e,"utf8");t=t.trim().split(/\t\t\t\t\t|\n\n/),col=t[0].trim().split("\n")[0].trim().split(/[\s\t]+/).length,data=[...Array(col)].map(e=>Array());for(var n=0;n<t.length;n++){blocks=t[n].trim().split("\n");for(var a=0;a<blocks.length;a++)blocks[a]=blocks[a].trim().split(/[\s\t]+/);blocks=transpose(blocks);for(var i=0;i<col;i++)data[i].push(blocks[i])}var r="";for(n=1;n<=col;n++)r+="<option>"+n+"</option>";var s=$("#colSel select");for(n=0;n<s.length;n++)s[n].innerHTML=r,s[n].selectedIndex=n;for(n=0;n<col;++n){let e=[].concat(...data[n]);ranges.push([Math.min(...e),Math.max(...e)])}$("#file_name1").html(o),$("#trace")[0].innerHTML="<option>1</option>",$("#trace")[0].selectedIndex=0,zCols.push(2),updateThisPlot()}function addNewPlot(){var e=figurecontainer.data.length,o="";for(let t=1;t<=e+1;t++)o+="<option>"+t+"</option>";document.getElementById("trace").innerHTML=o,document.getElementById("trace").selectedIndex=e,Plotly.addTraces(figurecontainer,trace),updateThisPlot()}function updateThisPlot(){var e=$("#trace")[0].selectedIndex;a=$("#zcol")[0].selectedIndex,b=$("#ycol")[0].selectedIndex,c=$("#xcol")[0].selectedIndex,zCols[e]=a,Plotly.restyle(figurecontainer,{x:[data[c]],y:[data[b]],z:[data[a]]},e)}function traceUpdate(){var e=$("#trace")[0].selectedIndex;$("#zcol")[0].selectedIndex=zCols[e]}function deleteTrace(){var e=$("#trace")[0].selectedIndex;zCols.splice(e,1),zCols.length?(Plotly.deleteTraces(figurecontainer,e),$("#trace")[0].selectedIndex=0,$("#zcol")[0].selectedIndex=zCols[0]):console.log("reload")}function getRange(e,o){var t,n;return e=e.split(",").map(e=>parseFloat(e)),[t,n]=o,isNaN(e[0])&&(e[0]=t),isNaN(e[1])&&(e[1]=n),cmin=Math.max(e[0],t),cmax=Math.min(e[1],n),[e,[cmin,cmax]]}function setXRange(e){if(""!=e){var o=$("#xcol")[0].selectedIndex+1,t=ranges[o],[e,[n,a]]=getRange(e,t);console.log(e),Plotly.relayout(figurecontainer,{"scene.xaxis.range":e})}else Plotly.relayout(figurecontainer,{"scene.xaxis.autorange":!0})}function setYRange(e){if(""!=e){var o=$("#xcol")[0].selectedIndex+1,t=ranges[o],[e,[n,a]]=getRange(e,t);Plotly.relayout(figurecontainer,{"scene.yaxis.range":e})}else Plotly.relayout(figurecontainer,{"scene.yaxis.autorange":!0})}function setZRange(e){if(""!=e){var o=[],t=[];for(let e of zCols)o.push(ranges[e][0]),t.push(ranges[e][1]);var n=[Math.min(...o),Math.max(...t)];console.log(n);var[e,[a,i]]=getRange(e,n);Plotly.relayout(figurecontainer,{"scene.zaxis.range":e}),Plotly.restyle(figurecontainer,{cmin:a,cmax:i})}else Plotly.relayout(figurecontainer,{"scene.zaxis.autorange":!0})}function downloadImage(){var e=$("#dfileName").val(),o=$("#fileFormat").val().toLocaleLowerCase(),t=$("#imRes").val().split("x");Plotly.downloadImage(figurecontainer,{filename:e,format:o,width:t[1],height:t[0]}),$("#download").hide()}function triggerDownload(){$("#download").show()}Plotly.newPlot(figurecontainer,[trace],layout,mode),figurecontainer.on("plotly_relayout",updateJSON);var minWidth=window.innerWidth/3;$("#split-bar").mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){e.preventDefault();var o=e.pageX-$("#sidebar").offset().left;o>minWidth/5&&o<window.innerWidth/2.5&&($("#sidebar").css("width",o-2),$("#full").css("margin-left",o),minWidth=o)})}),$("#split-bar2").mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){e.preventDefault();var o=e.pageX-$("#sidebar2").offset().left;o>minWidth/5&&o<window.innerWidth/2.5&&($("#sidebar2").css("width",o-2),$("#full").css("margin-left",o),$("#jsoneditor").css("width",o-7),minWidth=o)})}),$(document).mouseup(function(e){$(document).unbind("mousemove")});minWidth=window.innerWidth/4.5;function openNav(){$("#split-bar2").css("width",5),$("#sidebar2").css("width",minWidth),$("#jsoneditor").css("width",minWidth-5),$(".floatdiv").css("margin-left",minWidth+15),$("#figurecontainer").css("margin-left",minWidth+15),$(".basediv").css("margin-left",minWidth+6)}function closeNav(){$("#split-bar2").css("width",0),$("#sidebar2").css("width",0),$(".floatdiv").css("margin-left",10),$(".basediv").css("margin-left",0),$("#jsoneditor").css("width",195),$(".ham").toggle()}$("#split-bar2").mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){e.preventDefault();var o=e.pageX-$("#sidebar2").offset().left;o>minWidth/5&&o<window.innerWidth/2.5&&($("#sidebar2").css("width",o-2),$(".floatdiv").css("margin-left",o+10),$(".basediv").css("margin-left",o),$("#jsoneditor").css("width",o-7),minWidth=o)})}),$(document).mouseup(function(e){$(document).unbind("mousemove")});var typeList=["Arial","Balto","Courier New","Droid Sans",,"Droid Serif","Droid Sans Mono","Gravitas One","Old Standard TT","Open Sans","Overpass","PT Sans Narrow","Raleway","Times New Roman"],symList=["circle","circle-open","circle-dot","circle-open-dot","square","square-open","square-dot","square-open-dot","diamond","diamond-open","diamond-dot","diamond-open-dot","cross","cross-open","cross-dot","cross-open-dot","x","x-open","x-dot","x-open-dot","triangle-up","triangle-up-open","triangle-up-dot","triangle-up-open-dot","triangle-down","triangle-down-open","triangle-down-dot","triangle-down-open-dot","triangle-left","triangle-left-open","triangle-left-dot","triangle-left-open-dot","triangle-right","triangle-right-open","triangle-right-dot","triangle-right-open-dot","triangle-ne","triangle-ne-open","triangle-ne-dot","triangle-ne-open-dot","triangle-se","triangle-se-open","triangle-se-dot","triangle-se-open-dot","triangle-sw","triangle-sw-open","triangle-sw-dot","triangle-sw-open-dot","triangle-nw","triangle-nw-open","triangle-nw-dot","triangle-nw-open-dot","pentagon","pentagon-open","pentagon-dot","pentagon-open-dot","hexagon","hexagon-open","hexagon-dot","hexagon-open-dot","hexagon2","hexagon2-open","hexagon2-dot","hexagon2-open-dot","octagon","octagon-open","octagon-dot","octagon-open-dot","star","star-open","star-dot","star-open-dot","hexagram","hexagram-open","hexagram-dot","hexagram-open-dot","star-triangle-up","star-triangle-up-open","star-triangle-up-dot","star-triangle-up-open-dot","star-triangle-down","star-triangle-down-open","star-triangle-down-dot","star-triangle-down-open-dot","star-square","star-square-open","star-square-dot","star-square-open-dot","star-diamond","star-diamond-open","star-diamond-dot","star-diamond-open-dot","diamond-tall","diamond-tall-open","diamond-tall-dot","diamond-tall-open-dot","diamond-wide","diamond-wide-open","diamond-wide-dot","diamond-wide-open-dot","hourglass","hourglass-open","bowtie","bowtie-open","circle-cross","circle-cross-open","circle-x","circle-x-open","square-cross","square-cross-open","square-x","square-x-open","diamond-cross","diamond-cross-open","diamond-x","diamond-x-open","cross-thin","cross-thin-open","x-thin","x-thin-open","asterisk","asterisk-open","hash","hash-open","hash-dot","hash-open-dot","y-up","y-up-open","y-down","y-down-open","y-left","y-left-open","y-right","y-right-open","line-ew","line-ew-open","line-ns","line-ns-open","line-ne","line-ne-open","line-nw","line-nw-open"],colorPallete=["Greys","YlGnBu","Greens","YlOrRd","Bluered","RdBu","Reds","Blues","Picnic","Rainbow","Portland","Jet","Hot","Blackbody","Earth","Electric","Viridis","Cividis"],schema={properties:{Surfaces:{items:{properties:{colorscale:{enum:colorPallete},opacity:{type:"number"}}}},Layout:{properties:{height:{type:"number"}}}}},options={onChangeJSON:function(e){var o={hoverinfo:[],colorscale:[],autocolorscale:[],opacity:[],name:[],hoverlabel:[],showscale:[],cmin:[],cmax:[],cauto:[],colorbar:[],contours:[]};for(let t of e.Surfaces)for(let e of Object.keys(o))o[e].push(t[e]);Plotly.update(figurecontainer,o,e.Layout)},onColorPicker:function(e,o,t){new JSONEditor.VanillaPicker({parent:e,color:o,popup:"bottom",onChange:function(e){var o=1===e.rgba[3]?e.hex.substr(0,7):e.hex;t(o)}}).show()},mode:"form",schema:schema},jsoneditor=document.getElementById("jsoneditor"),editor=new JSONEditor(jsoneditor,options,{Surfaces:"",Layout:""});function updateJSON(){var e=[];for(let o of figurecontainer.data){let t=JSON.parse(JSON.stringify(o));delete t.type,delete t.x,delete t.y,delete t.z,e.push(t)}Layout=figurecontainer.layout,editor.update({Surfaces:e,Layout:Layout})}function hotKeys(e){"text"!=document.activeElement.type&&"b"==e.key&&e.ctrlKey&&($("#sidebar2").width()?closeNav():openNav())}$("#jsoneditor").height(window.innerHeight-jsoneditor.offsetTop),ipcRenderer.on("menuTrigger",function(e,o){"topbar"==o?$(".floatdiv").toggle():"open"==o&&fileLoader()}),$(window).keydown(hotKeys);