const fs=require("fs"),path=require("path"),url=require("url");var editorWindow,compFName,undoStack=[],redoStack=[],viewer=[,,],show=!1,saved=!0,firstSave=!0,issame=!1,fullData=[],fullDataCols=[],fileNames=[],saveNames=[],legendNames=[],rangedSelector=0;function updateData(){if(col.x=xCol.selectedIndex,col.y=yCol.selectedIndex,col.z=zCol.selectedIndex,th_in=0,ddd){$slider.slider({max:data.length-1,value:0}),$ch.text(xName+"="+data[0][col.x][0]);var e=[];for(let t of data)e.push(t[col.x][0].toString().length);$ch.width(Math.floor(Math.max(...e)/2+2)*em2px)}else col.z=col.y,col.y=col.x,col.x=0,col2dChanged();if(fullDataCols[0]=JSON.parse(JSON.stringify(col)),updatePlot(1),makeRows(),startDragBehavior(),updateOnServer(),!swapped)if(ddd)localStorage.setItem("cols3d",JSON.stringify(col));else{var t={x:col.y,y:col.z,z:0,s:0};localStorage.setItem("cols2d",JSON.stringify(t))}}function fileLoader(){const e=dialog.showOpenDialog({defaultPath:recentLocation,properties:["openFile"]});void 0!==e&&fileReader(e[0])}function fileReader(e){if(!saved)var t=dialog.showMessageBox({type:"warning",title:"Unsaved data found!!!",message:"There are some modified data, that you haven't saved yet.\n Are you sure to open a new file without saving?",buttons:["Yes","No"]});if(!t&&void 0!=(data=parseData(fs.readFileSync(e,"utf8")))){var a=path.dirname(e),n=path.basename(e,path.extname(e)),o=path.extname(e);if(path.join(a,n+"_new"+o),recentLocation=a,localStorage.setItem("recent",JSON.stringify(recentLocation)),swapped=0,refdat=0,xName="X",issame=!1,firstSave=!0,swapper=!1,undoStack=[],redoStack=[],fullData=[],fullDataCols=[],fileNames=[],saveNames=[],legendNames=[],swapperIsOn=!1,$("#sCol, #sColInp").hide(),$("#particle").remove(),window.pJSDom instanceof Array&&window.pJSDom[0].pJS.fn.vendors.destroypJS(),$("#full").show(),$("#jsoneditor").height(window.innerHeight-jsoneditor.offsetTop),figurecontainer.data.length>2){let e=[];for(let t=1;t<figurecontainer.data.length;t++)e.push(t);Plotly.deleteTraces(figurecontainer,e)}"any"!=figurecontainer.layout.selectdirection&&Plotly.relayout(figurecontainer,{selectdirection:"any"}),xCol=document.getElementById("xCol"),yCol=document.getElementById("yCol"),menu.getMenuItemById("pax").visible=!0,menu.getMenuItemById("pay").visible=!1,menu.getMenuItemById("swapen").visible=!0;for(let e of["pax","wire","surf"])menu.getMenuItemById(e).enabled=!1;ddd=1!=data.length,document.title="Interactive Data Editor - "+replaceWithHome(e);var l,i=["save","saveas","tfd","tfs","spr","swapen","edat","fill","filter","af","arf","rgft"];if(ddd)$(".3D").show(),null!==(l=JSON.parse(localStorage.getItem("cols3d")))&&(col=l),i.splice(i.indexOf("rgft"),1),i.push("pax","wire","surf");else serve=0,$(".3D").hide(),null!==(l=JSON.parse(localStorage.getItem("cols2d")))&&(col=l);for(var s="",r=1;r<=data[0].length;r++)s+="<option>"+r+"</option>";for(let e of $("#xCol, #yCol, #zCol, #sCol"))e.innerHTML=s;for(let e of i)menu.getMenuItemById(e).enabled=!0;xCol.selectedIndex=col.x,yCol.selectedIndex=col.y,zCol.selectedIndex=col.z,sCol.selectedIndex=col.s,fullDataCols.push(JSON.parse(JSON.stringify(col))),fullData.push(data),fileNames.push(e);a=path.dirname(e),n=path.basename(e,path.extname(e)),o=path.extname(e);var d=path.join(a,n+"_new"+o);saveNames.push(d),legendNames.push(path.basename(fileNames[0])+` ${col.y+1}:${col.z+1}`),updateData(),makeEditable(),makeRows(),Plotly.restyle(figurecontainer,{name:legendNames[0]}),recentFiles=recentFiles.filter(t=>t!=e),recentFiles.push(e),recentMenu(),$ch.text(xName+"="+data[th_in][col.x][0]),$("#drag").html((e,t)=>t.replace("Y","X")),resizePlot(),showStatus("Data file loaded ...")}}function selUpdate(){for(var e="",t=1;t<=data[0].length;t++)e+="<option>"+t+"</option>";for(let t of $("#xCol, #yCol, #zCol, #sCol"))t.innerHTML=e;ddd?(xCol.selectedIndex=col.x,yCol.selectedIndex=col.y,zCol.selectedIndex=col.z,sCol.selectedIndex=col.s):(xCol.selectedIndex=col.y,yCol.selectedIndex=col.z,sCol.selectedIndex=col.s)}function addNewFileDialog(){if(swapperIsOn)dialog.showMessageBox({type:"warning",title:"Can't add the file!!!",message:"Plot along X before adding a new file.",buttons:["Ok"]});else{var e=dialog.showOpenDialog({defaultPath:recentLocation,properties:["openFile"]});void 0!==e&&addNewFile(e[0])}}function addNewFile(e){if(void 0!=(data=parseData(fs.readFileSync(e,"utf8"))))if(fullData[0].length==data.length){fullData[0][0].length!=data[0].length&&selUpdate();var t=path.dirname(e),a=path.basename(e,path.extname(e)),n=path.extname(e),o=path.join(t,a+"_new"+n);data[0].length;fullData.unshift(data),fullDataCols.unshift(JSON.parse(JSON.stringify(col))),fileNames.unshift(e),saveNames.unshift(o),legendNames.unshift(path.basename(fileNames[0])+` ${fullDataCols[0].y+1}:${fullDataCols[0].z+1}`),addTrace(),document.title="Interactive Data Editor - "+replaceWithHome(e),recentFiles=recentFiles.filter(t=>t!=e),recentFiles.push(e),recentMenu()}else dialog.showMessageBox({type:"warning",title:"Can't add the file!!!",message:"Trying to open a file with different grid.\nThis is not supported for 3D data.",buttons:["Ok"]})}function addTrace(){figurecontainer.data.length;let e=JSON.parse(JSON.stringify(iniPointsC));e.name=legendNames[0],e.x=fullData[0][th_in][fullDataCols[0].y],e.y=fullData[0][th_in][fullDataCols[0].z],Plotly.addTraces(figurecontainer,e,0),marker=[{symbol:"circle-dot",color:"#b00",size:6,opacity:1}],line=[{width:2,color:"#1e77b4",dash:0,shape:"linear"}];for(let e=1;e<figurecontainer.data.length;e++)marker.push({symbol:"circle-dot",color:colorList[e%9],size:6,opacity:1}),line.push({width:2,color:colorList[e%9],dash:0,shape:"linear"});col=fullDataCols[0],Plotly.restyle(figurecontainer,{line:line,marker:marker}),makeRows(),makeEditable(),firstSave=!0,undoStack=[],redoStack=[]}function updatePlot(e=!0){dpsy=data[th_in][col.z];var t=[dpsx=data[th_in][col.y]],a=[dpsy],n=[legendNames[0]];if(swapperIsOn)Plotly.restyle(figurecontainer,{x:[data[th_in][col.y],data[th_in][col.y]],y:[data[th_in][col.z],data[th_in][col.s]]});else if(e){for(let e=1;e<fullData.length;e++)t.push(fullData[e][th_in][fullDataCols[e].y]),a.push(fullData[e][th_in][fullDataCols[e].z]),n.push(legendNames[e]);Plotly.restyle(figurecontainer,{x:t,y:a,name:n})}else Plotly.restyle(figurecontainer,{x:t,y:a,name:n},0);for(var o=0;o<dpsx.length;o++)points[o].handle={x:dpsx[o],y:dpsy[o]}}function selectEditable(e){if(swapperIsOn)[col.s,col.z]=[col.z,col.s],sCol.selectedIndex=col.s,zCol.selectedIndex=col.z,Plotly.restyle(figurecontainer,{x:[data[th_in][col.y],data[th_in][col.y]],y:[data[th_in][col.z],data[th_in][col.s]]});else{if(e>=fullData.length)return;[fullData[0],fullData[e]]=[fullData[e],fullData[0]],[fullDataCols[0],fullDataCols[e]]=[fullDataCols[e],fullDataCols[0]],[fileNames[0],fileNames[e]]=[fileNames[e],fileNames[0]],[saveNames[0],saveNames[e]]=[saveNames[e],saveNames[0]],[legendNames[0],legendNames[e]]=[legendNames[e],legendNames[0]],data=fullData[0],col=fullDataCols[0],updatePlot(),makeRows(),fullData[0][0].length!=fullData[e].length&&selUpdate()}firstSave=!0,makeEditable(),undoStack=[],redoStack=[],updateOnServer()}function makeEditable(){ddd?(xCol.selectedIndex=col.x,yCol.selectedIndex=col.y,zCol.selectedIndex=col.z,sCol.selectedIndex=col.s):(xCol.selectedIndex=col.y,yCol.selectedIndex=col.z,sCol.selectedIndex=col.s),pointscontainer=figurecontainer.querySelector(".scatterlayer .trace:first-of-type .points"),points=pointscontainer.getElementsByTagName("path"),data=fullData[0],dpsy=data[th_in][col.z],dpsx=data[th_in][col.y],Plotly.restyle(figurecontainer,{x:[dpsx],y:[dpsy]},0);for(var e=0;e<dpsx.length;e++)points[e].handle={x:dpsx[e],y:dpsy[e]};startDragBehavior(),document.title="Interactive Data Editor - "+replaceWithHome(fileNames[0])}document.ondragover=document.ondrop=(e=>{e.preventDefault()}),document.body.ondrop=(e=>{const t=e.dataTransfer.files[0].path;void 0!==t&&fileReader(t),e.preventDefault()});var oldX,oldCord,indd,copyVar,swapperIsOn=!1;function openSwapper(){swapperIsOn=!0,$("#sCol").show(),col.s=sCol.selectedIndex;let e=figurecontainer.data.length;if(e>2){let t=[];for(let a=2;a<e;a++)t.push(a);Plotly.deleteTraces(figurecontainer,t)}else if(1==e){let e=JSON.parse(JSON.stringify(iniPointsD));e.line.color=e.marker.color=colorList[1],Plotly.addTraces(figurecontainer,e)}let t=path.basename(fileNames[0]);Plotly.restyle(figurecontainer,{x:[data[th_in][col.y],data[th_in][col.y]],y:[data[th_in][col.z],data[th_in][col.s]],name:[t+` ${col.y+1}:${col.z+1}`,t+` ${col.y+1}:${col.s+1}`]}),Plotly.relayout(figurecontainer,{selectdirection:"h"}),menu.getMenuItemById("af").enabled=!1,menu.getMenuItemById("arf").enabled=!1,$("#files").addClass("disabled"),updateJSON()}function exitSwapper(){swapperIsOn=!1,Plotly.deleteTraces(figurecontainer,[0,1]);let e=[JSON.parse(JSON.stringify(iniPointsC))];for(let t=1;t<fullData.length;t++){let a=JSON.parse(JSON.stringify(iniPointsC));a.line.color=a.marker.color=colorList[t%9],e.push(a)}Plotly.addTraces(figurecontainer,e),data=fullData[0],Plotly.relayout(figurecontainer,{selectdirection:"any"}),$("#sCol, #sColInp").hide(),updatePlot(all=!0),makeEditable(),updateJSON(),menu.getMenuItemById("af").enabled=!0,menu.getMenuItemById("arf").enabled=!0,$("#files").removeClass("disabled")}function saveAs(){var e=dialog.showSaveDialog({title:"Save As:",defaultPath:saveNames[0]});void 0!==e&&(saveNames[0]=e,saveData(),firstSave=!1)}function saveData(){e=data,swapped&&(e=expRotate(e,col.y,col.x));var e=e.map(e=>transpose(e)),t="";try{for(let a of e){for(let e of a)void 0!==e&&(t+=e.map(e=>parseFloat(e).toFixed(8)).join("\t")+"\n");t+="\n"}fs.writeFileSync(saveNames[0],t),showStatus("Data Saved in file "+replaceWithHome(saveNames[0])),saved=!0}catch(e){return showStatus("Something went wrong! Couldn't save the data..."),!1}}function isswap(){if(!data.length)return;for(let e=0;e<fullData.length;e++)[fullDataCols[e].x,fullDataCols[e].y]=[fullDataCols[e].y,fullDataCols[e].x],fullData[e]=expRotate(fullData[e],fullDataCols[e].x,fullDataCols[e].y);if(!fullData.every(e=>e.length===fullData[0].length)){for(let e=0;e<fullData.length;e++)[fullDataCols[e].x,fullDataCols[e].y]=[fullDataCols[e].y,fullDataCols[e].x],fullData[e]=expRotate(fullData[e],fullDataCols[e].x,fullDataCols[e].y);return dialog.showMessageBox({type:"warning",title:"Can't Plot along Y!!!",message:"File(s) have different grid points along the Y axis\nFree version doesn't allow plotting such data",buttons:["Ok"]}),!1}swapped=!swapped;var[e,t]=["Y","X"];swapped&&([e,t]=[t,e]),xName=t,[xCol,yCol]=[yCol,xCol],data=fullData[0],col=fullDataCols[0],updateData(),th_in=0,$slider.slider("value",0),$ch.text(xName+"="+data[th_in][col.x][0]),$("#drag").html((a,n)=>n.replace(e,t))}function sliderChanged(){$("#custom-handle").blur(),$slider.slider("value",th_in),$ch.text(xName+"="+data[th_in][col.x][0]),startDragBehavior(),updatePlot()}function colsChanged(e){col.s=e,updatePlot();let t=path.basename(fileNames[0]);Plotly.restyle(figurecontainer,{name:[t+` ${col.y+1}:${col.z+1}`,t+` ${col.y+1}:${col.s+1}`]}),swapped||localStorage.setItem("cols3d",JSON.stringify(col))}function col2dChanged(){$("select").blur(),legendNames[0]=path.basename(fileNames[0])+` ${col.y+1}:${col.z+1}`,updatePlot(all=!1),updateOnServer(),startDragBehavior(),makeRows()}function colChanged(e){$("select").blur(),fullDataCols[0].z=col.z=e,legendNames[0]=path.basename(fileNames[0])+` ${col.y+1}:${col.z+1}`,updatePlot(all=!1),updateOnServer(),startDragBehavior(),makeRows(),swapped||localStorage.setItem("cols3d",JSON.stringify(col))}function resizePlot(){setTimeout(function(){var e=window.innerHeight-document.getElementById("figurecontainer").offsetTop;$("#figurecontainer").height(e-2),Plotly.relayout(figurecontainer,{autosize:!0})},330)}function sSwapper(){[col.s,col.z]=[col.z,col.s],sCol.selectedIndex=col.s,zCol.selectedIndex=col.z,updatePlot(),updateOnServer()}function selectEvent(e){if(void 0!=e){index=[],del_dat=[],$(".custom-cm").hide();for(let t of e.points)dpsy[t.pointIndex]==t.y&&index.push(t.pointIndex);index=[...new Set(index)],rangedSelector&&(index=Plotly.d3.range(index[0],index[index.length-1]+1),Plotly.restyle(figurecontainer,{selectedpoints:[index]}))}}function updateFigure(){var e=[],t=[];if(lockXc){for(let t of points)e.push(t.handle.y);Plotly.restyle(figurecontainer,{y:[e]},0),dpsy=data[th_in][col.z]=e}else{for(let a of points)t.push(a.handle.x),e.push(a.handle.y);Plotly.restyle(figurecontainer,{x:[t],y:[e]},0),dpsy=data[th_in][col.z]=e,dpsx=data[th_in][col.y]=t}}function clamp(e,t,a){return Math.max(t,Math.min(e,a))}function startDragBehavior(){var e=Plotly.d3,t=e.behavior.drag();t.origin(function(){saveOldData();var t=e.select(this).attr("transform"),a=t.substring(10,t.length-1).split(/,| /);return index.length&&(oldCord=dpsy,indd=(oldX=dpsx).indexOf(this.handle.x)),{x:a[0],y:a[1]}}),t.on("drag",function(){var t=e.event.x,a=e.event.y;e.select(this).attr("transform","translate("+[t,a]+")");var n=this.handle,o=figurecontainer._fullLayout.yaxis;if(n.y=clamp(o.p2l(a),o.range[0],o.range[1]),index.length){var l=n.y-oldCord[indd];for(let e of index)points[e].handle.y=l+oldCord[e]}if(!lockXc){var i=figurecontainer._fullLayout.xaxis;if(n.x=clamp(i.p2l(t),i.range[0],i.range[1]),index.length){l=n.x-oldX[indd];for(let e of index)points[e].handle.x=l+oldX[e]}}updateFigure()}),t.on("dragend",function(){updateFigure(),fullData[0]=data,updatePlot(all=!1),polyFitLive&&polyfit($("#polyInp").val()),updateOnServer(),e.select(".scatterlayer .trace:first-of-type .points path:first-of-type").call(t)}),e.selectAll(".scatterlayer .trace:first-of-type .points path").call(t)}function keyBoardDrag(e){if(index.length){ma&&(saveOldData(),ma=0);var t=figurecontainer._fullLayout.yaxis,a=t.p2l(1)-t.p2l(0);e&&(a=-a);for(let e of index)points[e].handle.y+=a;updateFigure()}}function saveOldData(){data.length&&(redoStack=[],olddata=JSON.stringify([th_in,col,swapped,data[th_in]]),10==undoStack.length&&undoStack.splice(0,1),undoStack.push(olddata),saved=!1)}function reDo(){redoStack.length&&(olddata=redoStack.pop(),undoStack.push(JSON.stringify([th_in,col,swapped,data[th_in]])),doIt())}function unDo(){ma||(ma=1),undoStack.length&&(olddata=undoStack.pop(),redoStack.push(JSON.stringify([th_in,col,swapped,data[th_in]])),doIt())}function doIt(){var e,t;[th_in,col,t,e]=JSON.parse(olddata),t!=swapped&&isswap(),zCol.selectedIndex=col.z,sCol.selectedIndex=col.s,data[th_in]=e,updatePlot(all=!1),startDragBehavior(),updateOnServer(),saved=!1}function updateOnServer(){if(serve)return new Promise((e,t)=>{var a=[],n=[],o=[];for(let e of data)a.push(e[col.x]),n.push(e[col.y]),o.push(e[col.z]);var l=[a,n,o];for(let e in viewer)viewer[e].webContents.send("sdata",[l,swapped,Object.values(col)]);e()})}function spreadsheet(){(editorWindow=new BrowserWindow({minWidth:1200,show:!1,webPreferences:{nodeIntegration:!0}})).maximize(),editorWindow.loadURL(url.format({pathname:path.join(__dirname,"handtable.html"),protocol:"file:",slashes:!0})),editorWindow.setMenuBarVisibility(!1),editorWindow.show(),app.isPackaged||editorWindow.webContents.openDevTools(),editorWindow.webContents.once("dom-ready",function(){editorWindow.webContents.send("slider",[xName,col.x,data])})}function openViewer(e){serve=1;var t="3D_Viewer_Lines.html";e&&(t="3D_Viewer_Surface.html"),viewerWindow=new BrowserWindow({show:!1,minWidth:1200,webPreferences:{nodeIntegration:!0}}),viewerWindow.maximize(),setTimeout(function(){viewerWindow.loadURL(url.format({pathname:path.join(__dirname,t),protocol:"file:",slashes:!0}))},50),viewerWindow.on("closed",function(){delete viewer[t]}),viewerWindow.show(),viewerWindow.setMenuBarVisibility(!1),viewer[t]=viewerWindow,app.isPackaged||viewerWindow.webContents.openDevTools(),viewerWindow.webContents.once("dom-ready",function(){updateOnServer()})}function triggerDownload(){var e=document.createElement("div");e.id="download",e.innerHTML='<div class=\'jjjj\'><b> Save the image</b><br></div>\n                    &ensp; File Name: <input type="text" id= "dfileName"><br>\n                    &ensp; File Type:<select id="fileFormat">\n                            <option>JPEG</option>\n                            <option>PNG</option>\n                            <option>SVG</option>\n                            <option>WEBP</option>\n                            <option>PDF</option>\n                        </select><br>\n                    &ensp; Image Resolution: <input type="text" id="imRes" value="1920x1080"><br>\n                    <div  class=\'jjjj\'>\n                        <input type="button" value="OK" onclick="downloadImage();$(\'#download\').remove();">\n                        <input type="button" value="Cancel" onclick="$(\'#download\').remove();">\n                    </div>'.trim(),document.body.appendChild(e)}function downloadImage(){var e=$("#dfileName").val(),t=$("#imRes").val().split("x"),a=$("#fileFormat").val().toLocaleLowerCase();e||(e="plot"),"pdf"==a?(e+=".pdf",exportPDF({width:parseFloat(t[0]),height:parseFloat(t[1])}).then(t=>{var a=dialog.showSaveDialog({title:"Save As:",defaultPath:path.join(recentLocation,e),filters:[{name:"PDF",extensions:["pdf"]}]});void 0!==a&&fs.writeFileSync(a,t)})):Plotly.downloadImage(figurecontainer,{filename:e,format:a,width:t[0],height:t[1]})}function exportPDF({width:e=1920,height:t=1080}={}){return new Promise((a,n)=>{var o={marginsType:1,printBackground:!0,pageSize:{width:(e+6)/.00377957517575025,height:(t+6)/.00377957517575025}},l=window.encodeURIComponent("<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset=\"UTF-8\">\n            <style>\n            body {\n                margin: 0;\n                padding: 0;\n                background-color: 'rgba(0,0,0,0)'\n            }\n            </style>\n        </head>\n        <body><img/></body>\n        </html>");Plotly.toImage(figurecontainer,{format:"svg",width:e,height:t}).then(i=>{var s=new remote.BrowserWindow({width:e,height:t,show:!1});s.on("closed",()=>{s=null}),s.loadURL(`data:text/html,${l}`),s.webContents.executeJavaScript(`new Promise((resolve, reject) => {\n                const img = document.body.firstChild\n                img.onload = resolve\n                img.onerror = reject\n                img.src = "${i}"\n                setTimeout(() => reject(new Error('too long to load image')), 3000)\n                })`).then(()=>{s.webContents.printToPDF(o,(e,t)=>{s.close(),e?n(e):a(t)})}).catch(e=>{n(e),s.close()})})})}function copyThis(){copyVar=JSON.stringify([dpsx,dpsy])}function pasteThis(){var[e,t]=JSON.parse(copyVar);e.every((e,t)=>e===data[th_in][col.y][t])?(saveOldData(),data[th_in][col.y]=e,data[th_in][col.z]=t,endJobs()):alert("Copy paste between different data set is not supported!")}function swapData(){if(index.length&&swapperIsOn){saveOldData();for(let e of index)[data[th_in][col.z][e],data[th_in][col.s][e]]=[data[th_in][col.s][e],data[th_in][col.z][e]];endJobs()}}function moveReflect(e,t){saveOldData();var a=index[index.length-1]+1,n=dpsy.slice(index[0],a);e||(a=index[0]-index.length),t&&n.reverse(),n.shift(),dpsy.splice(a,n.length,...n),updatePlot(),updateOnServer()}var last="",times="";function repeatMirror(){if(last=parseFloat($("#einp").val()),times=parseFloat($("#etime").val()),!last|!times)showStatus("Invalid inputs.");else{var e=$("#repSel")[0].selectedIndex,t=[],a=data[0].length;for(let e=0;e<a;e++)e!=col.y&&t.push(e);for(let e=0;e<data.length;e++)if(!(data[0][col.y].indexOf(last)+1))return alert("Endpoint must exist !!!"),void $("#extend").slideUp();data=data.map(a=>{var n=a[col.y].indexOf(last)+1,o=a[col.y].slice(0,n);(i=o.slice()).splice(0,1);for(let e=0;e<times-1;e++)for(let t=0;t<i.length;t++)o.push(i[t]+last*(1+e));for(let o of t){var l=a[o].slice(0,n),i=l.slice();for(let t=0;t<times-1;t++)ptmp=e?i.reverse().slice():i.slice(),ptmp.splice(0,1),l.push(...ptmp);a[o]=l}return a[col.y]=o,a}),endJobs({resize:!0,startdrag:!0}),showStatus(`Data ${a=e?"mirrored":"repeated"} ${times} times...`)}}var start="",stop="",step="";function dataFiller(){if(start=parseFloat($("#fstart").val()),stop=parseFloat($("#fend").val()),step=parseFloat($("#fstep").val()),isNaN(start)|isNaN(step)|!step)showStatus("Invalid inputs.");else{var e=!!$("#expSel")[0].selectedIndex,t=[];for(let e=0;e<data[0].length;e++)e!=col.y&e!=col.x&&t.push(e);var a=[];for(let e=start;e<=stop;e+=step)a.push(e);data=data.map(n=>{if(a.length==n[0].length)return n;var o=n[col.y].slice(),l=n[col.y].length-1;let i=!1,s=!1;e&&(s=a[0]<o[0],i=a[a.length-1]>o[o.length-1]);for(let e of t){newArr=[];var r=n[e].slice();spl=new Spline(o,r),s&&(frontReg=new Regression(o.slice(0,3),r.slice(0,3),2)),i&&(backReg=new Regression(o.slice(Math.max(o.length-3,1)),r.slice(Math.max(r.length-3,1)),2));for(let t of a)ind=n[col.y].indexOf(t),-1!=ind?newArr.push(n[e][ind]):t<=n[col.y][0]?s?newArr.push(frontReg.val(t)):newArr.push(n[e][0]):t>=n[col.y][l]?i?newArr.push(backReg.val(t)):newArr.push(n[e][l]):newArr.push(spl.getVal(t));n[e]=newArr}return n[col.y]=a,n[col.x]=new Array(a.length).fill(n[col.x][0]),n}),endJobs({resize:!0,startdrag:!0}),showStatus("Missing values are filled...")}}function filterData(){var e=$("#flSel")[0].selectedIndex,t=parseFloat($("#flc").val()),a=parseFloat($("#flf").val()),n=$("#flcl").val().split(",").map(e=>parseFloat(e)-1);0==e?data=data.map(e=>{for(let o of n)e[o]=e[o].map(e=>e<t?a:e);return e}):1==e?data=data.map(e=>{for(let o of n)e[o]=e[o].map(e=>e>t?a:e);return e}):2==e&&(data=data.map(e=>{for(let o of n)e[o]=e[o].map(e=>e==t?a:e);return e})),endJobs({resize:!0,startdrag:!0}),showStatus("Data filtered...")}function deleteExtrapolate(){if(index.length){first=index[0],last=index[index.length-1],xs=dpsx.slice(Math.max(first-3,0),first).concat(dpsx.slice(last+1,last+4)),ys=dpsy.slice(Math.max(first-3,0),first).concat(dpsy.slice(last+1,last+4)),exterp=new Regression(xs,ys,2),saveOldData();for(let e of index)data[th_in][col.z][e]=exterp.val(data[th_in][col.y][e]);endJobs()}}function dataSupEnd(){if(!index.length)return;if(first=index[0],0==first)return;let e=dpsx.slice(Math.max(first-3,0),first),t=dpsy.slice(Math.max(first-3,0),first);exterp=new Regression(e,t,2),saveOldData();let a=exterp.val(data[th_in][col.y][first])-data[th_in][col.z][first];for(let e of index)data[th_in][col.z][e]+=a;endJobs()}function dataSupStart(){if(!index.length)return;if((last=index[index.length-1])==dpsx.length-1)return;let e=dpsx.slice(last+1,last+4),t=dpsy.slice(last+1,last+4);exterp=new Regression(e,t,2),saveOldData();let a=exterp.val(data[th_in][col.y][last])-data[th_in][col.z][last];for(let e of index)data[th_in][col.z][e]+=a;endJobs()}function deleteInterpolate(){if(index.length){var e=dpsx.slice(),t=dpsy.slice();0==index[0]&&index.splice(0,1),index[index.length-1]==dpsx.length-1&&index.splice(-1,1);for(var a=index.length-1;a>=0;a--)e.splice(index[a],1),t.splice(index[a],1);spl=new Spline(e,t),saveOldData();for(let e of index)data[th_in][col.z][e]=spl.getVal(data[th_in][col.y][e]);endJobs()}}function autoSmooth(){if(ma&&(saveOldData(),ma=0),index.length){0==index[0]&&index.splice(0,1),index[index.length-1]==dpsx.length-1&&index.splice(-1,1);for(let e of index)dpsy[e]=(dpsy[e-1]+dpsy[e]+dpsy[e+1])/3;data[th_in][col.z]=dpsy,updatePlot(),saved=!1}}function changeSign(){if(index.length){saveOldData();for(let e of index)data[th_in][col.z][e]*=-1;endJobs()}}function setValue(){saveOldData();var e=parseFloat($("#valinput").val());if(!isNaN(e)){for(let t of index)data[th_in][col.z][t]=e;endJobs({clearIndex:!0}),Plotly.restyle(figurecontainer,{selectedpoints:[null]}),$("#setval").remove()}}function removeBadData(){if(index.length){saveOldData();for(let e=index.length-1;e>=0;e--)for(let t=0;t<data[0].length;t++)data[th_in][t].splice(index[e],1);endJobs({clearIndex:!0}),Plotly.restyle(figurecontainer,{selectedpoints:[null]})}}function revertPloyFit(){Plotly.deleteTraces(figurecontainer,1),polyFitLive=!1;for(let e of["edat","fill","filter","af","arf"])menu.getMenuItemById(e).enabled=!0}var polyFitLive=!1;function polyfit(e){if(e){if(!polyFitLive){if(ddd)return void alert("Regression fitting is only supported for 2D data.");if(figurecontainer.data.length>1)return void alert("Supported only for one plot at time.")}if(!(e>=dpsx.length)){var t=dpsx.slice(),a=dpsy.slice(),n=[],o=[],l=new Regression(t,a,e,!0),i=(t.length-1)/e/4;for(let a=0;a<=4*e;a++)n.push(t[parseInt(i*a)]);for(let e of n)o.push(l.val(e));if(polyFitLive)Plotly.restyle(figurecontainer,{x:[n],y:[o]},1);else{polyFitLive=!0;let e=JSON.parse(JSON.stringify(iniPointsD));e.mode="lines",e.line.color="#207104",e.line.shape="spline",e.name="Fitted line",e.x=n,e.y=o,Plotly.addTraces(figurecontainer,e)}var s="y = "+l.cf[0].toPrecision(5);for(let t=1;t<=e;t++){let e=l.cf[t].toPrecision(5);s+=` ${e>=0?"+":"-"}${Math.abs(e)}x<sup>${t>1?t:""}</sup>`}return document.getElementById("formulaStr").innerHTML=s,!0}showStatus(`Fitting of order ${e} is not possible.`)}}function endJobs({resize:e=!1,updateAll:t=!1,startdrag:a=!1,clearIndex:n=!1}={}){return new Promise((o,l)=>{updatePlot(t),updateOnServer(),saved=!1,fullData[0]=data,n&&(index=[]),a&&startDragBehavior(),e&&resizePlot(),o()})}ipcRenderer.on("rf",function(e,t){fileReader(t)}),ipcRenderer.on("adrf",function(e,t){addNewFile(t)}),ipcRenderer.on("back",function(e,t){data=t.map(e=>transpose(e)),updatePlot(1),selUpdate(),startDragBehavior(),updateOnServer()}),ipcRenderer.on("checkClose",function(e,t){if(!saved)var a=dialog.showMessageBox({type:"warning",title:"Unsaved data found!!!",message:"There are some modified data, that you haven't saved yet.\n Are you sure to quit without saving?",buttons:["Yes","No"]});a||ipcRenderer.send("checkClose","closeIt")});var extendUtils={filter:' Condition:<select id="flSel">\n    <option>&lt;</option>\n    <option>></option>\n    <option>=</option>\n</select>\n<input type="text" id="flc"> <br>\nFill with &nbsp;: <input type="text" id="flf">\n<input type="submit" value="OK" onclick="filterData();closeThis(this)" style="width: 5pc;height: 1.9pc">\n<input type="submit" value="Cancel" onclick="closeThis(this)" style="width: 5pc;height: 1.9pc">\n&ensp; &#9432;<span style="font-size:.9pc"> This operation is not reversible. You may want to save before proceeding.</span> <br>\nColumns : <input type="text" id="flcl">',filler:'            Start : <input type="text" id="fstart">\nExtrapolate: <select  id="expSel">\n    <option>Closest</option>\n    <option>Regression</option>\n</select> <br>\nEnd &nbsp;: <input type="text" id="fend">\n<input type="submit" value="OK" onclick="dataFiller();closeThis(this)" style="width: 5pc;height: 1.7pc;margin-right: 2px">\n<input type="submit" value="Cancel" onclick="closeThis(this)" style="width: 5pc;height: 1.7pc">\n&ensp; &#9432;<span style="font-size:.9pc"> This operation is not reversible. You may want to save before proceeding.</span><br>\nStep : <input type="text" id="fstep">',extend:'Extend from : 0 to <input type="text" id="einp"> <br>\nExtend times: <input type="text" id="etime">\n<input type="submit" value="OK" onclick="repeatMirror();closeThis(this)" style="width: 5pc;height: 1.9pc">\n<input type="submit" value="Cancel" onclick="closeThis(this)" style="width: 5pc;height: 1.9pc"> <br>\nExtend by: <select style="margin-left: 18px;" id="repSel" >\n    <option>Repeat</option>\n    <option>Mirror</option>\n</select><br>',rgfit:'<span style="display: inline-block; margin-bottom: .4pc"> \nOrder of polynomial: &ensp;</span> \n<input style="height: 1.4pc" id="polyInp" type="number" value="1" min="1" oninput="polyfit(this.value)"> &ensp; \n<input type="submit" value="Close" onclick="closeThis(this);revertPloyFit()" style="width: 5pc;height: 1.5pc"> <br>\nFitted Equation: <span id=\'formulaStr\'></span>'};function closeThis(e){$(e).parent().slideUp(),resizePlot()}function hotDKeys(e){if("text"!=document.activeElement.type)switch(e.key){case"m":case"ArrowDown":case"ArrowUp":ma=1,fullData[0]=data,updateOnServer()}}function hotKeys(e){if("text"!=document.activeElement.type)switch(e.key){case" ":Plotly.relayout(figurecontainer,{"xaxis.autorange":!0,"yaxis.autorange":!0});break;case",":if(0==th_in)break;th_in-=1,sliderChanged();break;case".":if(th_in==data.length-1)break;th_in+=1,sliderChanged();break;case"s":case"S":e.ctrlKey||Plotly.relayout(figurecontainer,{dragmode:"select"});break;case"z":case"Z":e.ctrlKey&!e.shiftKey?unDo():e.ctrlKey&e.shiftKey?reDo():Plotly.relayout(figurecontainer,{dragmode:"zoom"});break;case"p":case"P":swapData();break;case"d":case"D":deleteInterpolate();break;case"e":case"E":deleteExtrapolate();break;case"m":case"M":autoSmooth();break;case"c":case"C":e.ctrlKey?copyThis():changeSign();break;case"v":case"V":e.ctrlKey&&pasteThis();break;case"ArrowDown":keyBoardDrag(0);break;case"ArrowUp":keyBoardDrag(1);break;case"o":case"O":app.isPackaged||sSwapper();break;case"x":case"X":removeBadData();case"Tab":e.ctrlKey&&(keepTrackIndex+=1,keepTrackIndex==fullData.length&&(keepTrackIndex=1),selectEditable(keepTrackIndex));break;case"ArrowLeft":case"ArrowRight":e.ctrlKey|e.shiftKey&&moveReflect(e.keyCode-37,e.shiftKey);case"k":case"K":dataSupStart();break;case"l":case"L":dataSupEnd()}}ipcRenderer.on("menuTrigger",function(e,t){switch(show&&console.log(e,t),t){case"open":fileLoader();break;case"add":addNewFileDialog();break;case"save":firstSave?saveAs():saveData();break;case"saveas":saveAs();break;case"wire":openViewer(0);break;case"surface":openViewer(1);break;case"spread":spreadsheet();break;case"pa":isswap();break;case"pamh":lockXc=menu.getMenuItemById("pamh").checked?0:1;break;case"rsch":rangedSelector=menu.getMenuItemById("rsch").checked?1:0;break;case"fullscreen":resizePlot();break;case"tswap":swapperIsOn?exitSwapper():openSwapper();break;case"edat":document.getElementById("extendutils").innerHTML=extendUtils.extend,$("#einp").val(last),$("#etime").val(times),$("#extendutils").slideDown(),resizePlot();break;case"fill":document.getElementById("extendutils").innerHTML=extendUtils.filler,$("#fstart").val(start),$("#fend").val(stop),$("#fstep").val(step),$("#extendutils").slideDown(),resizePlot();break;case"filter":document.getElementById("extendutils").innerHTML=extendUtils.filter,$("#extendutils").slideDown(),resizePlot();break;case"rgft":if(document.getElementById("extendutils").innerHTML=extendUtils.rgfit,polyfit(1)){$("#extendutils").slideDown(),resizePlot();for(let e of["edat","fill","filter","af","arf"])menu.getMenuItemById(e).enabled=!1}break;case"pdash":$("#sidebar2").width()?closeNav2():openNav2();break;case"fdash":$("#sidebar").width()?closeNav():openNav()}}),keepTrackIndex=0;var cm=$(".custom-cm"),sub=$(".submen"),subm=$(".submenu");function contextMenuFuncs(e){index.length&&(e.preventDefault(),ttt=e.clientY+cm.height()+50>window.innerHeight?window.innerHeight-cm.height()-50:e.clientY,lll=e.clientX+cm.width()>window.innerWidth-5?window.innerWidth-cm.width()-5:e.clientX,cm.css({top:ttt,left:lll}),lll+=147,ttt=ttt+84+65>window.innerHeight?ttt:ttt+65,lll=lll+175>window.innerWidth?lll-172-147:lll,$(".submenu").css({top:ttt,left:lll}),cm.show())}function resetClicks(e){cm.hide(),"rect"==e.target.tagName&&(Plotly.restyle(figurecontainer,{selectedpoints:[null]}),index=[],del_dat=[])}function exectuteContext(){cm.hide();var e=document.createElement("div");e.id="setval",e.innerHTML='Set a value for the selected points <br>\n        <input type="text" id="valinput" onchange="setValue();"><br>\n        <input type="button" value="OK" onclick="setValue();">\n        <input type="button" value="Cancel" onclick="$(\'#setval\').remove();">'.trim(),document.body.appendChild(e)}$(window).keydown(hotKeys),$(window).keyup(hotDKeys),$("#figurecontainer").contextmenu(contextMenuFuncs),$("#figurecontainer").click(resetClicks),sub.mouseover(function(){subm.show()}),subm.mouseover(function(){subm.show()}),sub.mouseleave(function(){!$(".submen:hover").length&!$(".submenu:hover").length&&setTimeout(function(){subm.hide()},200)}),subm.mouseleave(function(){!$(".submen:hover").length&!$(".submenu:hover").length&&setTimeout(function(){subm.hide()},200)});var minWidth=window.innerWidth/4.5;function openNav(){closeNav2(),$("#split-bar").width(5),$("#sidebar").width(minWidth),$("#full").css("margin-left",minWidth+6),resizePlot()}function closeNav(){$("#sidebar").width()&&($("#split-bar,#sidebar").width(0),$("#full").css("margin-left",0),resizePlot())}function openNav2(){closeNav(),$("#split-bar2").width(5),$("#sidebar2").width(minWidth),$("#jsoneditor").width(minWidth-5),$("#full").css("margin-left",minWidth+6),resizePlot()}function closeNav2(){$("#sidebar2").width()&&($("#split-bar2,#sidebar2").width(0),$("#full").css("margin-left",0),$("#jsoneditor").width(195),resizePlot())}function updateJSON(){if($("#sidebar2").width()){console.log("called");var e=[],t=[];for(let a of figurecontainer.data)e.push({Title:a.name,Style:a.mode,Marker:a.marker,Line:a.line}),t.push(a.name);legendNames=t,Layout=figurecontainer.layout,editor.update({Plots:e,Layout:Layout})}}$("#split-bar").mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){e.preventDefault();var t=e.pageX-$("#sidebar").offset().left;t>window.innerWidth/5.5&&t<window.innerWidth/2.5&&($("#sidebar").width(t-2),$("#full").css("margin-left",t),minWidth=t,resizePlot())})}),$("#split-bar2").mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){e.preventDefault();var t=e.pageX-$("#sidebar2").offset().left;t>window.innerWidth/5.5&&t<window.innerWidth/2.5&&($("#sidebar2").width(t-2),$("#full").css("margin-left",t),$("#jsoneditor").width(t-7),minWidth=t,resizePlot())})}),$(document).mouseup(function(e){$(document).unbind("mousemove")});var typeList=["Arial","Balto","Courier New","Droid Sans",,"Droid Serif","Droid Sans Mono","Gravitas One","Old Standard TT","Open Sans","Overpass","PT Sans Narrow","Raleway","Times New Roman"],symList=["circle","circle-open","circle-dot","circle-open-dot","square","square-open","square-dot","square-open-dot","diamond","diamond-open","diamond-dot","diamond-open-dot","cross","cross-open","cross-dot","cross-open-dot","x","x-open","x-dot","x-open-dot","triangle-up","triangle-up-open","triangle-up-dot","triangle-up-open-dot","triangle-down","triangle-down-open","triangle-down-dot","triangle-down-open-dot","triangle-left","triangle-left-open","triangle-left-dot","triangle-left-open-dot","triangle-right","triangle-right-open","triangle-right-dot","triangle-right-open-dot","triangle-ne","triangle-ne-open","triangle-ne-dot","triangle-ne-open-dot","triangle-se","triangle-se-open","triangle-se-dot","triangle-se-open-dot","triangle-sw","triangle-sw-open","triangle-sw-dot","triangle-sw-open-dot","triangle-nw","triangle-nw-open","triangle-nw-dot","triangle-nw-open-dot","pentagon","pentagon-open","pentagon-dot","pentagon-open-dot","hexagon","hexagon-open","hexagon-dot","hexagon-open-dot","hexagon2","hexagon2-open","hexagon2-dot","hexagon2-open-dot","octagon","octagon-open","octagon-dot","octagon-open-dot","star","star-open","star-dot","star-open-dot","hexagram","hexagram-open","hexagram-dot","hexagram-open-dot","star-triangle-up","star-triangle-up-open","star-triangle-up-dot","star-triangle-up-open-dot","star-triangle-down","star-triangle-down-open","star-triangle-down-dot","star-triangle-down-open-dot","star-square","star-square-open","star-square-dot","star-square-open-dot","star-diamond","star-diamond-open","star-diamond-dot","star-diamond-open-dot","diamond-tall","diamond-tall-open","diamond-tall-dot","diamond-tall-open-dot","diamond-wide","diamond-wide-open","diamond-wide-dot","diamond-wide-open-dot","hourglass","hourglass-open","bowtie","bowtie-open","circle-cross","circle-cross-open","circle-x","circle-x-open","square-cross","square-cross-open","square-x","square-x-open","diamond-cross","diamond-cross-open","diamond-x","diamond-x-open","cross-thin","cross-thin-open","x-thin","x-thin-open","asterisk","asterisk-open","hash","hash-open","hash-dot","hash-open-dot","y-up","y-up-open","y-down","y-down-open","y-left","y-left-open","y-right","y-right-open","line-ew","line-ew-open","line-ns","line-ns-open","line-ne","line-ne-open","line-nw","line-nw-open"],schema={properties:{Plots:{items:{properties:{Title:{type:["string","number"]},Style:{enum:["markers+lines","lines","markers"]},Marker:{properties:{symbol:{enum:symList},size:{type:"number"},opacity:{type:"number"}}},Line:{properties:{width:{type:"integer"},dash:{type:"integer"},shape:{enum:["linear","spline"]}}}}}},Layout:{properties:{selectdirection:{enum:["v","h","any"]},dragmode:{enum:["select","zoom"]},hovermode:{enum:["false","x","y","closest"]},title:{properties:{font:{properties:{family:{enum:typeList},size:{type:"number"}}}}},xaxis:{properties:{type:{enum:["linear","log","date","category"]},title:{properties:{font:{properties:{family:{enum:typeList},size:{type:"number"}}}}}},required:["type"]},yaxis:{properties:{type:{enum:["linear","log","date","category"]},title:{properties:{font:{properties:{family:{enum:typeList},size:{type:"number"}}}}}},required:["type"]}}}}},options={onChangeJSON:function(e){var t=[],a=[],n=[],o=[];for(let l of e.Plots)t.push(l.Title),a.push(l.Style),n.push(l.Line),o.push(l.Marker);legendNames=t,Plotly.update(figurecontainer,{name:t,mode:a,line:n,marker:o},e.Layout),makeRows()},onColorPicker:function(e,t,a){new JSONEditor.VanillaPicker({parent:e,color:t,popup:"bottom",onChange:function(e){var t=1===e.rgba[3]?e.hex.substr(0,7):e.hex;a(t)}}).show()},mode:"form",schema:schema},jsoneditor=document.getElementById("jsoneditor"),editor=new JSONEditor(jsoneditor,options,{lines:"",layout:""});function getInd(e){selectEditable($("li").index(e))}function removeRow(e){if(1!=fullData.length){var t=$(".closefile").index(e);fullData.splice(t,1),fullDataCols.splice(t,1),fileNames.splice(t,1),saveNames.splice(t,1),legendNames.splice(t,1),Plotly.deleteTraces(figurecontainer,t),makeRows(),makeEditable();var a=fullDataCols[0];if(ddd?(xCol.selectedIndex=a.x,yCol.selectedIndex=a.y,zCol.selectedIndex=a.z):(xCol.selectedIndex=a.y,yCol.selectedIndex=a.z),0==t){marker=[{symbol:200,color:"#b00",size:6,opacity:1}],line=[{width:2,color:"#1e77b4",dash:0,shape:"linear"}];for(let e=1;e<figurecontainer.data.length;e++)marker.push({symbol:200,color:colorList[e%9],size:6,opacity:1}),line.push({width:2,color:colorList[e%9],dash:0,shape:"linear"});a=fullDataCols[0],Plotly.restyle(figurecontainer,{line:line,marker:marker})}}}function copyFile(e){var t=$(".copyfile").index(e);data=fullData[t],fullData.unshift(fullData[t]),fullDataCols.unshift(JSON.parse(JSON.stringify(fullDataCols[t]))),fileNames.unshift(fileNames[t]),saveNames.unshift(saveNames[t]),legendNames.unshift(legendNames[t]),addTrace()}function makeRows(){tmp="<ol>";for(let e=0;e<fileNames.length;e++)name=fileNames[e],ccll=fullDataCols[e],name=path.basename(name),tmp+=`<li onclick='getInd(this)'>\n        <input type="button" title="Close this File" class = 'closefile' value="X">\n        <input type="button" title="Copy this File" class = 'copyfile' value="C">\n        <label class='filename' >${name} ${ccll.y+1}:${ccll.z+1}</label>\n        </li>`;tmp+="</ol>",$("#files").html(tmp),$("li .closefile").click(function(e){removeRow(this),e.stopPropagation()}),$("li .copyfile").click(function(e){copyFile(this),e.stopPropagation()}),updateJSON()}$("#jsoneditor").height(window.innerHeight-jsoneditor.offsetTop);var file,points,pointscontainer,data=[],compdata=[],olddata="",dpsx=[],dpsy=[],dpsy2=[],index=[],del_dat=[],th_in=0,refdat=1,ma=1,serve=0,lockXc=1,swapped=0,swapper=!1,ddd=!1,col={x:0,y:0,z:0,s:0},xName="X",$slider=$("#slider"),xCol=document.getElementById("xCol"),yCol=document.getElementById("yCol"),zCol=document.getElementById("zCol"),sCol=document.getElementById("sCol"),xVal=document.getElementById("x_val"),figurecontainer=document.getElementById("figurecontainer"),$ch=$("#custom-handle");const Plotly=require("plotly.js-gl3d-dist");var layout={autosize:!0,plot_bgcolor:"#fafafa",paper_bgcolor:"#fff",showlegend:!1,hovermode:"closest",title:"",titlefont:{family:"Droid Sans",size:20,color:"#000000"},margin:{t:25,r:0,b:19,l:10,pad:0},xaxis:{title:"",zeroline:!1,showline:!0,showgrid:!0,automargin:!0,dtick:"",titlefont:{family:"Droid Sans",size:20,color:"#000000"}},yaxis:{title:"",automargin:!0,zeroline:!1,showline:!0,tickformat:" ,.5g",dtick:"",hoverformat:" ,.6g",showgrid:!0,titlefont:{family:"Droid Sans",size:20,color:"#000000"}},font:{size:14},showlegend:!0,legend:{x:0,y:1}},colorList=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],iniPointsD={x:[1],y:[1],type:"scatter",opacity:1,mode:"markers+lines",marker:{symbol:"circle-dot",color:"#b00",size:6,opacity:1},line:{width:2,color:"#1e77b4",dash:0,shape:"linear"},hoverinfo:"x+y"},iniPointsC={x:[1],y:[1],type:"scatter",opacity:1,mode:"markers+lines",marker:{symbol:"circle-dot",color:"#b00",size:6,opacity:1},line:{width:2,color:"#1e77b4",dash:0,shape:"linear"},hoverinfo:"x+y"},mode={displaylogo:!1,editable:!0,modeBarButtonsToRemove:["toImage","sendDataToCloud"],modeBarButtonsToAdd:[[{name:"Save the image",icon:Plotly.Icons.camera,click:triggerDownload}]]};Plotly.newPlot(figurecontainer,[iniPointsD],layout,mode),pointscontainer=figurecontainer.querySelector(".scatterlayer .trace:first-of-type .points"),points=pointscontainer.getElementsByTagName("path"),figurecontainer.on("plotly_selected",selectEvent),figurecontainer.on("plotly_relayout",updateJSON),resizePlot(),figurecontainer.on("plotly_legendclick",function(){var e=[];for(let t of figurecontainer.data)e.push(t.name);legendNames=e,updateJSON()}),$(function(){$slider.slider({min:0,max:0,step:1,slide:function(e,t){th_in=t.value,sliderChanged()}})});var em2px=$ch.width()/3;function parseData(e){var t=[],a=[];e=e.trim().split(/\r?\n\s*\r?\n/);try{for(let o of e){a=o.trim().split("\n");for(var n=0;n<a.length;n++)a[n]=a[n].trim().split(/[\s\t]+/),a[n]=a[n].map(e=>{if(y=parseFloat(e),isNaN(y))throw"badData";return y});t.push(transpose(a))}}catch(e){return void((e="badData")&&alert("Bad data found !!!\nCheck the file before openning."))}return t}function expRotate(e,t,a){if(e=e.map(e=>transpose(e)),!issame){issame=!0;var n=e[0].length;for(let t of e)if(t.length!=n){issame=!1;break}}if(issame)return e=(e=transpose(e)).map(e=>transpose(e));e=[].concat(...e).filter(e=>void 0!==e);var o=new Set;for(let a of e)o.add(a[t]);o=[...o].sort((e,t)=>e-t);var l=[];for(let n of o){var i=[];for(let a of e)n==a[t]&&i.push(a);i=i.sort((e,t)=>e[a]-t[a]),l.push(transpose(i))}return l}function matvecmul(e,t){if(e[0].length==t.length){var a=e.length,n=t.length;res=new Array(a).fill(0);for(let o=0;o<n;o++)for(let n=0;n<a;n++)res[n]+=e[n][o]*t[o];return res}}function matmul(e,t){if(e[0].length==t.length){var a=e.length,n=t[0].length,o=t.length;res=new Array(a).fill(0).map(e=>new Array(n).fill(0));for(let l=0;l<o;l++)for(let o=0;o<a;o++)for(let a=0;a<n;a++)res[o][a]+=e[o][l]*t[l][a];return res}}function pythag(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+(t/e)**2):0==t?e:t*Math.sqrt(1+(e/t)**2)}function svd(e){var t,a=Math.pow(2,-52),n=1e-64/a,o=0,l=0,i=0,s=0,r=0,d=JSON.parse(JSON.stringify(e)),c=d.length,p=d[0].length;if(c<p)throw"Need more rows than columns";var f=new Array(p),u=new Array(p);for(l=0;l<p;l++)f[l]=u[l]=0;var h=new Array(p).fill(0).map(e=>new Array(p).fill(0)),m=0,g=0,y=0,x=0,v=0,w=0,b=0;for(l=0;l<p;l++){for(f[l]=g,b=0,r=l+1,i=l;i<c;i++)b+=d[i][l]*d[i][l];if(b<=n)g=0;else for(m=d[l][l],g=Math.sqrt(b),m>=0&&(g=-g),y=m*g-b,d[l][l]=m-g,i=r;i<p;i++){for(b=0,s=l;s<c;s++)b+=d[s][l]*d[s][i];for(m=b/y,s=l;s<c;s++)d[s][i]+=m*d[s][l]}for(u[l]=g,b=0,i=r;i<p;i++)b+=d[l][i]*d[l][i];if(b<=n)g=0;else{for(m=d[l][l+1],g=Math.sqrt(b),m>=0&&(g=-g),y=m*g-b,d[l][l+1]=m-g,i=r;i<p;i++)f[i]=d[l][i]/y;for(i=r;i<c;i++){for(b=0,s=r;s<p;s++)b+=d[i][s]*d[l][s];for(s=r;s<p;s++)d[i][s]+=b*f[s]}}(v=Math.abs(u[l])+Math.abs(f[l]))>x&&(x=v)}for(l=p-1;-1!=l;l+=-1){if(0!=g){for(y=g*d[l][l+1],i=r;i<p;i++)h[i][l]=d[l][i]/y;for(i=r;i<p;i++){for(b=0,s=r;s<p;s++)b+=d[l][s]*h[s][i];for(s=r;s<p;s++)h[s][i]+=b*h[s][l]}}for(i=r;i<p;i++)h[l][i]=0,h[i][l]=0;h[l][l]=1,g=f[l],r=l}for(l=p-1;-1!=l;l+=-1){for(r=l+1,g=u[l],i=r;i<p;i++)d[l][i]=0;if(0!=g){for(y=d[l][l]*g,i=r;i<p;i++){for(b=0,s=r;s<c;s++)b+=d[s][l]*d[s][i];for(m=b/y,s=l;s<c;s++)d[s][i]+=m*d[s][l]}for(i=l;i<c;i++)d[i][l]=d[i][l]/g}else for(i=l;i<c;i++)d[i][l]=0;d[l][l]+=1}for(a*=x,s=p-1;-1!=s;s+=-1)for(var D=0;D<50;D++){var S=!1;for(r=s;-1!=r;r+=-1){if(Math.abs(f[r])<=a){S=!0;break}if(Math.abs(u[r-1])<=a)break}if(!S){o=0,b=1;var C=r-1;for(l=r;l<s+1&&(m=b*f[l],f[l]=o*f[l],!(Math.abs(m)<=a));l++)for(y=pythag(m,g=u[l]),u[l]=y,o=g/y,b=-m/y,i=0;i<c;i++)v=d[i][C],w=d[i][l],d[i][C]=v*o+w*b,d[i][l]=-v*b+w*o}if(w=u[s],r==s){if(w<0)for(u[s]=-w,i=0;i<p;i++)h[i][s]=-h[i][s];break}if(D>=49)throw"Error: no convergence.";for(x=u[r],g=pythag(m=(((v=u[s-1])-w)*(v+w)+((g=f[s-1])-(y=f[s]))*(g+y))/(2*y*v),1),m=m<0?((x-w)*(x+w)+y*(v/(m-g)-y))/x:((x-w)*(x+w)+y*(v/(m+g)-y))/x,o=1,b=1,l=r+1;l<s+1;l++){for(g=f[l],v=u[l],y=b*g,g*=o,w=pythag(m,y),f[l-1]=w,m=x*(o=m/w)+g*(b=y/w),g=-x*b+g*o,y=v*b,v*=o,i=0;i<p;i++)x=h[i][l-1],w=h[i][l],h[i][l-1]=x*o+w*b,h[i][l]=-x*b+w*o;for(w=pythag(m,y),u[l-1]=w,m=(o=m/w)*g+(b=y/w)*v,x=-b*g+o*v,i=0;i<c;i++)v=d[i][l-1],w=d[i][l],d[i][l-1]=v*o+w*b,d[i][l]=-v*b+w*o}f[r]=0,f[s]=m,u[s]=x}for(l=0;l<u.length;l++)u[l]<a&&(u[l]=0);for(l=0;l<p;l++)for(i=l-1;i>=0;i--)if(u[i]<u[l]){for(o=u[i],u[i]=u[l],u[l]=o,s=0;s<d.length;s++)t=d[s][l],d[s][l]=d[s][i],d[s][i]=t;for(s=0;s<h.length;s++)t=h[s][l],h[s][l]=h[s][i],h[s][i]=t;l=i}return{U:d,S:u,V:h}}function transpose(e){return e[0].map((t,a)=>e.map(e=>e[a]))}const{Matrix:Matrix,solve:solve}=require("../tmp/matrix.js");class Regression{constructor(e,t,a,n=!1){var o=e.slice(0),l=t.slice(0);if(this.n=a,2==a&!n){this.cf=[0,0,0];var i,s=o.length,r=0,d=0,c=0,p=0,f=0,u=0,h=0;for(let e=0;e<s;e++)r+=o[e],d+=o[e]**2,c+=o[e]**3,p+=o[e]**4,f+=l[e],u+=l[e]*o[e],h+=l[e]*o[e]**2;i=this.determinant(s,r,d,r,d,c,d,c,p),this.cf[0]=this.determinant(f,r,d,u,d,c,h,c,p)/i,this.cf[1]=this.determinant(s,f,d,r,u,c,d,h,p)/i,this.cf[2]=this.determinant(s,r,f,r,d,u,d,c,h)/i}else if(1==a&!n){this.cf=[0,0];s=o.length,r=0,d=0,c=0,f=0,u=0;for(let e=0;e<s;e++)r+=o[e],d+=o[e]**2,f+=l[e],u+=l[e]*o[e];this.cf[1]=(a*u-r*f)/(a*d-r*r),this.cf[0]=(f-this.cf[1]*r)/s}else{var m=[];for(let e of o){let t=new Array(a+1);for(let n=0;n<=a;n++)t[n]=e**n;m.push(t)}var g=new Matrix(m),y=Matrix.columnVector(l);this.cf=solve(g,y).flat()}}determinant(e,t,a,n,o,l,i,s,r){return e*(o*r-l*s)-t*(n*r-i*l)+a*(n*s-o*i)}val(e){var t=0;for(let a=0;a<=this.n;a++)t+=this.cf[a]*e**a;return t}}class Spline{constructor(e,t){var a=e.length,n=new Array(a).fill(0),o=new Array(a).fill(0);let l,i;for(let s=1;s<a-1;s++)i=(l=(e[s]-e[s-1])/(e[s+1]-e[s-1]))*n[s-1]+2,n[s]=(l-1)/i,o[s]=(6*((t[s+1]-t[s])/(e[s+1]-e[s])-(t[s]-t[s-1])/(e[s]-e[s-1]))/(e[s+1]-e[s-1])-l*o[s-1])/i;for(let e=a-2;e>-1;e-=1)n[e]=n[e]*n[e+1]+o[e];this.xs=e,this.ys=t,this.diff=n}getVal(e){let t,a,n,o=0;for(;e>this.xs[o];)o++;return o--,t=this.xs[o+1]-this.xs[o],a=(this.xs[o+1]-e)/t,n=(e-this.xs[o])/t,a*this.ys[o]+n*this.ys[o+1]+((a**3-a)*this.diff[o]+(n**3-n)*this.diff[o+1])*t**2/6}}var TOAST={toast:null,_id:0,time:null,init:function(e={}){this.toast=document.createElement("div"),this.toast.id="__TOAST",this.decoration="#8393c0",this.background="rgb(52, 53, 73)",this.color="white",this.time=4e3,Object.assign(this.toast.style,{position:"absolute",top:"0",right:"0",width:"100%",height:"100%",zIndex:"99999",pointerEvents:"none",paddingRight:"3px",paddingBottom:"3px",paddingTop:"3px",borderRadius:"3px",padding:"3px",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-end"});var t=document.querySelector("body");t.insertBefore(this.toast,t.firstChild)},close:function(e){e.classList.add("toastOut"),setTimeout(function(){e.remove()},250)},add:function(e,t){t||(t=this.time);var a=this,n=document.createElement("div");return Object.assign(n.style,{padding:"10px",minHeight:"10px",backgroundColor:this.background,color:"white",float:"right",borderRadius:"3px",boxShadow:"0 1px 19px 0px rgba(0, 0, 0, 0.45)",paddingRight:"50px",position:"relative",marginBottom:"3px",display:"flex",alignItems:"center",color:this.color,transition:"all 250ms ease",opacity:"0",transform:"scale(0.7)",fontFamily:"sans-serif"}),n.innerHTML=`\n            <p style="margin:0;">${e}</p>\n            <div onclick="TOAST.close(this.parentNode);" style="\n                position:absolute;\n                right:0;\n                top:0;\n                width:50px;\n                height:100%;\n                padding-top:3px;\n                padding-bottom:3px;\n                pointer-events: all;\n                cursor: pointer;\n            ">\n                <div style="\n                    display:flex;\n                    justify-content:center;\n                    align-items:center;\n                    width:100%;\n                    height:100%;\n                    border-left-style: solid;\n                    border-width: 1px;\n                    font-family: monospace;\n                    font-size: 1em;\n                    border-color: ${this.decoration};\n                    color: ${this.decoration};\n                ">\n                    X\n                </div>\n            </div>\n        `,this.toast.appendChild(n),setTimeout(function(){a.close(n)},t),n}};function showStatus(e){var t=TOAST.add(e,4321);setTimeout(function(){t.classList.add("toastIn")},50),$(t).width(8*e.length+5)}TOAST.init();