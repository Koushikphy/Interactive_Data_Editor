"use strict";var jexcel=function(el,options){var obj={options:{}},defaults={url:null,data:null,copyCompatibility:!1,rows:[],columns:[],colHeaders:[],colWidths:[],colAlignments:[],nestedHeaders:null,defaultColWidth:50,defaultColAlign:"center",minSpareRows:0,minSpareCols:0,minDimensions:[0,0],allowExport:!0,columnSorting:!0,columnDrag:!1,columnResize:!0,rowResize:!1,rowDrag:!0,editable:!0,allowInsertRow:!0,allowManualInsertRow:!0,allowInsertColumn:!0,allowManualInsertColumn:!0,allowDeleteRow:!0,allowDeletingAllRows:!1,allowDeleteColumn:!0,allowRenameColumn:!0,allowComments:!1,wordWrap:!1,imageOptions:null,csv:null,csvFileName:"jexcel",csvHeaders:!0,csvDelimiter:",",selectionCopy:!0,mergeCells:{},toolbar:null,search:!1,pagination:!1,paginationOptions:null,fullscreen:!1,lazyLoading:!1,loadingSpin:!1,tableOverflow:!1,tableHeight:"300px",tableWidth:null,meta:null,style:null,parseFormulas:!0,autoIncrement:!0,onundo:null,onredo:null,onload:null,onchange:null,onbeforechange:null,onafterchanges:null,onbeforeinsertrow:null,oninsertrow:null,onbeforeinsertcolumn:null,oninsertcolumn:null,onbeforedeleterow:null,ondeleterow:null,onbeforedeletecolumn:null,ondeletecolumn:null,onmoverow:null,onmovecolumn:null,onresizerow:null,onresizecolumn:null,onsort:null,onselection:null,onpaste:null,onbeforepaste:null,onmerge:null,onfocus:null,onblur:null,onchangeheader:null,oneditionstart:null,oneditionend:null,onchangestyle:null,onchangemeta:null,updateTable:null,text:{noRecordsFound:"No records found",showingPage:"Showing page {0} of {1} entries",show:"Show ",search:"Search",entries:" entries",columnName:"Column name",insertANewColumnBefore:"Insert a new column before",insertANewColumnAfter:"Insert a new column after",deleteSelectedColumns:"Delete selected columns",renameThisColumn:"Rename this column",orderAscending:"Order ascending",orderDescending:"Order descending",insertANewRowBefore:"Insert a new row before",insertANewRowAfter:"Insert a new row after",deleteSelectedRows:"Delete selected rows",editComments:"Edit comments",addComments:"Add comments",comments:"Comments",clearComments:"Clear comments",copy:"Copy...",paste:"Paste...",saveAs:"Save as...",about:"About",areYouSureToDeleteTheSelectedRows:"Are you sure to delete the selected rows?",areYouSureToDeleteTheSelectedColumns:"Are you sure to delete the selected columns?",thisActionWillDestroyAnyExistingMergedCellsAreYouSure:"This action will destroy any existing merged cells. Are you sure?",thisActionWillClearYourSearchResultsAreYouSure:"This action will clear your search results. Are you sure?",thereIsAConflictWithAnotherMergedCell:"There is a conflict with another merged cell",invalidMergeProperties:"Invalid merged properties",cellAlreadyMerged:"Cell already merged",noCellsSelected:"No cells selected"},about:"jExcel CE Spreadsheet\nVersion 3.6.0\nAuthor: Paul Hodel <paul.hodel@gmail.com>\nWebsite: https://bossanova.uk/jexcel/v3"};for(var property in defaults)options&&options.hasOwnProperty(property)?obj.options[property]="text"==property?Object.assign(defaults[property],options[property]):options[property]:obj.options[property]=defaults[property];obj.el=el,obj.corner=null,obj.contextMenu=null,obj.textarea=null,obj.ads=null,obj.content=null,obj.table=null,obj.thead=null,obj.tbody=null,obj.rows=[],obj.results=null,obj.searchInput=null,obj.toolbar=null,obj.pagination=null,obj.pageNumber=null,obj.headerContainer=null,obj.colgroupContainer=null,obj.headers=[],obj.records=[],obj.history=[],obj.formula=[],obj.colgroup=[],obj.selection=[],obj.highlighted=[],obj.selectedCell=null,obj.selectedContainer=null,obj.style=[],obj.data=null,obj.cursor=null,obj.historyIndex=-1,obj.ignoreEvents=!1,obj.ignoreHistory=!1,obj.edition=null,obj.hashString=null,obj.resizing=null,obj.dragging=null,1==obj.options.lazyLoading&&0==obj.options.tableOverflow&&0==obj.options.fullscreen&&(console.error("JEXCEL: The lazyloading only works when tableOverflow = yes or fullscreen = yes"),obj.options.lazyLoading=!1),obj.prepareTable=function(){var e=obj.options.columns.length;if(obj.options.data&&void 0!==obj.options.data[0]){var o=Object.keys(obj.options.data[0]);o.length>e&&(e=o.length)}obj.options.minDimensions[0]>e&&(e=obj.options.minDimensions[0]);for(var t=[],r=0;r<e;r++)obj.options.colHeaders[r]||(obj.options.colHeaders[r]=""),obj.options.colWidths[r]||(obj.options.colWidths[r]=obj.options.defaultColWidth),obj.options.colAlignments[r]||(obj.options.colAlignments[r]=obj.options.defaultColAlign),obj.options.columns[r]?obj.options.columns[r].type||(obj.options.columns[r].type="text"):obj.options.columns[r]={type:"text"},obj.options.columns[r].name||(obj.options.columns[r].name=o&&o[r]?o[r]:r),obj.options.columns[r].source||(obj.options.columns[r].source=[]),obj.options.columns[r].options||(obj.options.columns[r].options=[]),obj.options.columns[r].editor||(obj.options.columns[r].editor=null),obj.options.columns[r].allowEmpty||(obj.options.columns[r].allowEmpty=!1),obj.options.columns[r].title||(obj.options.columns[r].title=obj.options.colHeaders[r]?obj.options.colHeaders[r]:""),obj.options.columns[r].width||(obj.options.columns[r].width=obj.options.colWidths[r]?obj.options.colWidths[r]:"50"),obj.options.columns[r].align||(obj.options.columns[r].align=obj.options.colAlignments[r]?obj.options.colAlignments[r]:"center"),"autocomplete"==obj.options.columns[r].type||"dropdown"==obj.options.columns[r].type?obj.options.columns[r].url&&t.push(jSuites.ajax({url:obj.options.columns[r].url,index:r,method:"GET",dataType:"json",multiple:t,success:function(e){for(var o=0;o<e.length;o++)obj.options.columns[this.index].source.push(e[o])},complete:function(){obj.createTable()}})):"calendar"==obj.options.columns[r].type&&(obj.options.columns[r].options.format||(obj.options.columns[r].options.format="DD/MM/YYYY"));t.length||obj.createTable()},obj.createTable=function(){obj.prepareData(),obj.table=document.createElement("table"),obj.thead=document.createElement("thead"),obj.tbody=document.createElement("tbody"),obj.headers=[],obj.colgroup=[],obj.content=document.createElement("div"),obj.content.classList.add("jexcel_content"),obj.toolbar=document.createElement("div"),obj.toolbar.classList.add("jexcel_toolbar");var e=document.createElement("div"),o=document.createTextNode(obj.options.text.search+": ");obj.searchInput=document.createElement("input"),obj.searchInput.classList.add("jexcel_search"),e.appendChild(o),e.appendChild(obj.searchInput),obj.searchInput.onfocus=function(){obj.resetSelection()};var t,r=document.createElement("div");if(obj.options.pagination>0&&obj.options.paginationOptions&&obj.options.paginationOptions.length>0){obj.paginationDropdown=document.createElement("select"),obj.paginationDropdown.classList.add("jexcel_pagination_dropdown"),obj.paginationDropdown.onchange=function(){obj.options.pagination=parseInt(this.value),obj.page(0)};for(var n=0;n<obj.options.paginationOptions.length;n++){var l=document.createElement("option");l.value=obj.options.paginationOptions[n],l.innerHTML=obj.options.paginationOptions[n],obj.paginationDropdown.appendChild(l)}r.appendChild(document.createTextNode(obj.options.text.show)),r.appendChild(obj.paginationDropdown),r.appendChild(document.createTextNode(obj.options.text.entries))}if(obj.filter=document.createElement("div"),obj.filter.classList.add("jexcel_filter"),obj.filter.appendChild(r),obj.filter.appendChild(e),obj.colgroupContainer=document.createElement("colgroup"),(t=document.createElement("col")).setAttribute("width",50),obj.colgroupContainer.appendChild(t),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var s=0;s<obj.options.nestedHeaders.length;s++)obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders[s]));else obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders));obj.headerContainer=document.createElement("tr"),(t=document.createElement("td")).classList.add("jexcel_selectall"),obj.headerContainer.appendChild(t);for(n=0;n<obj.options.columns.length;n++)obj.createCellHeader(n),obj.headerContainer.appendChild(obj.headers[n]),obj.colgroupContainer.appendChild(obj.colgroup[n]);obj.thead.appendChild(obj.headerContainer),obj.table=document.createElement("table"),obj.table.classList.add("jexcel"),obj.table.setAttribute("cellpadding","0"),obj.table.setAttribute("cellspacing","0"),obj.table.setAttribute("unselectable","yes"),obj.table.setAttribute("onselectstart","return false"),obj.table.appendChild(obj.colgroupContainer),obj.table.appendChild(obj.thead),obj.table.appendChild(obj.tbody),obj.corner=document.createElement("div"),obj.corner.className="jexcel_corner",obj.corner.setAttribute("unselectable","on"),obj.corner.setAttribute("onselectstart","return false"),0==obj.options.selectionCopy&&(obj.corner.style.display="none"),obj.textarea=document.createElement("textarea"),obj.textarea.className="jexcel_textarea",obj.textarea.id="jexcel_textarea",obj.contextMenu=document.createElement("div"),obj.contextMenu.className="jexcel_contextmenu",jSuites.contextmenu(obj.contextMenu,{onclick:function(){obj.contextMenu.contextmenu.close(!1)}});var i='<a href="https://bossanova.uk/jexcel/">jExcel Spreadsheet</a>';obj.ads=document.createElement("div"),obj.ads.className="jexcel_about","undefined"!=typeof sessionStorage?sessionStorage.getItem("jexcel")||(sessionStorage.setItem("jexcel",!0),obj.ads.innerHTML=i):obj.ads.innerHTML=i,document.createElement("div").classList.add("jexcel_table"),obj.pagination=document.createElement("div"),obj.pagination.classList.add("jexcel_pagination");var a=document.createElement("div"),u=document.createElement("div");obj.pagination.appendChild(a),obj.pagination.appendChild(u),1==obj.options.search&&el.appendChild(obj.filter),obj.content.appendChild(obj.table),obj.content.appendChild(obj.corner),obj.content.appendChild(obj.textarea),el.appendChild(obj.toolbar),el.appendChild(obj.content),el.appendChild(obj.pagination),el.appendChild(obj.contextMenu),el.appendChild(obj.ads),el.classList.add("jexcel_container"),obj.options.toolbar&&obj.options.toolbar.length&&obj.createToolbar(),1==obj.options.fullscreen?el.classList.add("fullscreen"):1==obj.options.tableOverflow&&(obj.options.tableHeight&&(obj.content.style["overflow-y"]="auto",obj.content.style.height=obj.options.tableHeight),obj.options.tableWidth&&(obj.content.style["overflow-x"]="auto",obj.content.style.width=obj.options.tableWidth)),1!=obj.options.tableOverflow&&obj.options.toolbar&&el.classList.add("with-toolbar"),1==obj.options.columnDrag&&obj.thead.classList.add("draggable"),1==obj.options.columnResize&&obj.thead.classList.add("resizable"),1==obj.options.rowDrag&&obj.tbody.classList.add("draggable"),1==obj.options.rowResize&&obj.tbody.classList.add("resizable"),obj.setData(),obj.options.style&&obj.setStyle(obj.options.style,null,null,1,1)},obj.prepareData=function(){var e=[];if(obj.options.data){for(var o=0;o<obj.options.data.length;o++){for(var t=[],r=0;r<obj.options.columns.length;r++)t[r]=obj.options.data[o][obj.options.columns[r].name];e.push(t)}obj.options.data=e}},obj.setData=function(e){e&&("string"==typeof e&&(e=JSON.parse(e)),obj.options.data=e),obj.options.data||(obj.options.data=[]);var o=0,t=0,r=obj.options.columns.length,n=obj.options.data.length,l=obj.options.minDimensions[0],s=obj.options.minDimensions[1],i=l>r?l:r,a=s>n?s:n;for(o=0;o<a;o++)for(t=0;t<i;t++)void 0==obj.options.data[o]&&(obj.options.data[o]=[]),void 0==obj.options.data[o][t]&&(obj.options.data[o][t]="");if(obj.rows=[],obj.results=null,obj.records=[],obj.history=[],obj.historyIndex=-1,obj.tbody.innerHTML="",1==obj.options.lazyLoading){var u=0,c=obj.options.data.length<100?obj.options.data.length:100;obj.options.pagination&&(obj.options.pagination=!1,console.error("JEXCEL: Pagination will be disable due the lazyLoading"))}else if(obj.options.pagination){obj.pageNumber||(obj.pageNumber=0);obj.options.pagination;u=obj.options.pagination*obj.pageNumber,c=obj.options.pagination*obj.pageNumber+obj.options.pagination,obj.options.data.length<c&&(c=obj.options.data.length)}else u=0,c=obj.options.data.length;for(o=0;o<obj.options.data.length;o++){var d=obj.createRow(o,obj.options.data[o]);o>=u&&o<c&&obj.tbody.appendChild(d)}if(1==obj.options.lazyLoading||obj.options.pagination&&obj.updatePagination(),obj.options.mergeCells){var b=Object.keys(obj.options.mergeCells);for(t=0;t<b.length;t++){var j=obj.options.mergeCells[b[t]];obj.setMerge(b[t],j[0],j[1],1)}}obj.updateTable(),obj.ignoreEvents||"function"==typeof obj.options.onload&&obj.options.onload(el,obj)},obj.getData=function(e){for(var o=[],t=0,r=0,n=obj.options.columns.length,l=obj.options.data.length,s=0;s<l;s++){t=0;for(var i=0;i<n;i++)e&&!obj.records[s][i].classList.contains("highlight")||(o[r]||(o[r]=[]),1==obj.options.copyCompatibility?o[r][t]=obj.records[s][i].innerHTML:o[r][t]=obj.options.data[s][i],t++);t>0&&r++}return o},obj.getJson=function(e){for(var o=[],t=obj.options.columns.length,r=obj.options.data.length,n=0;n<r;n++){for(var l=null,s=0;s<t;s++)e&&!obj.records[n][s].classList.contains("highlight")||(null==l&&(l={}),l[obj.options.columns[s].name]=obj.options.data[n][s]);null!=l&&o.push(l)}return o},obj.getRowData=function(e){return obj.options.data[e]},obj.setRowData=function(e,o){for(var t=0;t<obj.headers.length;t++){var r=jexcel.getColumnNameFromId([t,e]);obj.setValue(r,o[t])}},obj.getColumnData=function(e){for(var o=[],t=0;t<obj.options.data.length;t++)o.push(obj.options.data[t][e]);return o},obj.createRow=function(e,o){if(obj.records[e]||(obj.records[e]=[]),!o)o=obj.options.data[e];obj.rows[e]=document.createElement("tr"),obj.rows[e].setAttribute("data-y",e),obj.options.rows[e]&&obj.options.rows[e].height&&(obj.rows[e].style.height=obj.options.rows[e].height);var t=document.createElement("td");for(t.innerHTML=parseInt(e+1),t.setAttribute("data-y",e),t.className="jexcel_row",obj.rows[e].appendChild(t),i=0;i<obj.options.columns.length;i++)obj.records[e][i]=obj.createCell(i,e,o[i]),obj.rows[e].appendChild(obj.records[e][i]);return obj.rows[e]},obj.createCell=function(e,o,t){var r=document.createElement("td");if(r.setAttribute("data-x",e),r.setAttribute("data-y",o),"hidden"==obj.options.columns[e].type)r.style.display="none",r.innerHTML=t;else if("checkbox"==obj.options.columns[e].type||"radio"==obj.options.columns[e].type){var n=document.createElement("input");n.type=obj.options.columns[e].type,n.name="c"+e,n.checked=1==t||1==t||"true"==t,n.onclick=function(){obj.setValue(r,this.checked)},1==obj.options.columns[e].readOnly&&n.setAttribute("disabled","disabled"),r.appendChild(n),obj.options.data[o][e]=n.checked}else if("calendar"==obj.options.columns[e].type){var l=jSuites.calendar.extractDateFromString(t,obj.options.columns[e].options.format);r.innerHTML=jSuites.calendar.getDateString(l||t,obj.options.columns[e].options.format)}else if("dropdown"==obj.options.columns[e].type||"autocomplete"==obj.options.columns[e].type)r.classList.add("dropdown"),r.innerHTML=obj.getDropDownValue(e,t);else if("color"==obj.options.columns[e].type)if("square"==obj.options.columns[e].render){var s=document.createElement("div");s.className="color",s.style.backgroundColor=t,r.appendChild(s)}else r.style.color=t,r.innerHTML=t;else if("image"==obj.options.columns[e].type){if(t&&"data:image"==t.substr(0,10)){var i=document.createElement("img");i.src=t,r.appendChild(i)}}else{if("="==(""+t).substr(0,1)&&1==obj.options.parseFormulas&&(t=obj.executeFormula(t,e,o)),obj.options.columns[e].mask){var a=obj.options.columns[e].decimal||".";t=""+jSuites.mask.run(t,obj.options.columns[e].mask,a)}r.innerHTML=t}1==obj.options.columns[e].readOnly&&(r.className="readonly");var u=obj.options.columns[e].align?obj.options.columns[e].align:"center";return r.style.textAlign=u,0!=obj.options.columns[e].wordWrap&&(1==obj.options.wordWrap||1==obj.options.columns[e].wordWrap||r.innerHTML.length>200)&&(r.style.whiteSpace="pre-wrap"),e>0&&(t||r.innerHTML?obj.records[o][e-1].style.overflow="hidden":e==obj.options.columns.length-1&&(r.style.overflow="hidden")),r},obj.createCellHeader=function(e){var o=obj.options.columns[e].width?obj.options.columns[e].width:obj.options.defaultColWidth,t=obj.options.columns[e].align?obj.options.columns[e].align:obj.options.defaultColAlign;obj.headers[e]=document.createElement("td"),obj.headers[e].innerHTML=obj.options.columns[e].title?obj.options.columns[e].title:jexcel.getColumnName(e),obj.headers[e].setAttribute("data-x",e),obj.headers[e].style.textAlign=t,obj.options.columns[e].title&&obj.headers[e].setAttribute("title",obj.options.columns[e].title),obj.colgroup[e]=document.createElement("col"),obj.colgroup[e].setAttribute("width",o),"hidden"==obj.options.columns[e].type&&(obj.headers[e].style.display="none",obj.colgroup[e].style.display="none")},obj.createNestedHeader=function(e){var o=document.createElement("tr");o.classList.add("jexcel_nested");var t=document.createElement("td");o.appendChild(t);for(var r=0,n=0;n<e.length;n++){e[n].colspan||(e[n].colspan=1),e[n].align||(e[n].align="center"),e[n].title||(e[n].title="");for(var l=e[n].colspan,s=[],i=0;i<l;i++)obj.options.columns[r]&&"hidden"==obj.options.columns[r].type&&l++,s.push(r),r++;(t=document.createElement("td")).setAttribute("data-column",s.join(",")),t.setAttribute("colspan",e[n].colspan),t.setAttribute("align",e[n].align),t.innerHTML=e[n].title,o.appendChild(t)}return o},obj.createToolbar=function(e){if(e)obj.options.toolbar=e;else e=obj.options.toolbar;for(var o=0;o<e.length;o++){if("i"==e[o].type)(n=document.createElement("i")).classList.add("jexcel_toolbar_item"),n.classList.add("material-icons"),n.setAttribute("data-k",e[o].k),n.setAttribute("data-v",e[o].v),e[o].tooltip&&n.setAttribute("title",e[o].tooltip),e[o].onclick&&(e[o].onclick,1)?n.onclick=e[o].onclick:n.onclick=function(){var e=this.getAttribute("data-k"),o=this.getAttribute("data-v");obj.setStyle(obj.highlighted,e,o)},n.innerHTML=e[o].content,obj.toolbar.appendChild(n);else if("select"==e[o].type){(n=document.createElement("select")).classList.add("jexcel_toolbar_item"),n.setAttribute("data-k",e[o].k),e[o].tooltip&&n.setAttribute("title",e[o].tooltip),e[o].onchange&&(e[o].onchange,1)?n.onchange=e[o].onchange:n.onchange=function(){var e=this.getAttribute("data-k");obj.setStyle(obj.highlighted,e,this.value)};for(var t=0;t<e[o].v.length;t++){var r=document.createElement("option");r.value=e[o].v[t],r.innerHTML=e[o].v[t],n.appendChild(r)}obj.toolbar.appendChild(n)}else if("color"==e[o].type){var n;(n=document.createElement("i")).classList.add("jexcel_toolbar_item"),n.classList.add("material-icons"),n.setAttribute("data-k",e[o].k),n.setAttribute("data-v",""),e[o].tooltip&&n.setAttribute("title",e[o].tooltip),obj.toolbar.appendChild(n),n.onclick=function(){this.color.open()},n.innerHTML=e[o].content,jSuites.color(n,{onchange:function(e,o){var t=e.getAttribute("data-k");obj.setStyle(obj.highlighted,t,o)}})}}},obj.openEditor=function(e,o,t){var r=e.getAttribute("data-y"),n=e.getAttribute("data-x");obj.ignoreEvents||"function"==typeof obj.options.oneditionstart&&obj.options.oneditionstart(el,e,n,r),n>0&&(obj.records[r][n-1].style.overflow="hidden");var l=function(o){var t=e.getBoundingClientRect(),r=document.createElement(o);return r.style.width=t.width+"px",r.style.height=t.height-2+"px",r.style.minHeight=t.height-2+"px",e.classList.add("editor"),e.innerHTML="",e.appendChild(r),r};if(1==e.classList.contains("readonly"));else if(obj.edition=[obj.records[r][n],obj.records[r][n].innerHTML,n,r],obj.options.columns[n].editor)obj.options.columns[n].editor.openEditor(e,el);else if("hidden"==obj.options.columns[n].type);else if("checkbox"==obj.options.columns[n].type||"radio"==obj.options.columns[n].type){var s=!e.children[0].checked;obj.setValue(e,s),obj.edition=null}else if("dropdown"==obj.options.columns[n].type||"autocomplete"==obj.options.columns[n].type){s=obj.options.data[r][n];if("function"==typeof obj.options.columns[n].filter)var i=obj.options.columns[n].filter(el,e,n,r,obj.options.columns[n].source);else i=obj.options.columns[n].source;var a=l("div"),u={data:i,multiple:!!obj.options.columns[n].multiple,autocomplete:!(!obj.options.columns[n].autocomplete&&"autocomplete"!=obj.options.columns[n].type),opened:!0,value:obj.options.columns[n].multiple?s.split(";"):s,width:"100%",height:a.style.minHeight,position:1==obj.options.tableOverflow||1==obj.options.fullscreen,onclose:function(){obj.closeEditor(e,!0)}};obj.options.columns[n].options&&obj.options.columns[n].options.type&&(u.type=obj.options.columns[n].options.type),jSuites.dropdown(a,u)}else if("calendar"==obj.options.columns[n].type||"color"==obj.options.columns[n].type){s=obj.options.data[r][n];if((a=l("input")).value=s,1!=obj.options.tableOverflow&&1!=obj.options.fullscreen||(obj.options.columns[n].options.position=!0),obj.options.columns[n].options.value=obj.options.data[r][n],obj.options.columns[n].options.opened=!0,obj.options.columns[n].options.onclose=function(o,t){obj.closeEditor(e,!0)},"color"==obj.options.columns[n].type)jSuites.color(a,obj.options.columns[n].options);else jSuites.calendar(a,obj.options.columns[n].options).setValue(s);a.focus()}else if("image"==obj.options.columns[n].type){var c=e.children[0];(a=l("div")).style.position="relative";var d=document.createElement("div");d.classList.add("jclose"),c&&c.src&&d.appendChild(c),a.appendChild(d),jSuites.image(d,obj.options.imageOptions);const o=e.getBoundingClientRect(),t=d.getBoundingClientRect();window.innerHeight<o.bottom+t.height?d.style.top=o.top-(t.height+2)+"px":d.style.top=o.top+"px"}else{s=1==o?"":obj.options.data[r][n];if(0==obj.options.columns[n].wordWrap||1!=obj.options.wordWrap&&1!=obj.options.columns[n].wordWrap){a=l("input");obj.options.columns[n].mask&&a.setAttribute("data-mask",obj.options.columns[n].mask)}else var a=l("textarea");a.value=s,a.onblur=function(){obj.closeEditor(e,!0)},a.focus()}},obj.closeEditor=function(e,o){var t=parseInt(e.getAttribute("data-x")),r=parseInt(e.getAttribute("data-y"));if(1==o){if(obj.options.columns[t].editor)var n=obj.options.columns[t].editor.closeEditor(e,o);else if("checkbox"==obj.options.columns[t].type||"radio"==obj.options.columns[t].type||"hidden"==obj.options.columns[t].type);else if("dropdown"==obj.options.columns[t].type||"autocomplete"==obj.options.columns[t].type)n=e.children[0].dropdown.close(!0);else if("calendar"==obj.options.columns[t].type)n=e.children[0].calendar.close(!0);else if("color"==obj.options.columns[t].type)n=e.children[1].color.close(!0);else if("image"==obj.options.columns[t].type){var l=e.children[0].children[0].children[0];n=l&&"IMG"==l.tagName?l.src:""}else if("numeric"==obj.options.columns[t].type){"="!=(n=e.children[0].value).substr(0,1)&&""==n&&(n=obj.options.columns[t].allowEmpty?"":0),e.children[0].onblur=null}else{n=e.children[0].value;e.children[0].onblur=null}obj.options.data[r][t]==n?e.innerHTML=obj.edition[1]:obj.setValue(e,n)}else obj.options.columns[t].editor?obj.options.columns[t].editor.closeEditor(e,o):"dropdown"==obj.options.columns[t].type||"autocomplete"==obj.options.columns[t].type?e.children[0].dropdown.close(!0):"calendar"==obj.options.columns[t].type?e.children[0].calendar.close(!0):"color"==obj.options.columns[t].type?e.children[1].color.close(!0):e.children[0].onblur=null,e.innerHTML=obj.edition&&obj.edition[1]?obj.edition[1]:"";obj.ignoreEvents||"function"==typeof obj.options.oneditionend&&obj.options.oneditionend(el,e,t,r,n,o),e.classList.remove("editor"),obj.edition=null},obj.getCell=function(e){var o=(e=jexcel.getIdFromColumnName(e,!0))[0],t=e[1];return obj.records[t][o]},obj.getLabel=function(e){var o=(e=jexcel.getIdFromColumnName(e,!0))[0],t=e[1];return obj.records[t][o].innerHTML},obj.getValue=function(e,o){if("object"==typeof e)var t=e.getAttribute("data-x"),r=e.getAttribute("data-y");else t=(e=jexcel.getIdFromColumnName(e,!0))[0],r=e[1];var n=null;return null!=t&&null!=r&&(obj.records[r]&&obj.records[r][t]&&(o||1==obj.options.copyCompatibility)?n=obj.records[r][t].innerHTML:obj.options.data[r]&&"undefined"!=obj.options.data[r][t]&&(n=obj.options.data[r][t])),n},obj.getValueFromCoords=function(e,o,t){var r=null;return null!=e&&null!=o&&(obj.records[o]&&obj.records[o][e]&&t||1==obj.options.copyCompatibility?r=obj.records[o][e].innerHTML:obj.options.data[o]&&"undefined"!=obj.options.data[o][e]&&(r=obj.options.data[o][e])),r},obj.setValue=function(e,o,t){var r=[];if("string"==typeof e){var n=(a=jexcel.getIdFromColumnName(e,!0))[0],l=a[1];r.push(obj.updateCell(n,l,o,t)),obj.updateFormulaChain(n,l,r)}else{n=null,l=null;if(e&&e.getAttribute)n=e.getAttribute("data-x"),l=e.getAttribute("data-y");if(null!=n&&null!=l)r.push(obj.updateCell(n,l,o,t)),obj.updateFormulaChain(n,l,r);else{var s=Object.keys(e);if(s.length>0)for(var i=0;i<s.length;i++){if("string"==typeof e[i]){var a;n=(a=jexcel.getIdFromColumnName(e[i],!0))[0],l=a[1]}else n=e[i].getAttribute("data-x"),l=e[i].getAttribute("data-y");null!=n&&null!=l&&(r.push(obj.updateCell(n,l,o,t)),obj.updateFormulaChain(n,l,r))}}}obj.setHistory({action:"setValue",records:r,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,r)},obj.setValueFromCoords=function(e,o,t,r){var n=[];n.push(obj.updateCell(e,o,t,r)),obj.updateFormulaChain(e,o,n),obj.setHistory({action:"setValue",records:n,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,n)},obj.setCheckRadioValue=function(){for(var e=[],o=Object.keys(obj.highlighted),t=0;t<o.length;t++){var r=obj.highlighted[t].getAttribute("data-x"),n=obj.highlighted[t].getAttribute("data-y");"checkbox"!=obj.options.columns[r].type&&"radio"!=obj.options.columns[r].type||e.push(obj.updateCell(r,n,!obj.options.data[n][r]))}e.length&&(obj.setHistory({action:"setValue",records:e,selection:obj.selectedCell}),obj.onafterchanges(el,e))},obj.updateCell=function(e,o,t,r){if(1!=obj.records[o][e].classList.contains("readonly")||r){if(!obj.ignoreEvents&&"function"==typeof obj.options.onbeforechange){var n=obj.options.onbeforechange(el,obj.records[o][e],e,o,t);void 0!=n&&(t=n)}var l={col:e,row:o,newValue:t,oldValue:obj.options.data[o][e]};if(obj.options.columns[e].editor)obj.options.data[o][e]=t,obj.options.columns[e].editor.setValue(obj.records[o][e],t,r);else if("checkbox"==obj.options.columns[e].type||"radio"==obj.options.columns[e].type){if("radio"==obj.options.columns[e].type)for(var s=0;s<obj.options.data.length;s++)obj.options.data[s][e]=!1;obj.records[o][e].children[0].checked=1==t||1==t||"true"==t||"TRUE"==t,obj.options.data[o][e]=obj.records[o][e].children[0].checked}else if("dropdown"==obj.options.columns[e].type||"autocomplete"==obj.options.columns[e].type)obj.options.data[o][e]=t,obj.records[o][e].innerHTML=obj.getDropDownValue(e,t);else if("calendar"==obj.options.columns[e].type){var i=jSuites.calendar.extractDateFromString(t,obj.options.columns[e].options.format);obj.options.data[o][e]=t,obj.records[o][e].innerHTML=jSuites.calendar.getDateString(i||t,obj.options.columns[e].options.format)}else if("color"==obj.options.columns[e].type)if(obj.options.data[o][e]=t,"square"==obj.options.columns[e].render){var a=document.createElement("div");a.className="color",a.style.backgroundColor=t,obj.records[o][e].innerHTML="",obj.records[o][e].appendChild(a)}else obj.records[o][e].style.color=t,obj.records[o][e].innerHTML=t;else if("image"==obj.options.columns[e].type){if(t=""+t,obj.options.data[o][e]=t,obj.records[o][e].innerHTML="",t&&"data:image"==t.substr(0,10)){var u=document.createElement("img");u.src=t,obj.records[o][e].appendChild(u)}}else{if(obj.options.data[o][e]=t,"="==(""+t).substr(0,1)&&1==obj.options.parseFormulas&&(t=obj.executeFormula(t,e,o)),obj.options.columns[e].mask){var c=obj.options.columns[e].decimal||".";t=""+jSuites.mask.run(t,obj.options.columns[e].mask,c)}obj.records[o][e].innerHTML=t,0!=obj.options.columns[e].wordWrap&&(1==obj.options.wordWrap||1==obj.options.columns[e].wordWrap||obj.records[o][e].innerHTML.length>200)?obj.records[o][e].style.whiteSpace="pre-wrap":obj.records[o][e].style.whiteSpace=""}e>0&&(obj.options.data[o][e]||"text"!=obj.options.columns[e].type&&"number"!=obj.options.columns[e].type?obj.records[o][e-1].style.overflow="hidden":obj.records[o][e-1].style.overflow=""),obj.ignoreEvents||"function"==typeof obj.options.onchange&&obj.options.onchange(el,obj.records[o]&&obj.records[o][e]?obj.records[o][e]:null,e,o,t,l.oldValue)}else;return l},obj.copyData=function(e,o){for(var t=obj.getData(!0),r=obj.selectedContainer[1],n=obj.selectedContainer[3],l=parseInt(e.getAttribute("data-x")),s=parseInt(e.getAttribute("data-y")),i=parseInt(o.getAttribute("data-x")),a=parseInt(o.getAttribute("data-y")),u=[],c=1,d=!1,b=0,j=0,p=s;p<=a;p++)if(!obj.rows[p]||"none"!=obj.rows[p].style.display){void 0==t[j]&&(j=0),b=0;for(var f=l;f<=i;f++){if(obj.records[p][f]&&!obj.records[p][f].classList.contains("readonly")&&"none"!=obj.records[p][f].style.display&&0==d){if(!obj.selection.length&&""!=obj.options.data[p][f]){d=!0;continue}if(void 0==t[j])b=0;else if(void 0==t[j][b])b=0;else var g=t[j][b];if(g&&r==n&&1==obj.options.autoIncrement)if("text"==obj.options.columns[f].type||"number"==obj.options.columns[f].type)if("="==(""+g).substr(0,1)){var h=g.match(/([A-Z]+[0-9]+)/g);if(h){for(var m=[],C=0;C<h.length;C++){var x=jexcel.getIdFromColumnName(h[C],1);x[1]+=c;var v=jexcel.getColumnNameFromId([x[0],x[1]]);v!=h[C]&&(m[h[C]]=v)}m&&(g=obj.updateFormula(g,m))}}else g==Number(g)&&(g=Number(g)+c);else if("calendar"==obj.options.columns[f].type){var y=new Date(g);y.setDate(y.getDate()+c),g=y.getFullYear()+"-"+parseInt(y.getMonth()+1)+"-"+y.getDate()+" "+y.getHours()+":"+y.getMinutes()+":00"}u.push(obj.updateCell(f,p,g)),obj.updateFormulaChain(f,p,u)}b++}j++,c++}obj.setHistory({action:"setValue",records:u,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,u)},obj.refreshSelection=function(){obj.selectedCell&&obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.conditionalSelectionUpdate=function(e,o,t){if(1==e){if(obj.selectedCell&&(o>=obj.selectedCell[1]&&o<=obj.selectedCell[3]||t>=obj.selectedCell[1]&&t<=obj.selectedCell[3]))return void obj.resetSelection()}else if(obj.selectedCell&&(o>=obj.selectedCell[0]&&o<=obj.selectedCell[2]||t>=obj.selectedCell[0]&&t<=obj.selectedCell[2]))return void obj.resetSelection()},obj.resetSelection=function(e){if(obj.highlighted.length){u=1;for(var o=0;o<obj.highlighted.length;o++){obj.highlighted[o].classList.remove("highlight"),obj.highlighted[o].classList.remove("highlight-left"),obj.highlighted[o].classList.remove("highlight-right"),obj.highlighted[o].classList.remove("highlight-top"),obj.highlighted[o].classList.remove("highlight-bottom"),obj.highlighted[o].classList.remove("highlight-selected");var t=parseInt(obj.highlighted[o].getAttribute("data-x")),r=parseInt(obj.highlighted[o].getAttribute("data-y"));if(obj.highlighted[o].getAttribute("data-merged"))var n=parseInt(obj.highlighted[o].getAttribute("colspan")),l=parseInt(obj.highlighted[o].getAttribute("rowspan")),s=n>0?t+(n-1):t,i=l>0?r+(l-1):r;else s=t,i=r;for(var a=t;a<=s;a++)obj.headers[a]&&obj.headers[a].classList.remove("selected");for(a=r;a<=i;a++)obj.rows[a]&&obj.rows[a].classList.remove("selected")}}else var u=0;return obj.highlighted=[],obj.selectedCell=null,obj.corner.style.top="-2000px",obj.corner.style.left="-2000px",1!=obj.ignoreEvents&&1==e&&obj.options.onblur&&"function"==typeof obj.options.onblur&&1==u&&obj.options.onblur(el),u},obj.updateSelection=function(e,o,t){var r=e.getAttribute("data-x"),n=e.getAttribute("data-y");if(o)var l=o.getAttribute("data-x"),s=o.getAttribute("data-y");else l=r,s=n;obj.updateSelectionFromCoords(r,n,l,s,t)},obj.updateSelectionFromCoords=function(e,o,t,r,n){var l=obj.resetSelection();if(null==t&&(t=e),null==r&&(r=o),e>=obj.headers.length&&(e=obj.headers.length-1),o>=obj.rows.length&&(o=obj.rows.length-1),t>=obj.headers.length&&(t=obj.headers.length-1),r>=obj.rows.length&&(r=obj.rows.length-1),obj.selectedCell=[e,o,t,r],null!=e){if(obj.records[o][e]&&obj.records[o][e].classList.add("highlight-selected"),parseInt(e)<parseInt(t))var s=parseInt(e),i=parseInt(t);else s=parseInt(t),i=parseInt(e);if(parseInt(o)<parseInt(r))var a=parseInt(o),u=parseInt(r);else a=parseInt(r),u=parseInt(o);for(var c=s;c<=i;c++)for(var d=a;d<=u;d++)if(obj.records[d][c]&&obj.records[d][c].getAttribute("data-merged")){var b=parseInt(obj.records[d][c].getAttribute("data-x")),j=parseInt(obj.records[d][c].getAttribute("data-y")),p=parseInt(obj.records[d][c].getAttribute("colspan")),f=parseInt(obj.records[d][c].getAttribute("rowspan"));p>1&&(b<s&&(s=b),b+p>i&&(i=b+p-1)),f&&(j<a&&(a=j),j+f>u&&(u=j+f-1))}var g=null,h=null,m=null,C=null;for(d=a;d<=u;d++)"none"!=obj.rows[d].style.display&&(null==m&&(m=d),C=d);for(c=s;c<=i;c++){for(d=a;d<=u;d++)"none"!=obj.rows[d].style.display&&"none"!=obj.records[d][c].style.display&&(obj.records[d][c].classList.add("highlight"),obj.highlighted.push(obj.records[d][c]));"hidden"!=obj.options.columns[c].type&&(null==g&&(g=c),h=c)}g||(g=0),h||(h=0);for(c=g;c<=h;c++)"hidden"!=obj.options.columns[c].type&&(obj.records[m][c]&&obj.records[m][c].classList.add("highlight-top"),obj.records[C][c]&&obj.records[C][c].classList.add("highlight-bottom"),obj.headers[c].classList.add("selected"));for(d=m;d<=C;d++)"none"!=obj.rows[d].style.display&&(obj.records[d][g].classList.add("highlight-left"),obj.records[d][h].classList.add("highlight-right"),obj.rows[d].classList.add("selected"));obj.selectedContainer=[g,m,h,C]}1!=obj.ignoreEvents&&(obj.options.onfocus&&"function"==typeof obj.options.onfocus&&0==l&&obj.options.onfocus(el),"function"==typeof obj.options.onselection&&obj.options.onselection(el,g,m,h,C,n)),obj.updateCornerPosition()},obj.removeCopySelection=function(){for(var e=0;e<obj.selection.length;e++)obj.selection[e].classList.remove("selection"),obj.selection[e].classList.remove("selection-left"),obj.selection[e].classList.remove("selection-right"),obj.selection[e].classList.remove("selection-top"),obj.selection[e].classList.remove("selection-bottom");obj.selection=[]},obj.updateCopySelection=function(e,o){obj.removeCopySelection();var t=obj.selectedContainer[0],r=obj.selectedContainer[1],n=obj.selectedContainer[2],l=obj.selectedContainer[3];if(e&&o){if(e-n>0)var s=parseInt(n)+1,i=parseInt(e);else s=parseInt(e),i=parseInt(t)-1;if(o-l>0)var a=parseInt(l)+1,u=parseInt(o);else a=parseInt(o),u=parseInt(r)-1;if(i-s<u-a)s=parseInt(t),i=parseInt(n);else a=parseInt(r),u=parseInt(l);for(var c=a;c<=u;c++)for(var d=s;d<=i;d++)obj.records[c][d]&&"none"!=obj.rows[c].style.display&&"none"!=obj.records[c][d].style.display&&(obj.records[c][d].classList.add("selection"),obj.records[a][d].classList.add("selection-top"),obj.records[u][d].classList.add("selection-bottom"),obj.records[c][s].classList.add("selection-left"),obj.records[c][i].classList.add("selection-right"),obj.selection.push(obj.records[c][d]))}},obj.updateCornerPosition=function(){if(obj.highlighted.length){var e=obj.highlighted[obj.highlighted.length-1],o=obj.content.getBoundingClientRect().left,t=obj.content.getBoundingClientRect().top,r=e.getBoundingClientRect().left,n=e.getBoundingClientRect().top,l=e.getBoundingClientRect().width,s=e.getBoundingClientRect().height,i=r-o+obj.content.scrollLeft+l-4,a=n-t+obj.content.scrollTop+s-4;obj.corner.style.top=a+"px",obj.corner.style.left=i+"px"}else obj.corner.style.top="-2000px",obj.corner.style.left="-2000px"},obj.updateScroll=function(e){var o=obj.content.getBoundingClientRect().left,t=obj.content.getBoundingClientRect().top,r=obj.content.getBoundingClientRect().width,n=obj.content.getBoundingClientRect().height,l=obj.records[obj.selectedCell[3]][obj.selectedCell[2]],s=l.getBoundingClientRect().left,i=l.getBoundingClientRect().top,a=l.getBoundingClientRect().width,u=l.getBoundingClientRect().height;if(0==e||1==e)var c=s-o+obj.content.scrollLeft,d=i-t+obj.content.scrollTop-2;else c=s-o+obj.content.scrollLeft+a,d=i-t+obj.content.scrollTop+u;d>obj.content.scrollTop+30&&d<obj.content.scrollTop+n||(d<obj.content.scrollTop+30?obj.content.scrollTop=d-u:obj.content.scrollTop=d-(n-2)),c>obj.content.scrollLeft&&c<obj.content.scrollLeft+r||(c<obj.content.scrollLeft+30?(obj.content.scrollLeft=c,obj.content.scrollLeft<50&&(obj.content.scrollLeft=0)):obj.content.scrollLeft=c-(r-20))},obj.getWidth=function(e){if(e)"object"==typeof e&&(e=$(e).getAttribute("data-x")),o=obj.colgroup[e].getAttribute("width");else for(var o=[],t=0;t<obj.headers.length;t++)o.push(obj.options.columns[t].width);return o},obj.setWidth=function(e,o,t){o>0&&("object"==typeof e&&(e=$(e).getAttribute("data-x")),t||obj.colgroup[e].getAttribute("width"),obj.colgroup[e].setAttribute("width",o),obj.options.columns[e].width=o,obj.setHistory({action:"setWidth",column:e,oldValue:t,newValue:o}),1!=obj.ignoreEvents&&"function"==typeof obj.options.onresizecolumn&&obj.options.onresizecolumn(el,e,o,t),obj.updateCornerPosition())},obj.setHeight=function(e,o,t){o>0&&("object"==typeof e&&(column=$(e).getAttribute("data-y")),t||obj.rows[e].getAttribute("height"),obj.rows[e].setAttribute("height",o),obj.options.rows[e]||(obj.options.rows[e]={}),obj.options.rows[e].height=o,obj.setHistory({action:"setHeight",row:e,oldValue:t,newValue:o}),1!=obj.ignoreEvents&&"function"==typeof obj.options.onresizerow&&obj.options.onresizerow(el,e,o,t),obj.updateCornerPosition())},obj.getHeight=function(e){if(e){"object"==typeof e&&(e=$(e).getAttribute("data-y"));o=obj.rows[e].style.height}else for(var o=[],t=0;t<obj.rows.length;t++){var r=obj.rows[t].style.height;r&&(o[t]=r)}return o},obj.getHeader=function(e){return obj.headers[e].innerText},obj.setHeader=function(e,o){if(obj.headers[e]){var t=obj.headers[e].innerText;o||(o=prompt(obj.options.text.columnName,t)),o&&(obj.headers[e].innerHTML=o),obj.setHistory({action:"setHeader",column:e,oldValue:t,newValue:o}),obj.ignoreEvents||"function"==typeof obj.options.onchangeheader&&obj.options.onchangeheader(el,e,t,o)}},obj.getHeaders=function(e){for(var o=[],t=0;t<obj.headers.length;t++)o.push(obj.getHeader(t));return e?o:o.join(obj.options.csvDelimiter)},obj.getMeta=function(e,o){return e?o?obj.options.meta[e]&&obj.options.meta[e][o]?obj.options.meta[e][o]:null:obj.options.meta[e]?obj.options.meta[e]:null:obj.options.meta},obj.setMeta=function(e,o,t){if(obj.options.meta||(obj.options.meta={}),o&&t)obj.options.meta[e]||(obj.options.meta[e]={}),obj.options.meta[e][o]=t;else for(var r=Object.keys(e),n=0;n<r.length;n++){obj.options.meta[r[n]]||(obj.options.meta[r[n]]={});for(var l=Object.keys(e[r[n]]),s=0;s<l.length;s++)obj.options.meta[r[n]][l[s]]=e[r[n]][l[s]]}1!=obj.ignoreEvents&&"function"==typeof obj.options.onchangemeta&&obj.options.onchangemeta(el,e,o,t)},obj.updateMeta=function(e){if(obj.options.meta){for(var o={},t=Object.keys(obj.options.meta),r=0;r<t.length;r++)e[t[r]]?o[e[t[r]]]=obj.options.meta[t[r]]:o[t[r]]=obj.options.meta[t[r]];obj.options.meta=o}},obj.getStyle=function(e,o){if(e)return e=jexcel.getIdFromColumnName(e,!0),o?obj.records[e[1]][e[0]].style[o]:obj.records[e[1]][e[0]].getAttribute("style");for(var t={},r=obj.options.data[0].length,n=obj.options.data.length,l=0;l<n;l++)for(var s=0;s<r;s++){var i=o?obj.records[l][s].style[o]:obj.records[l][s].getAttribute("style");if(i)t[jexcel.getColumnNameFromId([s,l])]=i}return t},obj.resetStyle=function(e,o){for(var t=Object.keys(e),r=0;r<t.length;r++){var n=jexcel.getIdFromColumnName(t[r],!0);obj.records[n[1]]&&obj.records[n[1]][n[0]]&&obj.records[n[1]][n[0]].setAttribute("style","")}obj.setStyle(e,null,null,null,o)},obj.setStyle=function(e,o,t,r,n){var l={},s={},i=function(e,o,t){var n=jexcel.getIdFromColumnName(e,!0);if(obj.records[n[1]]&&obj.records[n[1]][n[0]]){var i=obj.records[n[1]][n[0]].style[o];i!=t||r?obj.records[n[1]][n[0]].style[o]=t:(t="",obj.records[n[1]][n[0]].style[o]=""),s[e]||(s[e]=[]),l[e]||(l[e]=[]),s[e].push([o+":"+i]),l[e].push([o+":"+t])}};if(o&&t)if("string"==typeof e)i(e,o,t);else for(var a=[],u=0;u<e.length;u++){var c=e[u].getAttribute("data-x"),d=e[u].getAttribute("data-y"),b=jexcel.getColumnNameFromId([c,d]);a[b]||(i(b,o,t),a[b]=!0)}else{var j=Object.keys(e);for(u=0;u<j.length;u++){var p=e[j[u]];"string"==typeof p&&(p=p.split(";"));for(var f=0;f<p.length;f++)"string"==typeof p[f]&&(p[f]=p[f].split(":")),p[f][0].trim()&&i(j[u],p[f][0].trim(),p[f][1])}}for(j=Object.keys(s),u=0;u<j.length;u++)s[j[u]]=s[j[u]].join(";");for(j=Object.keys(l),u=0;u<j.length;u++)l[j[u]]=l[j[u]].join(";");n||obj.setHistory({action:"setStyle",oldValue:s,newValue:l}),1!=obj.ignoreEvents&&"function"==typeof obj.options.onchangestyle&&obj.options.onchangestyle(el,e,o,t)},obj.getComments=function(e,o){if("string"==typeof e)e=jexcel.getIdFromColumnName(e,!0);return o?[obj.records[e[1]][e[0]].getAttribute("title"),obj.records[e[1]][e[0]].getAttribute("author")]:obj.records[e[1]][e[0]].getAttribute("title")||""},obj.setComments=function(e,o,t){if("string"==typeof e)var r=jexcel.getIdFromColumnName(e,!0);else r=e;var n=[obj.records[r[1]][r[0]].getAttribute("title"),t=obj.records[r[1]][r[0]].getAttribute("data-author")];obj.records[r[1]][r[0]].setAttribute("title",o||""),obj.records[r[1]][r[0]].setAttribute("data-author",t||""),o?obj.records[r[1]][r[0]].classList.add("jexcel_comments"):obj.records[r[1]][r[0]].classList.remove("jexcel_comments"),obj.setHistory({action:"setComments",column:e,newValue:[o,t],oldValue:n})},obj.getConfig=function(){var e=obj.options;return e.style=obj.getStyle(),e.mergeCells=obj.getMerge(),e},obj.orderBy=function(e,o){if(e>=0){if(Object.keys(obj.options.mergeCells).length>0){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}o=null==o?obj.headers[e].classList.contains("arrow-down")?1:0:o?1:0,Array.prototype.orderBy=function(e,o){return this.slice(0).sort(function(t,r){var n=""==t[e]?"":Number(t[e])==t[e]?Number(t[e]):t[e].toLowerCase(),l=""==r[e]?"":Number(r[e])==r[e]?Number(r[e]):r[e].toLowerCase();return o?""==n&&""!=l?1:""!=n&&""==l?-1:n>l?-1:n<l?1:0:""==n&&""!=l?1:""!=n&&""==l?-1:n>l?1:n<l?-1:0})};var t=[];if("calendar"==obj.options.columns[e].type||"checkbox"==obj.options.columns[e].type||"radio"==obj.options.columns[e].type)for(var r=0;r<obj.options.data.length;r++)t[r]=[r,obj.options.data[r][e]];else for(r=0;r<obj.options.data.length;r++)t[r]=[r,obj.records[r][e].innerHTML];t=t.orderBy(1,o);var n=[];for(r=0;r<t.length;r++)n[r]=t[r][0];return obj.setHistory({action:"orderBy",rows:n,column:e,order:o}),obj.updateOrderArrow(e,o),obj.updateOrder(n),1!=obj.ignoreEvents&&"function"==typeof obj.options.onsort&&obj.options.onsort(el,e,o),!0}},obj.updateOrderArrow=function(e,o){for(var t=0;t<obj.headers.length;t++)obj.headers[t].classList.remove("arrow-up"),obj.headers[t].classList.remove("arrow-down");o?obj.headers[e].classList.add("arrow-up"):obj.headers[e].classList.add("arrow-down")},obj.updateOrder=function(e){for(var o=[],t=0;t<e.length;t++)o[t]=obj.options.data[e[t]];obj.options.data=o;for(o=[],t=0;t<e.length;t++)o[t]=obj.records[e[t]];obj.records=o;for(o=[],t=0;t<e.length;t++)o[t]=obj.rows[e[t]];if(obj.rows=o,obj.updateTableReferences(),obj.searchInput.value)obj.search(obj.searchInput.value);else if(obj.results=null,obj.pageNumber=0,obj.options.pagination>0)obj.page(0);else if(1==obj.options.lazyLoading)obj.loadPage(0);else for(t=0;t<obj.rows.length;t++)obj.tbody.appendChild(obj.rows[t])},obj.moveRow=function(e,o,t){if(Object.keys(obj.options.mergeCells).length>0&&obj.isRowMerged(o).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if(1==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}t||(Array.prototype.indexOf.call(obj.tbody.children,obj.rows[o])>=0?e>o?obj.tbody.insertBefore(obj.rows[e],obj.rows[o]):obj.tbody.insertBefore(obj.rows[e],obj.rows[o].nextSibling):obj.tbody.removeChild(obj.rows[e])),obj.rows.splice(o,0,obj.rows.splice(e,1)[0]),obj.records.splice(o,0,obj.records.splice(e,1)[0]),obj.options.data.splice(o,0,obj.options.data.splice(e,1)[0]),obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.setHistory({action:"moveRow",oldValue:e,newValue:o}),obj.updateTableReferences(),1!=obj.ignoreEvents&&"function"==typeof obj.options.onmoverow&&obj.options.onmoverow(el,e,o)},obj.insertRow=function(e,o,t){if(1==obj.options.allowInsertRow){var r=[];if(e>0)var n=e;else{n=1;e&&(r=e)}t=!!t;var l=obj.options.data.length-1;if((void 0==o||o>=parseInt(l)||o<0)&&(o=l),"function"==typeof obj.options.onbeforeinsertrow&&!obj.options.onbeforeinsertrow(el,o,n,t))return console.log("onbeforeinsertrow returned false"),!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isRowMerged(o,t).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if(1==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}for(var s=t?o:o+1,i=obj.records.splice(s),a=obj.options.data.splice(s),u=obj.rows.splice(s),c=[],d=[],b=[],j=s;j<n+s;j++){obj.options.data[j]=[];for(var p=0;p<obj.options.columns.length;p++)obj.options.data[j][p]=r[p]?r[p]:"";var f=obj.createRow(j,obj.options.data[j]);(!u[0]||Array.prototype.indexOf.call(obj.tbody.children,u[0])>=0)&&obj.tbody.insertBefore(f,u[0]),c.push(obj.records[j]),d.push(obj.options.data[j]),b.push(f)}Array.prototype.push.apply(obj.records,i),Array.prototype.push.apply(obj.options.data,a),Array.prototype.push.apply(obj.rows,u),obj.options.pagination>0&&obj.page(obj.pageNumber),obj.setHistory({action:"insertRow",rowNumber:o,numOfRows:n,insertBefore:t,rowRecords:c,rowData:d,rowNode:b}),obj.updateTableReferences(),1!=obj.ignoreEvents&&"function"==typeof obj.options.oninsertrow&&obj.options.oninsertrow(el,o,n,c,t)}},obj.deleteRow=function(e,o){if(1==obj.options.allowDeleteRow)if(1==obj.options.allowDeletingAllRows||obj.options.data.length>1){if(void 0==e){var t=obj.getSelectedRows();t[0]?(e=parseInt(t[0].getAttribute("data-y")),o=t.length):(e=obj.options.data.length-1,o=1)}var r=obj.options.data.length-1;if((void 0==e||e>r||e<0)&&(e=r),o||(o=1),e+o>=obj.options.data.length&&(o=obj.options.data.length-e),"function"==typeof obj.options.onbeforedeleterow&&!obj.options.onbeforedeleterow(el,e,o))return console.log("onbeforedeleterow returned false"),!1;if(parseInt(e)>-1){var n=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var l=e;l<e+o;l++)obj.isRowMerged(l,!1).length&&(n=!0);if(n){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if(1==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}for(l=e;l<e+o;l++)Array.prototype.indexOf.call(obj.tbody.children,obj.rows[l])>=0&&(obj.rows[l].className="",obj.rows[l].parentNode.removeChild(obj.rows[l]));var s=obj.records.splice(e,o),i=obj.options.data.splice(e,o),a=obj.rows.splice(e,o);obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.conditionalSelectionUpdate(1,e,e+o-1),obj.setHistory({action:"deleteRow",rowNumber:e,numOfRows:o,insertBefore:1,rowRecords:s,rowData:i,rowNode:a}),obj.updateTableReferences(),1!=obj.ignoreEvents&&"function"==typeof obj.options.ondeleterow&&obj.options.ondeleterow(el,e,o,s)}}else console.error("JEXCEL. It is not possible to delete the last row")},obj.moveColumn=function(e,o){if(Object.keys(obj.options.mergeCells).length>0&&obj.isColMerged(o).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if((e=parseInt(e))>(o=parseInt(o))){obj.headerContainer.insertBefore(obj.headers[e],obj.headers[o]),obj.colgroupContainer.insertBefore(obj.colgroup[e],obj.colgroup[o]);for(var t=0;t<obj.rows.length;t++)obj.rows[t].insertBefore(obj.records[t][e],obj.records[t][o])}else{obj.headerContainer.insertBefore(obj.headers[e],obj.headers[o].nextSibling),obj.colgroupContainer.insertBefore(obj.colgroup[e],obj.colgroup[o].nextSibling);for(t=0;t<obj.rows.length;t++)obj.rows[t].insertBefore(obj.records[t][e],obj.records[t][o].nextSibling)}obj.options.columns.splice(o,0,obj.options.columns.splice(e,1)[0]),obj.headers.splice(o,0,obj.headers.splice(e,1)[0]),obj.colgroup.splice(o,0,obj.colgroup.splice(e,1)[0]);for(t=0;t<obj.rows.length;t++)obj.options.data[t].splice(o,0,obj.options.data[t].splice(e,1)[0]),obj.records[t].splice(o,0,obj.records[t].splice(e,1)[0]);obj.setHistory({action:"moveColumn",oldValue:e,newValue:o}),obj.updateTableReferences(),1!=obj.ignoreEvents&&"function"==typeof obj.options.onmovecolumn&&obj.options.onmovecolumn(el,e,o)},obj.insertColumn=function(e,o,t,r){if(1==obj.options.allowInsertColumn){var n=[];if(e>0)var l=e;else{l=1;e&&(n=e)}t=!!t;var s=obj.options.columns.length-1;if((void 0==o||o>=parseInt(s)||o<0)&&(o=s),"function"==typeof obj.options.onbeforeinsertcolumn&&!obj.options.onbeforeinsertcolumn(el,o,l,t))return console.log("onbeforeinsertcolumn returned false"),!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isColMerged(o,t).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}r||(r=[]);for(var i=0;i<l;i++)r[i]||(r[i]={type:"text",source:[],options:[],width:obj.options.defaultColWidth,align:obj.options.defaultColAlign});var a=t?o:o+1;obj.options.columns=jexcel.injectArray(obj.options.columns,a,r);for(var u=obj.headers.splice(a),c=obj.colgroup.splice(a),d=[],b=[],j=[],p=[],f=a;f<l+a;f++)obj.createCellHeader(f),obj.headerContainer.insertBefore(obj.headers[f],obj.headerContainer.children[f+1]),obj.colgroupContainer.insertBefore(obj.colgroup[f],obj.colgroupContainer.children[f+1]),d.push(obj.headers[f]),b.push(obj.colgroup[f]);for(var g=0;g<obj.options.data.length;g++){var h=obj.options.data[g].splice(a),m=obj.records[g].splice(a);p[g]=[],j[g]=[];for(f=a;f<l+a;f++){var C=n[g]?n[g]:"";obj.options.data[g][f]=C;var x=obj.createCell(f,g,obj.options.data[g][f]);obj.records[g][f]=x,obj.rows[g]&&obj.rows[g].insertBefore(x,obj.rows[g].children[f+1]),p[g].push(C),j[g].push(x)}Array.prototype.push.apply(obj.options.data[g],h),Array.prototype.push.apply(obj.records[g],m)}if(Array.prototype.push.apply(obj.headers,u),Array.prototype.push.apply(obj.colgroup,c),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var v=0;v<obj.options.nestedHeaders.length;v++){var y=parseInt(obj.options.nestedHeaders[v][obj.options.nestedHeaders[v].length-1].colspan)+l;obj.options.nestedHeaders[v][obj.options.nestedHeaders[v].length-1].colspan=y,obj.thead.children[v].children[obj.thead.children[v].children.length-1].setAttribute("colspan",y)}else{y=parseInt(obj.options.nestedHeaders[0].colspan)+l;obj.options.nestedHeaders[0].colspan=y,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",y)}obj.setHistory({action:"insertColumn",columnNumber:o,numOfColumns:l,insertBefore:t,columns:r.columns,headers:d,colgroup:b,records:j,data:p}),obj.updateTableReferences(),1!=obj.ignoreEvents&&"function"==typeof obj.options.oninsertcolumn&&obj.options.oninsertcolumn(el,o,l)}},obj.deleteColumn=function(e,o){if(1==obj.options.allowDeleteColumn)if(obj.headers.length>1){if(void 0==e){var t=obj.getSelectedColumns(!0);t.length?(e=parseInt(t[0]),o=parseInt(t.length)):(e=obj.headers.length-1,o=1)}var r=obj.options.data[0].length-1;if((void 0==e||e>r||e<0)&&(e=r),o||(o=1),o>obj.options.data[0].length-e&&(o=obj.options.data[0].length-e),"function"==typeof obj.options.onbeforedeletecolumn&&!obj.options.onbeforedeletecolumn(el,e,o))return console.log("onbeforedeletecolumn returned false"),!1;if(parseInt(e)>-1){var n=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var l=e;l<e+o;l++)obj.isColMerged(l,!1).length&&(n=!0);if(n){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}var s=obj.options.columns.splice(e,o);for(l=e;l<e+o;l++)obj.colgroup[l].className="",obj.headers[l].className="",obj.colgroup[l].parentNode.removeChild(obj.colgroup[l]),obj.headers[l].parentNode.removeChild(obj.headers[l]);for(var i=obj.headers.splice(e,o),a=obj.colgroup.splice(e,o),u=[],c=[],d=0;d<obj.options.data.length;d++)for(l=e;l<e+o;l++)obj.records[d][l].className="",obj.records[d][l].parentNode.removeChild(obj.records[d][l]);for(d=0;d<obj.options.data.length;d++)c[d]=obj.options.data[d].splice(e,o),u[d]=obj.records[d].splice(e,o);if(obj.conditionalSelectionUpdate(0,e,e+o-1),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var b=0;b<obj.options.nestedHeaders.length;b++){var j=parseInt(obj.options.nestedHeaders[b][obj.options.nestedHeaders[b].length-1].colspan)-o;obj.options.nestedHeaders[b][obj.options.nestedHeaders[b].length-1].colspan=j,obj.thead.children[b].children[obj.thead.children[b].children.length-1].setAttribute("colspan",j)}else{j=parseInt(obj.options.nestedHeaders[0].colspan)-o;obj.options.nestedHeaders[0].colspan=j,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",j)}obj.setHistory({action:"deleteColumn",columnNumber:e,numOfColumns:o,insertBefore:1,columns:s,headers:i,colgroup:a,records:u,data:c}),obj.updateTableReferences(),1!=obj.ignoreEvents&&"function"==typeof obj.options.ondeletecolumn&&obj.options.ondeletecolumn(el,e,o,u)}}else console.error("JEXCEL. It is not possible to delete the last column")},obj.getSelectedRows=function(e){for(var o=[],t=0;t<obj.rows.length;t++)obj.rows[t].classList.contains("selected")&&(e?o.push(t):o.push(obj.rows[t]));return o},obj.getSelectedColumns=function(){for(var e=[],o=0;o<obj.headers.length;o++)obj.headers[o].classList.contains("selected")&&e.push(o);return e},obj.getHighlighted=function(){return obj.highlighted},obj.updateTableReferences=function(){for(var e=0;e<obj.headers.length;e++){(l=obj.headers[e].getAttribute("data-x"))!=e&&(obj.headers[e].setAttribute("data-x",e),obj.headers[e].getAttribute("title")||(obj.headers[e].innerHTML=jexcel.getColumnName(e)))}for(var o=0;o<obj.rows.length;o++){if(obj.rows[o])(s=obj.rows[o].getAttribute("data-y"))!=o&&(obj.rows[o].setAttribute("data-y",o),obj.rows[o].children[0].setAttribute("data-y",o),obj.rows[o].children[0].innerHTML=o+1)}var t=[],r=[],n=function(e,o,r,n){if(e!=r&&obj.records[n][r].setAttribute("data-x",r),o!=n&&obj.records[n][r].setAttribute("data-y",n),e!=r||o!=n){var l=jexcel.getColumnNameFromId([e,o]),s=jexcel.getColumnNameFromId([r,n]);t[l]=s}};for(o=0;o<obj.records.length;o++)for(e=0;e<obj.records[0].length;e++)if(obj.records[o][e]){var l=obj.records[o][e].getAttribute("data-x"),s=obj.records[o][e].getAttribute("data-y");if(obj.records[o][e].getAttribute("data-merged")){var i=jexcel.getColumnNameFromId([l,s]),a=jexcel.getColumnNameFromId([e,o]);if(null==r[i])if(i==a)r[i]=!1;else{var u=parseInt(e-l),c=parseInt(o-s);r[i]=[a,u,c]}}else n(l,s,e,o)}var d=Object.keys(r);if(d.length)for(e=0;e<d.length;e++)if(r[d[e]]){var b=jexcel.getIdFromColumnName(d[e],!0);n(l=b[0],s=b[1],l+r[d[e]][1],s+r[d[e]][2]);for(i=d[e],a=r[d[e]][0],o=0;o<obj.options.mergeCells[i][2].length;o++){l=parseInt(obj.options.mergeCells[i][2][o].getAttribute("data-x")),s=parseInt(obj.options.mergeCells[i][2][o].getAttribute("data-y"));obj.options.mergeCells[i][2][o].setAttribute("data-x",l+r[d[e]][1]),obj.options.mergeCells[i][2][o].setAttribute("data-y",s+r[d[e]][2])}obj.options.mergeCells[a]=obj.options.mergeCells[i],delete obj.options.mergeCells[i]}obj.updateFormulas(t),obj.updateMeta(t),obj.refreshSelection(),obj.updateTable()},obj.updateTable=function(){if(obj.options.minSpareRows>0){for(var e=0,o=obj.rows.length-1;o>=0;o--){for(var t=!1,r=0;r<obj.headers.length;r++)obj.options.data[o][r]&&(t=!0);if(t)break;e++}obj.options.minSpareRows-e>0&&obj.insertRow(obj.options.minSpareRows-e)}if(obj.options.minSpareCols>0){var n=0;for(r=obj.headers.length-1;r>=0;r--){for(t=!1,o=0;o<obj.rows.length;o++)obj.options.data[o][r]&&(t=!0);if(t)break;n++}obj.options.minSpareCols-n>0&&obj.insertColumn(obj.options.minSpareCols-n)}if("function"==typeof obj.options.updateTable)for(o=0;o<obj.rows.length;o++)for(r=0;r<obj.headers.length;r++)obj.options.updateTable(el,obj.records[o][r],r,o,obj.options.data[o][r],obj.records[o][r].innerText,jexcel.getColumnNameFromId([r,o]));setTimeout(function(){obj.updateCornerPosition()},0)},obj.showIndex=function(){obj.table.classList.remove("jexcel_hidden_index")},obj.hideIndex=function(){obj.table.classList.add("jexcel_hidden_index")};var chainLoopProtection=[];return obj.updateFormulaChain=function(e,o,t){var r=jexcel.getColumnNameFromId([e,o]);if(obj.formula[r]&&obj.formula[r].length>0)if(chainLoopProtection[r])obj.records[o][e].innerHTML="#ERROR",obj.formula[r]="";else{chainLoopProtection[r]=!0;for(var n=0;n<obj.formula[r].length;n++){var l=jexcel.getIdFromColumnName(obj.formula[r][n],!0),s=""+obj.options.data[l[1]][l[0]];"="==s.substr(0,1)?t.push(obj.updateCell(l[0],l[1],s,!0)):Object.keys(obj.formula)[n]=null,obj.updateFormulaChain(l[0],l[1],t)}}chainLoopProtection=[]},obj.updateFormulas=function(e){for(var o=0;o<obj.options.data.length;o++)for(var t=0;t<obj.options.data[0].length;t++){if("="==(i=""+obj.options.data[o][t]).substr(0,1)){var r=obj.updateFormula(i,e);r!=i&&(obj.options.data[o][t]=r)}}var n=[],l=Object.keys(obj.formula);for(o=0;o<l.length;o++){var s=l[o],i=obj.formula[s];e[s]&&(s=e[s]),n[s]=[];for(t=0;t<i.length;t++){var a=i[t];e[a]&&(a=e[a]),n[s].push(a)}}obj.formula=n},obj.updateFormula=function(e,o){for(var t=/[A-Z]/,r=/[0-9]/,n="",l=null,s=null,i="",a=0;a<e.length;a++)t.exec(e[a])?(l=1,s=0,i+=e[a]):r.exec(e[a])?(s=l?1:0,i+=e[a]):(l&&s&&(i=o[i]?o[i]:i),n+=i,n+=e[a],l=0,s=0,i="");return i&&(l&&s&&(i=o[i]?o[i]:i),n+=i),n},obj.executeFormula=function(expression,x,y){var formulaResults=[],formulaLoopProtection=[],execute=function(expression,x,y){var parentId=jexcel.getColumnNameFromId([x,y]);if(formulaLoopProtection[parentId])return console.error("Reference loop detected"),"#ERROR";formulaLoopProtection[parentId]=!0;var tokensUpdate=function(e){for(var o=0;o<e.length;o++){var t=[],r=e[o].split(":"),n=jexcel.getIdFromColumnName(r[0],!0),l=jexcel.getIdFromColumnName(r[1],!0);if(n[0]<=l[0])var s=n[0],i=l[0];else s=l[0],i=n[0];if(n[1]<=l[1])var a=n[1],u=l[1];else a=l[1],u=n[1];for(var c=a;c<=u;c++)for(var d=s;d<=i;d++)t.push(jexcel.getColumnNameFromId([d,c]));expression=expression.replace(e[o],t.join(","))}},tokens=expression.match(/([A-Z]+[0-9]+)\:([A-Z]+[0-9]+)/g);tokens&&tokens.length&&tokensUpdate(tokens);var evalstring="",tokens=expression.match(/([A-Z]+[0-9]+)/g);if(tokens&&tokens.indexOf(parentId)>-1)return console.error("Self Reference detected"),"#ERROR";if(tokens)for(var i=0;i<tokens.length;i++)if(obj.formula[tokens[i]]||(obj.formula[tokens[i]]=[]),obj.formula[tokens[i]].indexOf(parentId)<0&&obj.formula[tokens[i]].push(parentId),eval("typeof("+tokens[i]+') == "undefined"')){var position=jexcel.getIdFromColumnName(tokens[i],1);if(void 0!==obj.options.data[position[1]]&&void 0!==obj.options.data[position[1]][position[0]])var value=obj.options.data[position[1]][position[0]];else var value="";if("="==(""+value).substr(0,1)&&(formulaResults[tokens[i]]?value=formulaResults[tokens[i]]:(value=execute(value,position[0],position[1]),formulaResults[tokens[i]]=value)),""==(""+value).trim())evalstring+="var "+tokens[i]+" = null;";else if(value==Number(value))evalstring+="var "+tokens[i]+" = "+value+";";else{var number=null;(number=obj.parseNumber(value,position[0]))?evalstring+="var "+tokens[i]+" = "+number+";":evalstring+="var "+tokens[i]+" = '"+value+"';"}}try{evalstring+="function COLUMN() { return parseInt(x) + 1; }; function ROW() { return parseInt(y) + 1; };";var res=eval(evalstring+expression.substr(1))}catch(e){var res="#ERROR"}return res};return execute(expression,x,y)},obj.parseNumber=function(e,o){var t=o&&obj.options.columns[o].decimal?obj.options.columns[o].decimal:".",r=""+e;if((r=r.split(t))[0]=r[0].match(/[+-]?[0-9]/g),r[0]&&(r[0]=r[0].join("")),r[1]&&(r[1]=r[1].match(/[0-9]*/g).join("")),r[0]&&Number(r[0])>=0)if(r[1])e=Number(r[0]+"."+r[1]);else var e=Number(r[0]+".00");else e=null;return e},obj.row=function(e){},obj.col=function(e){},obj.up=function(e,o){if(e?obj.selectedCell[3]>0&&obj.up.visible(1,o?0:1):(obj.selectedCell[1]>0&&obj.up.visible(0,o?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),1==obj.options.lazyLoading)if(0==obj.selectedCell[1]||0==obj.selectedCell[3])obj.loadPage(0),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else if(obj.loadValidation())obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else{var t=parseInt(obj.tbody.firstChild.getAttribute("data-y"));obj.selectedCell[1]-t<30&&(obj.loadUp(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]))}else if(obj.options.pagination>0){var r=obj.whichPage(obj.selectedCell[3]);r!=obj.pageNumber&&obj.page(r)}obj.updateScroll(1)},obj.up.visible=function(e,o){if(0==e)var t=parseInt(obj.selectedCell[0]),r=parseInt(obj.selectedCell[1]);else t=parseInt(obj.selectedCell[2]),r=parseInt(obj.selectedCell[3]);if(0==o){for(var n=0;n<r;n++)if("none"!=obj.records[n][t].style.display&&"none"!=obj.rows[n].style.display){r=n;break}}else r=obj.up.get(t,r);0==e?(obj.selectedCell[0]=t,obj.selectedCell[1]=r):(obj.selectedCell[2]=t,obj.selectedCell[3]=r)},obj.up.get=function(e,o){e=parseInt(e);for(var t=(o=parseInt(o))-1;t>=0;t--)if("none"!=obj.records[t][e].style.display&&"none"!=obj.rows[t].style.display){if(obj.records[t][e].getAttribute("data-merged")&&obj.records[t][e]==obj.records[o][e])continue;o=t;break}return o},obj.down=function(e,o){if(e?obj.selectedCell[3]<obj.records.length-1&&obj.down.visible(1,o?0:1):(obj.selectedCell[1]<obj.records.length-1&&obj.down.visible(0,o?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),1==obj.options.lazyLoading)obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1?(obj.loadPage(-1),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])):obj.loadValidation()?obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]):parseInt(obj.tbody.lastChild.getAttribute("data-y"))-obj.selectedCell[3]<30&&(obj.loadDown(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]));else if(obj.options.pagination>0){var t=obj.whichPage(obj.selectedCell[3]);t!=obj.pageNumber&&obj.page(t)}obj.updateScroll(3)},obj.down.visible=function(e,o){if(0==e)var t=parseInt(obj.selectedCell[0]),r=parseInt(obj.selectedCell[1]);else t=parseInt(obj.selectedCell[2]),r=parseInt(obj.selectedCell[3]);if(0==o){for(var n=obj.rows.length-1;n>r;n--)if("none"!=obj.records[n][t].style.display&&"none"!=obj.rows[n].style.display){r=n;break}}else r=obj.down.get(t,r);0==e?(obj.selectedCell[0]=t,obj.selectedCell[1]=r):(obj.selectedCell[2]=t,obj.selectedCell[3]=r)},obj.down.get=function(e,o){e=parseInt(e);for(var t=(o=parseInt(o))+1;t<obj.rows.length;t++)if("none"!=obj.records[t][e].style.display&&"none"!=obj.rows[t].style.display){if(obj.records[t][e].getAttribute("data-merged")&&obj.records[t][e]==obj.records[o][e])continue;o=t;break}return o},obj.right=function(e,o){e?obj.selectedCell[2]<obj.headers.length-1&&obj.right.visible(1,o?0:1):(obj.selectedCell[0]<obj.headers.length-1&&obj.right.visible(0,o?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(2)},obj.right.visible=function(e,o){if(0==e)var t=parseInt(obj.selectedCell[0]),r=parseInt(obj.selectedCell[1]);else t=parseInt(obj.selectedCell[2]),r=parseInt(obj.selectedCell[3]);if(0==o){for(var n=obj.headers.length-1;n>t;n--)if("none"!=obj.records[r][n].style.display){t=n;break}}else t=obj.right.get(t,r);0==e?(obj.selectedCell[0]=t,obj.selectedCell[1]=r):(obj.selectedCell[2]=t,obj.selectedCell[3]=r)},obj.right.get=function(e,o){e=parseInt(e),o=parseInt(o);for(var t=e+1;t<obj.headers.length;t++)if("none"!=obj.records[o][t].style.display){if(obj.records[o][t].getAttribute("data-merged")&&obj.records[o][t]==obj.records[o][e])continue;e=t;break}return e},obj.left=function(e,o){e?obj.selectedCell[2]>0&&obj.left.visible(1,o?0:1):(obj.selectedCell[0]>0&&obj.left.visible(0,o?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(0)},obj.left.visible=function(e,o){if(0==e)var t=parseInt(obj.selectedCell[0]),r=parseInt(obj.selectedCell[1]);else t=parseInt(obj.selectedCell[2]),r=parseInt(obj.selectedCell[3]);if(0==o){for(var n=0;n<t;n++)if("none"!=obj.records[r][n].style.display){t=n;break}}else t=obj.left.get(t,r);0==e?(obj.selectedCell[0]=t,obj.selectedCell[1]=r):(obj.selectedCell[2]=t,obj.selectedCell[3]=r)},obj.left.get=function(e,o){e=parseInt(e),o=parseInt(o);for(var t=e-1;t>=0;t--)if("none"!=obj.records[o][t].style.display){if(obj.records[o][t].getAttribute("data-merged")&&obj.records[o][t]==obj.records[o][e])continue;e=t;break}return e},obj.first=function(e,o){if(e?o?obj.selectedCell[3]=0:obj.left.visible(1,0):(o?obj.selectedCell[1]=0:obj.left.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),1!=obj.options.lazyLoading||0!=obj.selectedCell[1]&&0!=obj.selectedCell[3]){if(obj.options.pagination>0){var t=obj.whichPage(obj.selectedCell[3]);t!=obj.pageNumber&&obj.page(t)}}else obj.loadPage(0);obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(1)},obj.last=function(e,o){if(e?o?obj.selectedCell[3]=obj.records.length-1:obj.right.visible(1,0):(o?obj.selectedCell[1]=obj.records.length-1:obj.right.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),1!=obj.options.lazyLoading||obj.selectedCell[1]!=obj.records.length-1&&obj.selectedCell[3]!=obj.records.length-1){if(obj.options.pagination>0){var t=obj.whichPage(obj.selectedCell[3]);t!=obj.pageNumber&&obj.page(t)}}else obj.loadPage(-1);obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(3)},obj.selectAll=function(){obj.selectedCell||(obj.selectedCell=[]),obj.selectedCell[0]=0,obj.selectedCell[1]=0,obj.selectedCell[2]=obj.headers.length-1,obj.selectedCell[3]=obj.records.length-1,obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.loadPage=function(e){if(1==obj.options.search&&obj.results)var o=obj.results;else o=obj.rows;null!=e&&-1!=e||(e=Math.ceil(o.length/100));var t=100*e,r=100*e+100;r>o.length&&(r=o.length),(t=r-100)<0&&(t=0);for(var n=t;n<r;n++)1==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[o[n]]):obj.tbody.appendChild(obj.rows[n]),obj.tbody.children.length>100&&obj.tbody.removeChild(obj.tbody.firstChild)},obj.loadUp=function(){if(1==obj.options.search&&obj.results)var e=obj.results;else e=obj.rows;var o=0;if(e.length>100){var t=parseInt(obj.tbody.firstChild.getAttribute("data-y"));if(1==obj.options.search&&obj.results&&(t=e.indexOf(t)),t>0)for(var r=0;r<30;r++)(t-=1)>-1&&(1==obj.options.search&&obj.results?obj.tbody.insertBefore(obj.rows[e[t]],obj.tbody.firstChild):obj.tbody.insertBefore(obj.rows[t],obj.tbody.firstChild),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.lastChild),o=1))}return o},obj.loadDown=function(){if(1==obj.options.search&&obj.results)var e=obj.results;else e=obj.rows;var o=0;if(e.length>100){var t=parseInt(obj.tbody.lastChild.getAttribute("data-y"));if(1==obj.options.search&&obj.results&&(t=e.indexOf(t)),t<obj.rows.length-1)for(var r=0;r<=30;r++)t<e.length&&(1==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[e[t]]):obj.tbody.appendChild(obj.rows[t]),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.firstChild),o=1)),t+=1}return o},obj.loadValidation=function(){if(obj.selectedCell){var e=parseInt(obj.tbody.firstChild.getAttribute("data-y"))/100,o=parseInt(obj.selectedCell[3]/100),t=parseInt(obj.rows.length/100);if(e!=o&&o<=t&&!Array.prototype.indexOf.call(obj.tbody.children,obj.rows[obj.selectedCell[3]]))return obj.loadPage(o),!0}return!1},obj.resetSearch=function(){obj.searchInput.value="",obj.search(""),obj.results=null},obj.search=function(e){if(e)e=e.toLowerCase();if(obj.resetSelection(),obj.pageNumber=0,obj.results=[],e){var o=function(e){-1==obj.results.indexOf(e)&&obj.results.push(e)};obj.options.data.filter(function(t,r){if(function(e,o,t){for(var r=0;r<e.length;r++)if((""+e[r]).toLowerCase().search(o)>=0||(""+obj.records[t][r].innerHTML).toLowerCase().search(o)>=0)return!0;return!1}(t,e,r)){var n=obj.isRowMerged(r);if(n.length)for(var l=0;l<n.length;l++)for(var s=jexcel.getIdFromColumnName(n[l],!0),i=0;i<obj.options.mergeCells[n[l]][1];i++)o(s[1]+i);else o(r);return!0}return!1})}else obj.results=null;var t=0,r=0;for(t=1==obj.options.lazyLoading?100:obj.options.pagination>0?obj.options.pagination:obj.results?obj.results.length:obj.rows.length;obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var n=0;n<obj.rows.length;n++)!obj.results||obj.results.indexOf(n)>-1?(r<t&&(obj.tbody.appendChild(obj.rows[n]),r++),obj.rows[n].style.display=""):obj.rows[n].style.display="none";return obj.options.pagination>0&&obj.updatePagination(),t},obj.whichPage=function(e){return 1==obj.options.search&&obj.results&&(e=obj.results.indexOf(e)),Math.ceil((parseInt(e)+1)/parseInt(obj.options.pagination))-1},obj.page=function(e){if(1==obj.options.search&&obj.results)var o=obj.results;else o=obj.rows;var t=parseInt(obj.options.pagination);null!=e&&-1!=e||(e=Math.ceil(o.length/t)),obj.pageNumber=e;var r=e*t,n=e*t+t;for(n>o.length&&(n=o.length),r<0&&(r=0);obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var l=r;l<n;l++)1==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[o[l]]):obj.tbody.appendChild(obj.rows[l]);obj.options.pagination>0&&obj.updatePagination(),obj.updateCornerPosition()},obj.updatePagination=function(){if(obj.pagination.children[0].innerHTML="",obj.pagination.children[1].innerHTML="",obj.options.pagination){if(1==obj.options.search&&obj.results)var e=obj.results.length;else e=obj.rows.length;if(e){var o=Math.ceil(e/obj.options.pagination);if(obj.pageNumber<6)var t=1,r=o<10?o:10;else if(o-obj.pageNumber<5){r=o;(t=o-9)<1&&(t=1)}else t=obj.pageNumber-4,r=obj.pageNumber+5;if(t>1)(l=document.createElement("div")).className="jexcel_page",l.innerHTML="<",l.title=1,obj.pagination.children[1].appendChild(l);for(var n=t;n<=r;n++){var l;(l=document.createElement("div")).className="jexcel_page",l.innerHTML=n,obj.pagination.children[1].appendChild(l),obj.pageNumber==n-1&&l.classList.add("jexcel_page_selected")}if(r<o)(l=document.createElement("div")).className="jexcel_page",l.innerHTML=">",l.title=o,obj.pagination.children[1].appendChild(l);obj.pagination.children[0].innerHTML=function(e){var o=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==o[t]?o[t]:e})}(obj.options.text.showingPage,obj.pageNumber+1,o)}else obj.pagination.children[0].innerHTML=obj.options.text.noRecordsFound}},obj.download=function(e){if(0==obj.options.allowExport)console.error("Export not allowed");else{var o="";1==e&&(o+=obj.getHeaders(),o+="\r\n"),o+=obj.copy(!1,obj.options.csvDelimiter,!0);var t=document.createElement("a"),r=new Blob([o],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(r);t.href=n,t.setAttribute("download",obj.options.csvFileName+".dat"),document.body.appendChild(t),t.click(),t.parentNode.removeChild(t)}},obj.setHistory=function(e){if(1!=obj.ignoreHistory){var o=++obj.historyIndex;obj.history=obj.history=obj.history.slice(0,o+1),obj.history[o]=e}},obj.copy=function(e,o,t){o||(o="\t");var r=[],n=[],l=[],s=[],i=obj.options.data[0].length,a=obj.options.data.length,u="";obj.style=[];for(var c=0;c<a;c++){r=[],n=[];for(var d=0;d<i;d++)if(!e||obj.records[c][d].classList.contains("highlight")){var b=obj.options.data[c][d];b.match&&(b.match(/,/g)||b.match(/\n/)||b.match(/\"/))&&(b='"'+(b=b.replace(new RegExp('"',"g"),'""'))+'"'),r.push(b);var j=obj.records[c][d].innerHTML;j.match&&(j.match(/,/g)||j.match(/\n/)||j.match(/\"/))&&(j='"'+(j=j.replace(new RegExp('"',"g"),'""'))+'"'),n.push(j),u=obj.records[c][d].getAttribute("style"),obj.style.push(u||"")}r.length&&l.push(r.join(o)),n.length&&s.push(n.join(o))}var p=l.join("\n"),f=s.join("\n");return t||(1==obj.options.copyCompatibility?obj.textarea.value=f:obj.textarea.value=p,obj.textarea.select(),document.execCommand("copy")),obj.data=p,obj.hashString=obj.hash(obj.textarea.value),p},obj.paste=function(e,o,t){if("function"==typeof obj.options.onbeforepaste)t=obj.options.onbeforepaste(el,t);var r=obj.hash(t),n=r==obj.hashString?obj.style:null;if(1==obj.options.copyCompatibility&&r==obj.hashString)t=obj.data;t=obj.parseCSV(t,"\t");if(null!=e&&null!=o&&t){for(var l=0,s=0,i=[],a={},u={},c=0,d=parseInt(e),b=parseInt(o),j=null;j=t[s];){for(l=0,d=parseInt(e);null!=j[l];){var p=obj.updateCell(d,b,j[l]);if(i.push(p),obj.updateFormulaChain(d,b,i),n){var f=jexcel.getColumnNameFromId([d,b]);a[f]=n[c],u[f]=obj.getStyle(f),obj.records[b][d].setAttribute("style",n[c]),c++}null!=j[++l]&&(d>=obj.headers.length-1&&obj.insertColumn(),d=obj.right.get(d,b))}t[++s]&&(b>=obj.rows.length-1&&obj.insertRow(),b=obj.down.get(e,b))}obj.updateSelectionFromCoords(e,o,d,b),obj.setHistory({action:"setValue",records:i,selection:obj.selectedCell,newStyle:a,oldStyle:u}),obj.updateTable(),"function"==typeof obj.options.onpaste&&obj.options.onpaste(el,i),obj.onafterchanges(el,i)}},obj.historyProcessRow=function(e,o){var t=o.insertBefore?o.rowNumber:o.rowNumber+1;if(1==obj.options.search&&obj.results&&obj.results.length!=obj.rows.length&&obj.resetSearch(),1==e){for(var r=o.numOfRows,n=t;n<r+t;n++)obj.rows[n].parentNode.removeChild(obj.rows[n]);obj.records.splice(t,r),obj.options.data.splice(t,r),obj.rows.splice(t,r),obj.conditionalSelectionUpdate(1,t,r+t-1)}else{obj.records=jexcel.injectArray(obj.records,t,o.rowRecords),obj.options.data=jexcel.injectArray(obj.options.data,t,o.rowData),obj.rows=jexcel.injectArray(obj.rows,t,o.rowNode);var l=0;for(n=t;n<o.numOfRows+t;n++)obj.tbody.insertBefore(o.rowNode[l],obj.tbody.children[n]),l++}obj.options.pagination>0&&obj.page(obj.pageNumber),obj.updateTableReferences()},obj.historyProcessColumn=function(e,o){var t=o.insertBefore?o.columnNumber:o.columnNumber+1;if(1==e){var r=o.numOfColumns;obj.options.columns.splice(t,r);for(var n=t;n<r+t;n++)obj.headers[n].parentNode.removeChild(obj.headers[n]),obj.colgroup[n].parentNode.removeChild(obj.colgroup[n]);obj.headers.splice(t,r),obj.colgroup.splice(t,r);for(var l=0;l<o.data.length;l++){for(n=t;n<r+t;n++)obj.records[l][n].parentNode.removeChild(obj.records[l][n]);obj.records[l].splice(t,r),obj.options.data[l].splice(t,r)}obj.conditionalSelectionUpdate(0,t,r+t-1)}else{obj.options.columns=jexcel.injectArray(obj.options.columns,t,o.columns),obj.headers=jexcel.injectArray(obj.headers,t,o.headers),obj.colgroup=jexcel.injectArray(obj.colgroup,t,o.colgroup);var s=0;for(n=t;n<o.numOfColumns+t;n++)obj.headerContainer.insertBefore(o.headers[s],obj.headerContainer.children[n+1]),obj.colgroupContainer.insertBefore(o.colgroup[s],obj.colgroupContainer.children[n+1]),s++;for(l=0;l<o.data.length;l++){obj.options.data[l]=jexcel.injectArray(obj.options.data[l],t,o.data[l]),obj.records[l]=jexcel.injectArray(obj.records[l],t,o.records[l]);for(s=0,n=t;n<o.numOfColumns+t;n++)obj.rows[l].insertBefore(o.records[l][s],obj.rows[l].children[n+1]),s++}}if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(l=0;l<obj.options.nestedHeaders.length;l++){if(1==e)var i=parseInt(obj.options.nestedHeaders[l][obj.options.nestedHeaders[l].length-1].colspan)-o.numOfColumns;else i=parseInt(obj.options.nestedHeaders[l][obj.options.nestedHeaders[l].length-1].colspan)+o.numOfColumns;obj.options.nestedHeaders[l][obj.options.nestedHeaders[l].length-1].colspan=i,obj.thead.children[l].children[obj.thead.children[l].children.length-1].setAttribute("colspan",i)}else{if(1==e)i=parseInt(obj.options.nestedHeaders[0].colspan)-o.numOfColumns;else i=parseInt(obj.options.nestedHeaders[0].colspan)+o.numOfColumns;obj.options.nestedHeaders[0].colspan=i,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",i)}obj.updateTableReferences()},obj.undo=function(){var e=!!obj.ignoreEvents,o=!!obj.ignoreHistory;obj.ignoreEvents=!0,obj.ignoreHistory=!0;var t=[];if(obj.historyIndex>=0){var r=obj.history[obj.historyIndex--];if("insertRow"==r.action)obj.historyProcessRow(1,r);else if("deleteRow"==r.action)obj.historyProcessRow(0,r);else if("insertColumn"==r.action)obj.historyProcessColumn(1,r);else if("deleteColumn"==r.action)obj.historyProcessColumn(0,r);else if("moveRow"==r.action)obj.moveRow(r.newValue,r.oldValue);else if("moveColumn"==r.action)obj.moveColumn(r.newValue,r.oldValue);else if("setMerge"==r.action)obj.removeMerge(r.column,r.data);else if("setStyle"==r.action)obj.setStyle(r.oldValue,null,null,1);else if("setWidth"==r.action)obj.setWidth(r.column,r.oldValue);else if("setHeight"==r.action)obj.setHeight(r.row,r.oldValue);else if("setHeader"==r.action)obj.setHeader(r.column,r.oldValue);else if("setComments"==r.action)obj.setComments(r.column,r.oldValue[0],r.oldValue[1]);else if("orderBy"==r.action){for(var n=[],l=0;l<r.rows.length;l++)n[r.rows[l]]=l;obj.updateOrderArrow(r.column,r.order?0:1),obj.updateOrder(n)}else if("setValue"==r.action){for(var s=0;s<r.records.length;s++)obj.updateCell(r.records[s].col,r.records[s].row,r.records[s].oldValue),obj.updateFormulaChain(r.records[s].col,r.records[s].row,t),r.oldStyle&&obj.resetStyle(r.oldStyle,!0);r.selection||(r.selection=[r.records[0].col,r.records[0].row]),obj.updateSelectionFromCoords(r.selection[0],r.selection[1],r.selection[2],r.selection[3]),obj.updateTable()}}obj.ignoreEvents=e,obj.ignoreHistory=o,"function"==typeof obj.options.onundo&&obj.options.onundo(el,r)},obj.redo=function(){var e=!!obj.ignoreEvents,o=!!obj.ignoreHistory;obj.ignoreEvents=!0,obj.ignoreHistory=!0;var t=[];if(obj.historyIndex<obj.history.length-1){var r=obj.history[++obj.historyIndex];if("insertRow"==r.action)obj.historyProcessRow(0,r);else if("deleteRow"==r.action)obj.historyProcessRow(1,r);else if("insertColumn"==r.action)obj.historyProcessColumn(0,r);else if("deleteColumn"==r.action)obj.historyProcessColumn(1,r);else if("moveRow"==r.action)obj.moveRow(r.oldValue,r.newValue);else if("moveColumn"==r.action)obj.moveColumn(r.oldValue,r.newValue);else if("setMerge"==r.action)obj.setMerge(r.column,r.colspan,r.rowspan,1);else if("setStyle"==r.action)obj.setStyle(r.newValue,null,null,1);else if("setWidth"==r.action)obj.setWidth(r.column,r.newValue);else if("setHeight"==r.action)obj.setHeight(r.row,r.newValue);else if("setHeader"==r.action)obj.setHeader(r.column,r.newValue);else if("setComments"==r.action)obj.setComments(r.column,r.newValue[0],r.newValue[1]);else if("orderBy"==r.action)obj.updateOrderArrow(r.column,r.order),obj.updateOrder(r.rows);else if("setValue"==r.action){for(var n=0;n<r.records.length;n++)obj.updateCell(r.records[n].col,r.records[n].row,r.records[n].newValue),obj.updateFormulaChain(r.records[n].col,r.records[n].row,t),r.newStyle&&obj.resetStyle(r.newStyle,!0);r.selection||(r.selection=[r.records[0].col,r.records[0].row]),obj.updateSelectionFromCoords(r.selection[0],r.selection[1],r.selection[2],r.selection[3]),obj.updateTable()}}obj.ignoreEvents=e,obj.ignoreHistory=o,"function"==typeof obj.options.onredo&&obj.options.onredo(el,r)},obj.getDropDownValue=function(e,o){var t=[];if(obj.options.columns[e]&&obj.options.columns[e].source){for(var r=[],n=obj.options.columns[e].source,l=0;l<n.length;l++)"object"==typeof n[l]?r[n[l].id]=n[l].name:r[n[l]]=n[l];var s=(""+o).split(";");for(l=0;l<s.length;l++)r[s[l]]&&t.push(r[s[l]])}else console.error("Invalid column");return t.length>0?t.join("; "):""},obj.parseCSV=function(e,o){9==(e=e.replace(/\r?\n$|\r$|\n$/g,"")).charCodeAt(e.length-1)&&(e+="\0"),o=o||",";for(var t=[],r=!1,n=0,l=0,s=0;s<e.length;s++){var i=e[s],a=e[s+1];t[n]=t[n]||[],t[n][l]=t[n][l]||"",'"'==i&&r&&'"'==a?(t[n][l]+=i,++s):'"'!=i?i!=o||r?"\r"!=i||"\n"!=a||r?("\n"!=i||r)&&("\r"!=i||r)?t[n][l]+=i:(++n,l=0):(++n,l=0,++s):++l:r=!r}return t},obj.hash=function(e){var o,t=0;if(0===e.length)return t;for(o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return t},obj.onafterchanges=function(e,o){obj.ignoreEvents||"function"==typeof obj.options.onafterchanges&&obj.options.onafterchanges(e,o)},obj.init=function(){jexcel.current=obj,"function"==typeof jexcel.build&&(jexcel.build(),jexcel.build=null),obj.options.csv?(1==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.csv,method:"GET",dataType:"text",success:function(e){var o=obj.parseCSV(e,obj.options.csvDelimiter);if(1==obj.options.csvHeaders&&o.length>0)for(var t=o.shift(),r=0;r<t.length;r++)obj.options.columns[r]||(obj.options.columns[r]={type:"text",align:obj.options.defaultColAlign,width:obj.options.defaultColWidth}),void 0===obj.options.columns[r].title&&(obj.options.columns[r].title=t[r]);obj.options.data=o,obj.prepareTable(),1==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.options.url?(1==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.url,method:"GET",dataType:"json",success:function(e){obj.options.data=e.data?e.data:e,obj.prepareTable(),1==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.prepareTable()},options&&null!=options.contextMenu?obj.options.contextMenu=options.contextMenu:obj.options.contextMenu=function(e,o,t,r){var n=[];if(null==t)1==obj.options.allowInsertColumn&&n.push({title:obj.options.text.insertANewColumnBefore,onclick:function(){obj.insertColumn(1,parseInt(o),1)}}),1==obj.options.allowInsertColumn&&n.push({title:obj.options.text.insertANewColumnAfter,onclick:function(){obj.insertColumn(1,parseInt(o),0)}}),1==obj.options.allowDeleteColumn&&n.push({title:obj.options.text.deleteSelectedColumns,onclick:function(){obj.deleteColumn(obj.getSelectedColumns().length?void 0:parseInt(o))}}),1==obj.options.allowRenameColumn&&n.push({title:obj.options.text.renameThisColumn,onclick:function(){obj.setHeader(o)}}),1==obj.options.columnSorting&&(n.push({type:"line"}),n.push({title:obj.options.text.orderAscending,onclick:function(){obj.orderBy(o,0)}}),n.push({title:obj.options.text.orderDescending,onclick:function(){obj.orderBy(o,1)}}));else if(1==obj.options.allowInsertRow&&(n.push({title:obj.options.text.insertANewRowBefore,onclick:function(){obj.insertRow(1,parseInt(t),1)}}),n.push({title:obj.options.text.insertANewRowAfter,onclick:function(){obj.insertRow(1,parseInt(t))}})),1==obj.options.allowDeleteRow&&n.push({title:obj.options.text.deleteSelectedRows,onclick:function(){obj.deleteRow(obj.getSelectedRows().length?void 0:parseInt(t))}}),o&&1==obj.options.allowComments){n.push({type:"line"});var l=obj.records[t][o].getAttribute("title")||"";n.push({title:l?obj.options.text.editComments:obj.options.text.addComments,onclick:function(){obj.setComments([o,t],prompt(obj.options.text.comments,l))}}),l&&n.push({title:obj.options.text.clearComments,onclick:function(){obj.setComments([o,t],"")}})}return n.push({type:"line"}),n.push({title:obj.options.text.copy,shortcut:"Ctrl + C",onclick:function(){obj.copy(!0)}}),navigator&&navigator.clipboard&&n.push({title:obj.options.text.paste,shortcut:"Ctrl + V",onclick:function(){obj.selectedCell&&navigator.clipboard.readText().then(function(e){e&&jexcel.current.paste(obj.selectedCell[0],obj.selectedCell[1],e)})}}),obj.options.allowExport&&n.push({title:obj.options.text.saveAs,shortcut:"Ctrl + S",onclick:function(){obj.download()}}),obj.options.about&&n.push({title:obj.options.text.about,onclick:function(){alert(obj.options.about)}}),n},obj.scrollControls=function(e){1==obj.options.lazyLoading&&null==jexcel.timeControlLoading&&(jexcel.timeControlLoading=setTimeout(function(){obj.content.scrollTop+obj.content.clientHeight>=obj.content.scrollHeight?obj.loadDown()&&(obj.content.scrollTop+obj.content.clientHeight>obj.content.scrollHeight-10&&(obj.content.scrollTop=obj.content.scrollTop-obj.content.clientHeight),obj.updateCornerPosition()):obj.content.scrollTop<=obj.content.clientHeight&&obj.loadUp()&&(obj.content.scrollTop<10&&(obj.content.scrollTop=obj.content.scrollTop+obj.content.clientHeight),obj.updateCornerPosition()),jexcel.timeControlLoading=null},100)),1!=obj.options.lazyLoading&&1!=obj.options.tableOverflow||obj.edition&&"jdropdown"!=e.target.className.substr(0,9)&&obj.closeEditor(obj.edition[0],!0)},el.addEventListener("DOMMouseScroll",obj.scrollControls),el.addEventListener("mousewheel",obj.scrollControls),el.jexcel=obj,obj.init(),obj};jexcel.current=null,jexcel.timeControl=null,jexcel.timeControlLoading=null,jexcel.destroy=function(e,o){e.jexcel&&(e.jexcel=null,e.innerHTML="",o&&(document.removeEventListener("keydown",jexcel.keyDownControls),document.removeEventListener("mouseup",jexcel.mouseUpControls),document.removeEventListener("mousedown",jexcel.mouseDownControls),document.removeEventListener("mousemove",jexcel.mouseMoveControls),document.removeEventListener("mouseover",jexcel.mouseOverControls),document.removeEventListener("dblclick",jexcel.doubleClickControls),document.removeEventListener("paste",jexcel.pasteControls),document.removeEventListener("contextmenu",jexcel.contextMenuControls),document.removeEventListener("touchstart",jexcel.touchStartControls),document.removeEventListener("touchend",jexcel.touchEndControls),document.removeEventListener("touchcancel",jexcel.touchEndControls),jexcel=null))},jexcel.build=function(){document.addEventListener("keydown",jexcel.keyDownControls),document.addEventListener("mouseup",jexcel.mouseUpControls),document.addEventListener("mousedown",jexcel.mouseDownControls),document.addEventListener("mousemove",jexcel.mouseMoveControls),document.addEventListener("mouseover",jexcel.mouseOverControls),document.addEventListener("dblclick",jexcel.doubleClickControls),document.addEventListener("paste",jexcel.pasteControls),document.addEventListener("contextmenu",jexcel.contextMenuControls)},jexcel.validLetter=function(e){return e.match(/([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+)/g)?1:0},jexcel.injectArray=function(e,o,t){return e.slice(0,o).concat(t).concat(e.slice(o))},jexcel.getColumnName=function(e){var o="";return e>701?(o+=String.fromCharCode(64+parseInt(e/676)),o+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(o+=String.fromCharCode(64+parseInt(e/26))),o+=String.fromCharCode(65+e%26)},jexcel.getIdFromColumnName=function(e,o){var t=/^[a-zA-Z]+/.exec(e);if(t){for(var r=0,n=0;n<t[0].length;n++)r+=parseInt(t[0].charCodeAt(n)-64)*Math.pow(26,t[0].length-1-n);--r<0&&(r=0);var l=parseInt(/[0-9]+$/.exec(e));l>0&&l--,e=1==o?[r,l]:r+"-"+l}return e},jexcel.getColumnNameFromId=function(e){return Array.isArray(e)||(e=e.split("-")),jexcel.getColumnName(parseInt(e[0]))+(parseInt(e[1])+1)},jexcel.getElement=function(e){var o=0,t=0;return function e(r){r.className&&r.classList.contains("jexcel_container")&&(t=r),"THEAD"==r.tagName?o=1:"TBODY"==r.tagName&&(o=2),r.parentNode&&e(r.parentNode)}(e),[t,o]},jexcel.keyDownControls=function(e){if(jexcel.current){if(jexcel.current.edition)if(27==e.which)jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!1),e.preventDefault();else if(13==e.which)if("calendar"==jexcel.current.options.columns[jexcel.current.edition[2]].type)jexcel.current.editor[0].children[0].calendar.close(1);else if("dropdown"==jexcel.current.options.columns[jexcel.current.edition[2]].type||"autocomplete"==jexcel.current.options.columns[jexcel.current.edition[2]].type);else if((1==jexcel.current.options.wordWrap||1==jexcel.current.options.columns[jexcel.current.edition[2]].wordWrap||jexcel.current.options.data[jexcel.current.edition[3]][jexcel.current.edition[2]].length>200)&&e.altKey){var o=jexcel.current.edition[0].children[0],t=jexcel.current.edition[0].children[0].value,r=o.selectionStart;t=t.slice(0,r)+"\n"+t.slice(r),o.value=t,o.focus(),o.selectionStart=r+1,o.selectionEnd=r+1}else jexcel.current.edition[0].children[0].blur();else 9==e.which&&("calendar"==jexcel.current.options.columns[jexcel.current.edition[2]].type?jexcel.current.edition[0].children[0].calendar.close(1):jexcel.current.edition[0].children[0].blur());if(!jexcel.current.edition&&jexcel.current.selectedCell)if(37==e.which)jexcel.current.left(e.shiftKey,e.ctrlKey),e.preventDefault();else if(39==e.which)jexcel.current.right(e.shiftKey,e.ctrlKey),e.preventDefault();else if(38==e.which)jexcel.current.up(e.shiftKey,e.ctrlKey),e.preventDefault();else if(40==e.which)jexcel.current.down(e.shiftKey,e.ctrlKey),e.preventDefault();else if(36==e.which)jexcel.current.first(e.shiftKey,e.ctrlKey),e.preventDefault();else if(35==e.which)jexcel.current.last(e.shiftKey,e.ctrlKey),e.preventDefault();else if(32==e.which)1==jexcel.current.options.editable&&jexcel.current.setCheckRadioValue(),e.preventDefault();else if(46==e.which)1==jexcel.current.options.editable&&(jexcel.current.selectedRow?1==jexcel.current.options.allowDeleteRow&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedRows)&&jexcel.current.deleteRow():jexcel.current.selectedHeader?1==jexcel.current.options.allowDeleteColumn&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedColumns)&&jexcel.current.deleteColumn():jexcel.current.setValue(jexcel.current.highlighted,""));else if(13==e.which)e.shiftKey?jexcel.current.up():(1==jexcel.current.options.allowInsertRow&&1==jexcel.current.options.allowManualInsertRow&&jexcel.current.selectedCell[1]==jexcel.current.options.data.length-1&&jexcel.current.insertRow(),jexcel.current.down()),e.preventDefault();else if(9==e.which)e.shiftKey?jexcel.current.left():(1==jexcel.current.options.allowInsertColumn&&1==jexcel.current.options.allowManualInsertColumn&&jexcel.current.selectedCell[0]==jexcel.current.options.data[0].length-1&&jexcel.current.insertColumn(),jexcel.current.right()),e.preventDefault();else if(!e.ctrlKey&&!e.metaKey||e.shiftKey){if(jexcel.current.selectedCell&&1==jexcel.current.options.editable){var n=jexcel.current.selectedCell[1],l=jexcel.current.selectedCell[0];"readonly"!=jexcel.current.options.columns[l].type&&(32==e.keyCode?"checkbox"==jexcel.current.options.columns[l].type||"radio"==jexcel.current.options.columns[l].type?e.preventDefault():jexcel.current.openEditor(jexcel.current.records[n][l],!0):113==e.keyCode?jexcel.current.openEditor(jexcel.current.records[n][l],!1):(8==e.keyCode||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=97&&e.keyCode<=111||187==e.keyCode||(String.fromCharCode(e.keyCode)==e.key||String.fromCharCode(e.keyCode).toLowerCase()==e.key.toLowerCase())&&jexcel.validLetter(String.fromCharCode(e.keyCode)))&&(jexcel.current.openEditor(jexcel.current.records[n][l],!0),"calendar"==jexcel.current.options.columns[l].type&&e.preventDefault()))}}else 65==e.which?(jexcel.current.selectAll(),e.preventDefault()):83==e.which?(jexcel.current.download(),e.preventDefault()):89==e.which?(jexcel.current.redo(),e.preventDefault()):90==e.which?(jexcel.current.undo(),e.preventDefault()):67==e.which?(jexcel.current.copy(!0),e.preventDefault()):67==e.which?(jexcel.current.copy(!0),e.preventDefault()):88==e.which?(1==jexcel.current.options.editable?jexcel.cutControls():jexcel.copyControls(),e.preventDefault()):86==e.which&&jexcel.pasteControls();else e.target.classList.contains("jexcel_search")&&(jexcel.timeControl&&clearTimeout(jexcel.timeControl),jexcel.timeControl=setTimeout(function(){jexcel.current.search(e.target.value)},200))}},jexcel.isMouseAction=!1,jexcel.mouseDownControls=function(e){if((e=e||window.event).buttons)var o=e.buttons;else if(e.button)o=e.button;else o=e.which;var t=jexcel.getElement(e.target);if(t[0]?jexcel.current!=t[0].jexcel&&(jexcel.current&&jexcel.current.resetSelection(),jexcel.current=t[0].jexcel):jexcel.current&&(jexcel.current.resetSelection(!0),jexcel.current=null),jexcel.current&&1==o){if(e.target.classList.contains("jexcel_selectall"))jexcel.current&&jexcel.current.selectAll();else if(e.target.classList.contains("jexcel_corner"))1==jexcel.current.options.editable&&(jexcel.current.selectedCorner=!0);else{if(1==t[1]){if(j=e.target.getAttribute("data-x")){var r=e.target.getBoundingClientRect();if(1==jexcel.current.options.columnResize&&r.width-e.offsetX<6){jexcel.current.resizing={mousePosition:e.pageX,column:j,width:r.width},jexcel.current.headers[j].classList.add("resizing");for(var n=0;n<jexcel.current.records.length;n++)jexcel.current.records[n][j]&&jexcel.current.records[n][j].classList.add("resizing")}else if(1==jexcel.current.options.columnDrag&&r.height-e.offsetY<6)if(jexcel.current.isColMerged(j).length)console.error("JEXCEL: This column is part of a merged cell.");else{jexcel.current.resetSelection(),jexcel.current.dragging={element:e.target,column:j,destination:j},jexcel.current.headers[j].classList.add("dragging");for(n=0;n<jexcel.current.records.length;n++)jexcel.current.records[n][j]&&jexcel.current.records[n][j].classList.add("dragging")}else{if(jexcel.current.selectedHeader&&(e.shiftKey||e.ctrlKey))var l=jexcel.current.selectedHeader,s=j;else{jexcel.current.selectedHeader==j&&1==jexcel.current.options.allowRenameColumn&&(jexcel.timeControl=setTimeout(function(){jexcel.current.setHeader(j)},800)),jexcel.current.selectedHeader=j;l=j,s=j}jexcel.current.updateSelectionFromCoords(l,0,s,jexcel.current.options.data.length-1)}}else if(e.target.parentNode.classList.contains("jexcel_nested")){var i=e.target.getAttribute("data-column").split(","),a=parseInt(i[0]),u=parseInt(i[i.length-1]);jexcel.current.updateSelectionFromCoords(a,0,u,jexcel.current.options.data.length-1)}}else jexcel.current.selectedHeader=!1;if(2==t[1]){var c=e.target.getAttribute("data-y");if(e.target.classList.contains("jexcel_row")){r=e.target.getBoundingClientRect();if(1==jexcel.current.options.rowResize&&r.height-e.offsetY<6)jexcel.current.resizing={element:e.target.parentNode,mousePosition:e.pageY,row:c,height:r.height},e.target.parentNode.classList.add("resizing");else if(1==jexcel.current.options.rowDrag&&r.width-e.offsetX<6)jexcel.current.isRowMerged(c).length?console.error("JEXCEL: This row is part of a merged cell"):1==jexcel.current.options.search&&jexcel.current.results?console.error("JEXCEL: Please clear your search before perform this action"):(jexcel.current.resetSelection(),jexcel.current.dragging={element:e.target.parentNode,row:c,destination:c},e.target.parentNode.classList.add("dragging"));else{if(jexcel.current.selectedRow&&(e.shiftKey||e.ctrlKey))l=jexcel.current.selectedRow,s=c;else{jexcel.current.selectedRow=c;l=c,s=c}jexcel.current.updateSelectionFromCoords(0,l,jexcel.current.options.data[0].length-1,s)}}else if(e.target.classList.contains("jclose")&&e.target.clientWidth-e.offsetX<50&&e.offsetY<50)jexcel.current.closeEditor(jexcel.current.edition[0],!0);else{var d=function(e){var o=e.getAttribute("data-x"),t=e.getAttribute("data-y");return o&&t?[o,t]:e.parentNode?d(e.parentNode):void 0},b=d(e.target);if(b){var j=b[0];c=b[1];jexcel.current.edition&&(jexcel.current.edition[2]==j&&jexcel.current.edition[3]==c||jexcel.current.closeEditor(jexcel.current.edition[0],!0)),jexcel.current.edition||(e.shiftKey?jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],j,c):jexcel.current.updateSelectionFromCoords(j,c)),jexcel.current.selectedHeader=null,jexcel.current.selectedRow=null}}}else jexcel.current.selectedRow=!1;e.target.classList.contains("jexcel_page")&&("<"==e.target.innerText?jexcel.current.page(0):">"==e.target.innerText?jexcel.current.page(e.target.getAttribute("title")-1):jexcel.current.page(e.target.innerText-1))}jexcel.current.edition?jexcel.isMouseAction=!1:jexcel.isMouseAction=!0}else jexcel.isMouseAction=!1},jexcel.mouseUpControls=function(e){if(jexcel.current)if(jexcel.current.resizing){if(jexcel.current.resizing.column){jexcel.current.headers[jexcel.current.resizing.column].classList.remove("resizing");var o=jexcel.current.colgroup[jexcel.current.resizing.column].getAttribute("width");jexcel.current.setWidth(jexcel.current.resizing.column,o,jexcel.current.resizing.width),jexcel.current.headers[jexcel.current.resizing.column].classList.remove("resizing");for(var t=0;t<jexcel.current.records.length;t++)jexcel.current.records[t][jexcel.current.resizing.column]&&jexcel.current.records[t][jexcel.current.resizing.column].classList.remove("resizing")}else{jexcel.current.rows[jexcel.current.resizing.row].children[0].classList.remove("resizing");var r=jexcel.current.rows[jexcel.current.resizing.row].getAttribute("height");jexcel.current.setHeight(jexcel.current.resizing.row,r,jexcel.current.resizing.height),jexcel.current.resizing.element.classList.remove("resizing")}jexcel.current.resizing=null}else if(jexcel.current.dragging){if(jexcel.current.dragging){if(jexcel.current.dragging.column){var n=e.target.getAttribute("data-x");jexcel.current.headers[jexcel.current.dragging.column].classList.remove("dragging");for(t=0;t<jexcel.current.rows.length;t++)jexcel.current.records[t][jexcel.current.dragging.column]&&jexcel.current.records[t][jexcel.current.dragging.column].classList.remove("dragging");for(var l=0;l<jexcel.current.headers.length;l++)jexcel.current.headers[l].classList.remove("dragging-left"),jexcel.current.headers[l].classList.remove("dragging-right");n&&jexcel.current.dragging.column!=jexcel.current.dragging.destination&&jexcel.current.moveColumn(jexcel.current.dragging.column,jexcel.current.dragging.destination)}else{var s=Array.prototype.indexOf.call(jexcel.current.dragging.element.parentNode.children,jexcel.current.dragging.element);jexcel.current.dragging.row!=s&&jexcel.current.moveRow(jexcel.current.dragging.row,s,!0),jexcel.current.dragging.element.classList.remove("dragging")}jexcel.current.dragging=null}}else jexcel.current.selectedCorner&&(jexcel.current.selectedCorner=!1,jexcel.current.selection.length>0&&(jexcel.current.copyData(jexcel.current.selection[0],jexcel.current.selection[jexcel.current.selection.length-1]),jexcel.current.removeCopySelection()));jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null),jexcel.isMouseAction=!1},jexcel.mouseMoveControls=function(e){if((e=e||window.event).buttons)var o=e.buttons;else if(e.button)o=e.button;else o=e.which;if(o||(jexcel.isMouseAction=!1),jexcel.current)if(1==jexcel.isMouseAction){if(jexcel.current.resizing)if(jexcel.current.resizing.column){var t=e.pageX-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.width+t>0){var r=jexcel.current.resizing.width+t;jexcel.current.colgroup[jexcel.current.resizing.column].setAttribute("width",r),jexcel.current.updateCornerPosition()}}else{var n=e.pageY-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.height+n>0){var l=jexcel.current.resizing.height+n;jexcel.current.rows[jexcel.current.resizing.row].setAttribute("height",l),jexcel.current.updateCornerPosition()}}}else{var s=e.target.getAttribute("data-x"),i=e.target.getAttribute("data-y"),a=e.target.getBoundingClientRect();jexcel.current.cursor&&(jexcel.current.cursor.style.cursor="",jexcel.current.cursor=null),e.target.parentNode.parentNode&&e.target.parentNode.parentNode.className&&(e.target.parentNode.parentNode.classList.contains("resizable")&&(e.target&&s&&!i&&a.width-(e.clientX-a.left)<6?(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="col-resize"):e.target&&!s&&i&&a.height-(e.clientY-a.top)<6&&(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="row-resize")),e.target.parentNode.parentNode.classList.contains("draggable")&&(e.target&&!s&&i&&a.width-(e.clientX-a.left)<6?(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="move"):e.target&&s&&!i&&a.height-(e.clientY-a.top)<6&&(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="move")))}},jexcel.mouseOverControls=function(e){if((e=e||window.event).buttons)var o=e.buttons;else if(e.button)o=e.button;else o=e.which;if(o||(jexcel.isMouseAction=!1),jexcel.current&&1==jexcel.isMouseAction){var t=jexcel.getElement(e.target);if(t[0]){if(jexcel.current!=t[0].jexcel&&jexcel.current)return!1;var r=e.target.getAttribute("data-x"),n=e.target.getAttribute("data-y");if(jexcel.current.dragging){if(jexcel.current.dragging.column){if(r)if(jexcel.current.isColMerged(r).length)console.error("JEXCEL: This column is part of a merged cell.");else{for(var l=0;l<jexcel.current.headers.length;l++)jexcel.current.headers[l].classList.remove("dragging-left"),jexcel.current.headers[l].classList.remove("dragging-right");jexcel.current.dragging.column==r?jexcel.current.dragging.destination=parseInt(r):e.target.clientWidth/2>e.offsetX?(jexcel.current.dragging.column<r?jexcel.current.dragging.destination=parseInt(r)-1:jexcel.current.dragging.destination=parseInt(r),jexcel.current.headers[r].classList.add("dragging-left")):(jexcel.current.dragging.column<r?jexcel.current.dragging.destination=parseInt(r):jexcel.current.dragging.destination=parseInt(r)+1,jexcel.current.headers[r].classList.add("dragging-right"))}}else if(n)if(jexcel.current.isRowMerged(n).length)console.error("JEXCEL: This row is part of a merged cell.");else{var s=e.target.clientHeight/2>e.offsetY?e.target.parentNode.nextSibling:e.target.parentNode;e.target.parentNode.parentNode.insertBefore(jexcel.current.dragging.element,s)}}else if(jexcel.current.resizing);else{if(1==t[1]&&jexcel.current.selectedHeader){r=e.target.getAttribute("data-x");var i=jexcel.current.selectedHeader,a=r;jexcel.current.updateSelectionFromCoords(i,0,a,jexcel.current.options.data.length-1)}if(2==t[1])if(e.target.classList.contains("jexcel_row")){if(jexcel.current.selectedRow){i=jexcel.current.selectedRow,a=n;jexcel.current.updateSelectionFromCoords(0,i,jexcel.current.options.data[0].length-1,a)}}else jexcel.current.edition||r&&n&&(jexcel.current.selectedCorner?jexcel.current.updateCopySelection(r,n):jexcel.current.selectedCell&&jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],r,n))}}}jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null)},jexcel.doubleClickControls=function(e){if(jexcel.current)if(e.target.classList.contains("jexcel_corner")){if(jexcel.current.highlighted.length>0){var o=jexcel.current.highlighted[0].getAttribute("data-x"),t=parseInt(jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-y"))+1,r=jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-x"),n=jexcel.current.records.length-1;jexcel.current.copyData(jexcel.current.records[t][o],jexcel.current.records[n][r])}}else{var l=jexcel.getElement(e.target);if(1==l[1]&&1==jexcel.current.options.columnSorting){var s=e.target.getAttribute("data-x");s&&jexcel.current.orderBy(s)}if(2==l[1]&&1==jexcel.current.options.editable&&!jexcel.current.edition){var i=function(e){if(e.parentNode){var o=e.getAttribute("data-x"),t=e.getAttribute("data-y");return o&&t?e:i(e.parentNode)}},a=i(e.target);a&&a.classList.contains("highlight")&&jexcel.current.openEditor(a)}}},jexcel.copyControls=function(e){jexcel.current&&jexcel.copyControls.enabled&&(jexcel.current.edition||jexcel.current.copy(!0))},jexcel.cutControls=function(e){jexcel.current&&(jexcel.current.edition||(jexcel.current.copy(!0),1==jexcel.current.options.editable&&jexcel.current.setValue(jexcel.current.highlighted,"")))},jexcel.pasteControls=function(e){jexcel.current&&jexcel.current.selectedCell&&(jexcel.current.edition||1==jexcel.current.options.editable&&(e&&e.clipboardData?(jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],e.clipboardData.getData("text")),e.preventDefault()):window.clipboardData&&jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],window.clipboardData.getData("text"))))},jexcel.contextMenuControls=function(e){if("buttons"in(e=e||window.event))e.buttons;else e.which||e.button;if(jexcel.current)if(jexcel.current.edition)e.preventDefault();else if(jexcel.current.options.contextMenu&&(jexcel.current.contextMenu.contextmenu.close(),jexcel.current)){var o=e.target.getAttribute("data-x"),t=e.target.getAttribute("data-y");if(o||t){var r=jexcel.current.options.contextMenu(jexcel.current,o,t,e);jexcel.current.contextMenu.contextmenu.open(e,r),e.preventDefault()}}},jexcel.createTabs=function(e,o){e.innerHTML="",e.classList.add("jexcel_tabs");for(var t=[],r=[],n=0;n<o.length;n++)t[n]=document.createElement("div"),t[n].classList.add("jexcel_tab"),r[n]=document.createElement("div"),r[n].classList.add("jexcel_tab_link"),r[n].setAttribute("data-spreadsheet",n),r[n].innerHTML=o[n].sheetName,r[n].onclick=function(){for(var e=0;e<t.length;e++)t[e].style.display="none",r[e].classList.remove("selected");var o=this.getAttribute("data-spreadsheet");t[o].style.display="block",r[o].classList.add("selected")},e.appendChild(r[n]);for(n=0;n<t.length-1;n++)e.appendChild(t[n]),jexcel(t[n],o[n]);t[0].style.display="block",r[0].classList.add("selected")},jexcel.fromSpreadsheet=function(e,o){var t,r=function(e){var o=[];return e.SheetNames.forEach(function(t){var r={rows:[],columns:[],data:[],style:{}};if(r.sheetName=t,(b=e.Sheets[t]["!cols"])&&b.length)for(var n=0;n<b.length;n++)r.columns[n]={},b[n]&&b[n].wpx&&(r.columns[n].width=b[n].wpx+"px");if((b=e.Sheets[t]["!rows"])&&b.length)for(n=0;n<b.length;n++)b[n]&&b[n].hpx&&(r.rows[n]={},r.rows[n].height=b[n].hpx+"px");if((b=e.Sheets[t]["!merges"])&&b.length>0){r.mergeCells=[];for(n=0;n<b.length;n++){var l=b[n].s.c,s=b[n].s.r,i=b[n].e.c,a=b[n].e.r,u=jexcel.getColumnNameFromId([l,s]);r.mergeCells[u]=[i-l+1,a-s+1]}}var c=0,d=0,b=Object.keys(e.Sheets[t]);for(n=0;n<b.length;n++)if("!"!=b[n].substr(0,1)){var j=e.Sheets[t][b[n]],p=jexcel.getIdFromColumnName(b[n],!0);r.data[p[1]]||(r.data[p[1]]=[]),r.data[p[1]][p[0]]=j.f?"="+j.f:j.w,c<p[0]&&(c=p[0]),d<p[1]&&(d=p[1]),j.style&&Object.keys(j.style).length>0&&(r.style[b[n]]=j.style),j.s&&j.s.fgColor&&(r.style[b[n]]&&(r.style[b[n]]+=";"),r.style[b[n]]+="background-color:#"+j.s.fgColor.rgb)}for(var f=r.columns,g=0;g<=d;g++)for(n=0;n<=c;n++)r.data[g]||(r.data[g]=[]),r.data[g][n]||f<n&&(r.data[g][n]="");o.push(r)}),o};(t=new XMLHttpRequest).open("GET",e,!0),"undefined"!=typeof Uint8Array?(t.responseType="arraybuffer",t.onload=function(e){var n=t.response,l=new Uint8Array(n),s=XLSX.read(l,{type:"array",cellFormula:!0,cellStyles:!0});o(r(s))}):(t.setRequestHeader("Accept-Charset","x-user-defined"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=convertResponseBodyToText(t.responseBody),n=XLSX.read(e,{type:"binary",cellFormula:!0,cellStyles:!0});o(r(n))}}),t.send()};var error=function(){var e={};return e.nil=new Error("#NULL!"),e.div0=new Error("#DIV/0!"),e.value=new Error("#VALUE!"),e.ref=new Error("#REF!"),e.name=new Error("#NAME?"),e.num=new Error("#NUM!"),e.na=new Error("#N/A"),e.error=new Error("#ERROR!"),e.data=new Error("#GETTING_DATA"),e}(),utils=function(){var e={flattenShallow:function(e){return e&&e.reduce?e.reduce(function(e,o){var t=Array.isArray(e),r=Array.isArray(o);return t&&r?e.concat(o):t?(e.push(o),e):r?[e].concat(o):[e,o]}):e},isFlat:function(e){if(!e)return!1;for(var o=0;o<e.length;++o)if(Array.isArray(e[o]))return!1;return!0},flatten:function(){for(var o=e.argsToArray.apply(null,arguments);!e.isFlat(o);)o=e.flattenShallow(o);return o},argsToArray:function(o){var t=[];return e.arrayEach(o,function(e){t.push(e)}),t},numbers:function(){return this.flatten.apply(null,arguments).filter(function(e){return"number"==typeof e})},cleanFloat:function(e){return Math.round(1e14*e)/1e14},parseBool:function(e){if("boolean"==typeof e)return e;if(e instanceof Error)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){var o=e.toUpperCase();if("TRUE"===o)return!0;if("FALSE"===o)return!1}return e instanceof Date&&!isNaN(e)||error.value},parseNumber:function(e){return void 0===e||""===e?error.value:isNaN(e)?error.value:parseFloat(e)},parseNumberArray:function(o){var t,r;if(!o||0===(t=o.length))return error.value;for(;t--;){if((r=e.parseNumber(o[t]))===error.value)return r;o[t]=r}return o},parseMatrix:function(o){var t;if(!o||0===o.length)return error.value;for(var r=0;r<o.length;r++)if(t=e.parseNumberArray(o[r]),o[r]=t,t instanceof Error)return t;return o}},o=new Date(Date.UTC(1900,0,1));return e.parseDate=function(e){if(!isNaN(e)){if(e instanceof Date)return new Date(e);var t=parseInt(e,10);return t<0?error.num:t<=60?new Date(o.getTime()+864e5*(t-1)):new Date(o.getTime()+864e5*(t-2))}return"string"!=typeof e||(e=new Date(e),isNaN(e))?error.value:e},e.parseDateArray=function(e){for(var o,t=e.length;t--;){if((o=this.parseDate(e[t]))===error.value)return o;e[t]=o}return e},e.anyIsError=function(){for(var e=arguments.length;e--;)if(arguments[e]instanceof Error)return!0;return!1},e.arrayValuesToNumbers=function(e){for(var o,t=e.length;t--;)if("number"!=typeof(o=e[t]))if(!0!==o)if(!1!==o){if("string"==typeof o){var r=this.parseNumber(o);r instanceof Error?e[t]=0:e[t]=r}}else e[t]=0;else e[t]=1;return e},e.rest=function(e,o){return o=o||1,e&&"function"==typeof e.slice?e.slice(o):e},e.initial=function(e,o){return o=o||1,e&&"function"==typeof e.slice?e.slice(0,e.length-o):e},e.arrayEach=function(e,o){for(var t=-1,r=e.length;++t<r&&!1!==o(e[t],t,e););return e},e.transpose=function(e){return e?e[0].map(function(o,t){return e.map(function(e){return e[t]})}):error.value},e}();jexcel.methods={},jexcel.methods.math=function(){var exports={ABS:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.abs(utils.parseNumber(e))},ACOS:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.acos(e)},ACOSH:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e+Math.sqrt(e*e-1))},ACOT:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.atan(1/e)},ACOTH:function(e){return(e=utils.parseNumber(e))instanceof Error?e:.5*Math.log((e+1)/(e-1))},AGGREGATE:null,ARABIC:function(e){if(!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(e))return error.value;var o=0;return e.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,function(e){o+={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1}[e]}),o},ASIN:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.asin(e)},ASINH:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e+Math.sqrt(e*e+1))},ATAN:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.atan(e)},ATAN2:function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:Math.atan2(e,o)},ATANH:function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log((1+e)/(1-e))/2},BASE:function(e,o,t){if(t=t||0,e=utils.parseNumber(e),o=utils.parseNumber(o),t=utils.parseNumber(t),utils.anyIsError(e,o,t))return error.value;t=void 0===t?0:t;var r=e.toString(o);return new Array(Math.max(t+1-r.length,0)).join("0")+r},CEILING:function(e,o,t){return o=void 0===o?1:o,t=void 0===t?0:t,e=utils.parseNumber(e),o=utils.parseNumber(o),t=utils.parseNumber(t),utils.anyIsError(e,o,t)?error.value:0===o?0:(o=Math.abs(o),e>=0?Math.ceil(e/o)*o:0===t?-1*Math.floor(Math.abs(e)/o)*o:-1*Math.ceil(Math.abs(e)/o)*o)}};exports.CEILING.MATH=exports.CEILING,exports.CEILING.PRECISE=exports.CEILING,exports.COMBIN=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:exports.FACT(e)/(exports.FACT(o)*exports.FACT(e-o))},exports.COMBINA=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:0===e&&0===o?1:exports.COMBIN(e+o-1,e-1)},exports.COS=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.cos(e)},exports.COSH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:(Math.exp(e)+Math.exp(-e))/2},exports.COT=function(e){return(e=utils.parseNumber(e))instanceof Error?e:1/Math.tan(e)},exports.COTH=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var o=Math.exp(2*e);return(o+1)/(o-1)},exports.CSC=function(e){return(e=utils.parseNumber(e))instanceof Error?e:1/Math.sin(e)},exports.CSCH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:2/(Math.exp(e)-Math.exp(-e))},exports.DECIMAL=function(e,o){return arguments.length<1?error.value:parseInt(e,o)},exports.DEGREES=function(e){return(e=utils.parseNumber(e))instanceof Error?e:180*e/Math.PI},exports.EVEN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:exports.CEILING(e,-2,-1)},exports.EXP=Math.exp;var MEMOIZED_FACT=[];return exports.FACT=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var o=Math.floor(e);return 0===o||1===o?1:MEMOIZED_FACT[o]>0?MEMOIZED_FACT[o]:(MEMOIZED_FACT[o]=exports.FACT(o-1)*o,MEMOIZED_FACT[o])},exports.FACTDOUBLE=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var o=Math.floor(e);return o<=0?1:o*exports.FACTDOUBLE(o-2)},exports.FLOOR=function(e,o,t){return o=void 0===o?1:o,t=void 0===t?0:t,e=utils.parseNumber(e),o=utils.parseNumber(o),t=utils.parseNumber(t),utils.anyIsError(e,o,t)?error.value:0===o?0:(o=Math.abs(o),e>=0?Math.floor(e/o)*o:0===t?-1*Math.ceil(Math.abs(e)/o)*o:-1*Math.floor(Math.abs(e)/o)*o)},exports.FLOOR.MATH=exports.FLOOR,exports.GCD=null,exports.INT=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.floor(e)},exports.LCM=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var o,t,r,n,l=1;void 0!==(r=e.pop());)for(;r>1;){if(r%2){for(o=3,t=Math.floor(Math.sqrt(r));o<=t&&r%o;o+=2);n=o<=t?o:r}else n=2;for(r/=n,l*=n,o=e.length;o;e[--o]%n==0&&1==(e[o]/=n)&&e.splice(o,1));}return l},exports.LN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e)},exports.LOG=function(e,o){return e=utils.parseNumber(e),o=void 0===o?10:utils.parseNumber(o),utils.anyIsError(e,o)?error.value:Math.log(e)/Math.log(o)},exports.LOG10=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e)/Math.log(10)},exports.MDETERM=null,exports.MINVERSE=null,exports.MMULT=null,exports.MOD=function(e,o){if(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o))return error.value;if(0===o)return error.div0;var t=Math.abs(e%o);return o>0?t:-t},exports.MROUND=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:e*o<0?error.num:Math.round(e/o)*o},exports.MULTINOMIAL=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var o=0,t=1,r=0;r<e.length;r++)o+=e[r],t*=exports.FACT(e[r]);return exports.FACT(o)/t},exports.MUNIT=null,exports.ODD=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var o=Math.ceil(Math.abs(e));return o=1&o?o:o+1,e>0?o:-o},exports.PI=function(){return Math.PI},exports.POWER=function(e,o){if(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o))return error.value;var t=Math.pow(e,o);return isNaN(t)?error.num:t},exports.PRODUCT=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var o=1,t=0;t<e.length;t++)o*=e[t];return o},exports.QUOTIENT=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:parseInt(e/o,10)},exports.RADIANS=function(e){return(e=utils.parseNumber(e))instanceof Error?e:e*Math.PI/180},exports.RAND=function(){return Math.random()},exports.RANDBETWEEN=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:e+Math.ceil((o-e+1)*Math.random())-1},exports.ROMAN=null,exports.ROUND=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:Math.round(e*Math.pow(10,o))/Math.pow(10,o)},exports.ROUNDDOWN=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:(e>0?1:-1)*Math.floor(Math.abs(e)*Math.pow(10,o))/Math.pow(10,o)},exports.ROUNDUP=function(e,o){return e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:(e>0?1:-1)*Math.ceil(Math.abs(e)*Math.pow(10,o))/Math.pow(10,o)},exports.SEC=function(e){return(e=utils.parseNumber(e))instanceof Error?e:1/Math.cos(e)},exports.SECH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:2/(Math.exp(e)+Math.exp(-e))},exports.SERIESSUM=function(e,o,t,r){if(e=utils.parseNumber(e),o=utils.parseNumber(o),t=utils.parseNumber(t),r=utils.parseNumberArray(r),utils.anyIsError(e,o,t,r))return error.value;for(var n=r[0]*Math.pow(e,o),l=1;l<r.length;l++)n+=r[l]*Math.pow(e,o+l*t);return n},exports.SIGN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:e<0?-1:0===e?0:1},exports.SIN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.sin(e)},exports.SINH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:(Math.exp(e)-Math.exp(-e))/2},exports.SQRT=function(e){return(e=utils.parseNumber(e))instanceof Error?e:e<0?error.num:Math.sqrt(e)},exports.SQRTPI=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.sqrt(e*Math.PI)},exports.SUBTOTAL=null,exports.ADD=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:e+o)},exports.MINUS=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:e-o)},exports.DIVIDE=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:0===o?error.div0:e/o)},exports.MULTIPLY=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:e*o)},exports.GTE=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.error:e>=o)},exports.LT=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.error:e<o)},exports.LTE=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.error:e<=o)},exports.EQ=function(e,o){return 2!==arguments.length?error.na:e===o},exports.NE=function(e,o){return 2!==arguments.length?error.na:e!==o},exports.POW=function(e,o){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.error:exports.POWER(e,o))},exports.SUM=function(){for(var e=0,o=Object.keys(arguments),t=0;t<o.length;++t){var r=arguments[o[t]];if("number"==typeof r)e+=r;else if("string"==typeof r){var n=parseFloat(r);!isNaN(n)&&(e+=n)}else Array.isArray(r)&&(e+=exports.SUM.apply(null,r))}return e},exports.SUMIF=function(range,criteria){if(range=utils.parseNumberArray(utils.flatten(range)),range instanceof Error)return range;for(var result=0,i=0;i<range.length;i++)result+=eval(range[i]+criteria)?range[i]:0;return result},exports.SUMIFS=function(){var args=utils.argsToArray(arguments),range=utils.parseNumberArray(utils.flatten(args.shift()));if(range instanceof Error)return range;for(var criteria=args,n_range_elements=range.length,n_criterias=criteria.length,result=0,i=0;i<n_range_elements;i++){for(var el=range[i],condition="",c=0;c<n_criterias;c++)condition+=el+criteria[c],c!==n_criterias-1&&(condition+="&&");eval(condition)&&(result+=el)}return result},exports.SUMPRODUCT=null,exports.SUMSQ=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var o=0,t=e.length,r=0;r<t;r++)o+=ISNUMBER(e[r])?e[r]*e[r]:0;return o},exports.SUMX2MY2=function(e,o){if(e=utils.parseNumberArray(utils.flatten(e)),o=utils.parseNumberArray(utils.flatten(o)),utils.anyIsError(e,o))return error.value;for(var t=0,r=0;r<e.length;r++)t+=e[r]*e[r]-o[r]*o[r];return t},exports.SUMX2PY2=function(e,o){if(e=utils.parseNumberArray(utils.flatten(e)),o=utils.parseNumberArray(utils.flatten(o)),utils.anyIsError(e,o))return error.value;var t=0;e=utils.parseNumberArray(utils.flatten(e)),o=utils.parseNumberArray(utils.flatten(o));for(var r=0;r<e.length;r++)t+=e[r]*e[r]+o[r]*o[r];return t},exports.SUMXMY2=function(e,o){if(e=utils.parseNumberArray(utils.flatten(e)),o=utils.parseNumberArray(utils.flatten(o)),utils.anyIsError(e,o))return error.value;var t=0;e=utils.flatten(e),o=utils.flatten(o);for(var r=0;r<e.length;r++)t+=Math.pow(e[r]-o[r],2);return t},exports.TAN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.tan(e)},exports.TANH=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var o=Math.exp(2*e);return(o-1)/(o+1)},exports.TRUNC=function(e,o){return o=void 0===o?0:o,e=utils.parseNumber(e),o=utils.parseNumber(o),utils.anyIsError(e,o)?error.value:(e>0?1:-1)*Math.floor(Math.abs(e)*Math.pow(10,o))/Math.pow(10,o)},exports}(),jexcel.methods.stats=function(){var e={AVEDEV:null,AVERAGE:function(){for(var e=utils.numbers(utils.flatten(arguments)),o=e.length,t=0,r=0,n=0;n<o;n++)t+=e[n],r+=1;return t/r},MAX:function(){var e=utils.numbers(utils.flatten(arguments));return 0===e.length?0:Math.max.apply(Math,e)},MIN:function(){var e=utils.numbers(utils.flatten(arguments));return 0===e.length?0:Math.min.apply(Math,e)}};return e}();for(var i=0;i<Object.keys(jexcel.methods).length;i++)for(var methods=jexcel.methods[Object.keys(jexcel.methods)[i]],j=0;j<Object.keys(methods).length;j++)"function"==typeof methods[Object.keys(methods)[j]]?window[Object.keys(methods)[j]]=methods[Object.keys(methods)[j]]:window[Object.keys(methods)[j]]=function(){return Object.keys(methods)[j]+"Not implemented"};var jSuites=function(e){var o={};o.el=document.querySelector(".app"),o.backdrop=document.createElement("div"),o.backdrop.classList.add("jbackdrop"),o.getWindowWidth=function(){var e=window,o=document,t=o.documentElement,r=o.getElementsByTagName("body")[0];return e.innerWidth||t.clientWidth||r.clientWidth},o.getWindowHeight=function(){var e=window,o=document,t=o.documentElement,r=o.getElementsByTagName("body")[0];return e.innerHeight||t.clientHeight||r.clientHeight},o.getPosition=function(e){if(e.changedTouches&&e.changedTouches[0])var o=e.changedTouches[0].pageX,t=e.changedTouches[0].pageY;else o=window.Event?e.pageX:e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft),t=window.Event?e.pageY:e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop);return[o,t]},o.click=function(e){if(e.click)e.click();else{var o=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(o)}},o.getElement=function(e,o){var t=!1;return function e(r){r.className&&r.classList.contains(o)&&(t=r),r.parentNode&&e(r.parentNode)}(e),t},o.getLinkElement=function(e){var o=!1;return function e(t){"A"!=t.tagName&&"DIV"!=t.tagName||!t.getAttribute("data-href")||(o=t),t.parentNode&&e(t.parentNode)}(e),o},o.getFormElements=function(e){var o={};if(e)var t=e.querySelectorAll("input, select, textarea");else t=document.querySelectorAll("input, select, textarea");for(var r=0;r<t.length;r++){var n=t[r],l=n.name,s=n.value;l&&(o[l]=s)}return o},o.exists=function(e,o){var t=new XMLHttpRequest;t.open("HEAD",e,!1),t.send(),t.status&&o(t.status)},o.getFiles=function(e){e||console.error("No element defined in the arguments of your method");var o=e.querySelectorAll(".jfile");if(o.length>0){for(var t=[],r=0;r<o.length;r++){var n={},l=o[r].getAttribute("src");o[r].classList.contains("jremove")?n.remove=1:("data"==l.substr(0,4)?(n.content=l.substr(l.indexOf(",")+1),n.extension=o[r].getAttribute("data-extension")):(n.file=l,n.extension=o[r].getAttribute("data-extension"),n.extension||(n.extension=l.substr(l.lastIndexOf(".")+1)),jSuites.files[n.file]&&(n.content=jSuites.files[n.file])),o[r].getAttribute("data-name")&&(n.name=o[r].getAttribute("data-name")),o[r].getAttribute("data-file")&&(n.file=o[r].getAttribute("data-file")),o[r].getAttribute("data-size")&&(n.size=o[r].getAttribute("data-size")),o[r].getAttribute("data-date")&&(n.date=o[r].getAttribute("data-date")),o[r].getAttribute("data-cover")&&(n.cover=o[r].getAttribute("data-cover"))),t[r]=n}return t}},o.ajax=function(e){if(e.data||(e.data={}),e.type&&(e.method=e.type),e.data){var o=[],t=Object.keys(e.data);if(t.length)for(var r=0;r<t.length;r++)if("object"==typeof e.data[t[r]])for(var n=e.data[t[r]],l=0;l<n.length;l++)if("string"==typeof n[l])o.push(t[r]+"["+l+"]="+encodeURIComponent(n[l]));else for(var s=Object.keys(n[l]),i=0;i<s.length;i++)o.push(t[r]+"["+l+"]["+s[i]+"]="+encodeURIComponent(n[l][s[i]]));else o.push(t[r]+"="+encodeURIComponent(e.data[t[r]]));"GET"==e.method&&o.length>0&&(e.url.indexOf("?")<0&&(e.url+="?"),e.url+=o.join("&"))}var a=new XMLHttpRequest;return a.open(e.method,e.url,!0),"POST"==e.method?(a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):"json"==e.dataType&&a.setRequestHeader("Content-Type","text/json"),a.setRequestHeader("pragma","no-cache"),a.setRequestHeader("cache-control","no-cache"),a.onload=function(){if(200===a.status){if("json"==e.dataType)var o=JSON.parse(a.responseText);else o=a.responseText;e.success&&"function"==typeof e.success&&e.success(o)}else e.error&&"function"==typeof e.error&&e.error(a.responseText);if(e.multiple&&e.multiple.length){var t=e.multiple[e.multiple.indexOf(a)];e.multiple.splice(t,1),e.multiple.length||e.complete&&"function"==typeof e.complete&&e.complete(o)}},o?a.send(o.join("&")):a.send(),a},o.slideLeft=function(e,o,t){1==o?(e.classList.add("slide-left-in"),setTimeout(function(){e.classList.remove("slide-left-in"),"function"==typeof t&&t()},400)):(e.classList.add("slide-left-out"),setTimeout(function(){e.classList.remove("slide-left-out"),"function"==typeof t&&t()},400))},o.slideRight=function(e,o,t){1==o?(e.classList.add("slide-right-in"),setTimeout(function(){e.classList.remove("slide-right-in"),"function"==typeof t&&t()},400)):(e.classList.add("slide-right-out"),setTimeout(function(){e.classList.remove("slide-right-out"),"function"==typeof t&&t()},400))},o.slideTop=function(e,o,t){1==o?(e.classList.add("slide-top-in"),setTimeout(function(){e.classList.remove("slide-top-in"),"function"==typeof t&&t()},400)):(e.classList.add("slide-top-out"),setTimeout(function(){e.classList.remove("slide-top-out"),"function"==typeof t&&t()},400))},o.slideBottom=function(e,o,t){1==o?(e.classList.add("slide-bottom-in"),setTimeout(function(){e.classList.remove("slide-bottom-in"),"function"==typeof t&&t()},400)):(e.classList.add("slide-bottom-out"),setTimeout(function(){e.classList.remove("slide-bottom-out"),"function"==typeof t&&t()},100))},o.fadeIn=function(e,o){e.classList.add("fade-in"),setTimeout(function(){e.classList.remove("fade-in"),"function"==typeof o&&o()},2e3)},o.fadeOut=function(e,o){e.classList.add("fade-out"),setTimeout(function(){e.classList.remove("fade-out"),"function"==typeof o&&o()},1e3)},o.keyDownControls=function(e){if(27==e.which){var o;if((o=document.querySelectorAll(".jmodal")).length>0)for(var t=0;t<o.length;t++)o[t].modal.close();if((o=document.querySelectorAll(".jslider")).length>0)for(t=0;t<o.length;t++)o[t].slider.close();document.querySelector(".jdialog")&&jSuites.dialog.close()}else 13==e.which&&document.querySelector(".jdialog")&&("function"==typeof jSuites.dialog.options.onconfirm&&jSuites.dialog.options.onconfirm(),jSuites.dialog.close());jSuites.mask&&jSuites.mask.apply(e)},o.actionUpControl=function(e){var o=null;if(o=jSuites.getLinkElement(e.target)){var t=o.getAttribute("data-href");"#back"==t?window.history.back():"#panel"==t?jSuites.panel():jSuites.pages(t)}};return document.addEventListener("swipeleft",function(e){var o;(o=jSuites.getElement(e.target,"option"))&&o.querySelector(".option-actions")?o.scrollTo({left:100,behavior:"smooth"}):(o=jSuites.getElement(e.target,"jcalendar"))&&jSuites.calendar.current?jSuites.calendar.current.prev():(o=jSuites.panel.get())&&"none"!=o.style.display&&jSuites.panel.close()}),document.addEventListener("swiperight",function(e){var o;(o=jSuites.getElement(e.target,"option"))&&o.querySelector(".option-actions")?o.scrollTo({left:0,behavior:"smooth"}):(o=jSuites.getElement(e.target,"jcalendar"))&&jSuites.calendar.current?jSuites.calendar.current.next():(o=jSuites.panel.get())&&"none"==o.style.display&&jSuites.panel()}),document.addEventListener("keydown",o.keyDownControls),"ontouchend"in document.documentElement==!0?document.addEventListener("touchend",o.actionUpControl):document.addEventListener("mouseup",o.actionUpControl),window.onpopstate=function(e){e.state&&e.state.route&&jSuites.pages.get(e.state.route)&&jSuites.pages(e.state.route,{ignoreHistory:!0})},o}();jSuites.files=[],jSuites.contextmenu=function(e,o){var t={options:{}},r={items:null};for(var n in r)o&&o.hasOwnProperty(n)?t.options[n]=o[n]:t.options[n]=r[n];return t.menu=document.createElement("ul"),t.menu.classList.add("jcontextmenu"),t.menu.setAttribute("tabindex","900"),t.open=function(e,o){o&&(t.options.items=o),t.menu.innerHTML="";for(var r=0;r<t.options.items.length;r++){if(t.options.items[r].type&&"line"==t.options.items[r].type)var n=document.createElement("hr");else{n=document.createElement("li");var l=document.createElement("a");if(l.innerHTML=t.options.items[r].title,t.options.items[r].disabled?n.className="jcontextmenu-disabled":t.options.items[r].onclick&&(n.onmouseup=t.options.items[r].onclick),n.appendChild(l),t.options.items[r].shortcut){var s=document.createElement("span");s.innerHTML=t.options.items[r].shortcut,n.appendChild(s)}}t.menu.appendChild(n)}if(e.target)var i=e.clientX,a=e.clientY;else i=e.x,a=e.y;t.menu.classList.add("jcontextmenu-focus"),t.menu.focus();const u=t.menu.getBoundingClientRect();window.innerHeight<a+u.height?t.menu.style.top=a-u.height+"px":t.menu.style.top=a+"px",window.innerWidth<i+u.width?t.menu.style.left=i-u.width+"px":t.menu.style.left=i+"px"},t.close=function(){t.menu.classList.remove("jcontextmenu-focus")},e.addEventListener("click",function(e){t.close()}),t.menu.addEventListener("blur",function(e){t.close()}),window.addEventListener("mousewheel",function(){t.close()}),e.appendChild(t.menu),e.contextmenu=t,t};