var figurecontainer=document.getElementById("figurecontainer"),data=[],cols=[0,1,2],ldata=[],lIniData=[],ranges=[],swapped=!1,newCol=[0,0,0],curCol=!1;const{ipcRenderer:ipcRenderer}=require("electron"),Plotly=require("plotly.js-gl3d-dist");function transpose(e){return e[0].map((a,t)=>e.map(e=>e[t]))}function mark_clicked(e){e.checked?Plotly.restyle(figurecontainer,{mode:"markers+lines"}):Plotly.restyle(figurecontainer,{mode:"lines"})}function getRange(e,a,t){var o,i;if(e=e.split(",").map(e=>parseFloat(e)),a)[o,i]=a;else{var n=data[t].flat();i=Math.max(...n),o=Math.min(...n)}return isNaN(e[0])&&(e[0]=o),isNaN(e[1])&&(e[1]=i),cmin=Math.max(e[0],o),cmax=Math.min(e[1],i),[e,[cmin,cmax]]}function setXRange(e,a=!1){""!=e?([e,_]=getRange(e,a,cols[0]),Plotly.relayout(figurecontainer,{"scene.xaxis.range":e})):Plotly.relayout(figurecontainer,{"scene.xaxis.autorange":!0})}function setYRange(e,a=!1){""!=e?([e,_]=getRange(e,a,cols[1]),Plotly.relayout(figurecontainer,{"scene.yaxis.range":e})):Plotly.relayout(figurecontainer,{"scene.yaxis.autorange":!0})}function setZRange(e,a=!1){""!=e?([e,[cmin,cmax]]=getRange(e,a,cols[2]),Plotly.relayout(figurecontainer,{"scene.zaxis.range":e}),Plotly.restyle(figurecontainer,{cmin:cmin,cmax:cmax})):Plotly.relayout(figurecontainer,{"scene.zaxis.autorange":!0})}function makeRotation(){var e=!0,a=data[0][0].length;for(let t of data[0])if(t.length!=a){e=!1;break}if(e)return xxx=transpose(data[0]),yyy=transpose(data[1]),void(zzz=transpose(data[2]));var t=[].concat(...data[0]).filter(e=>void 0!==e),o=[].concat(...data[1]).filter(e=>void 0!==e),i=[].concat(...data[2]).filter(e=>void 0!==e),n=[...new Set(o)].sort((e,a)=>e-a);xxx=[],yyy=[],zzz=[];for(let e of n){var s=[],r=[],l=[];for(let a=0;a<t.length;a++)o[a]==e&&(s.push(t[a]),r.push(o[a]),l.push(i[a]));xxx.push(s),yyy.push(r),zzz.push(l)}}function initData(e){for(var a=[],t=0;t<e;t++)a.push({type:"scatter3d",mode:"lines",x:[1,2],y:[1,2],z:[1,2],marker:{size:1.7,color:"#1f77b4"},line:{color:"#ff7f0e"},hoverinfo:"x+y+z",hoverlabel:{bgcolor:"#2ca02c"}});return a}ipcRenderer.on("sdata",function(e,a){[data,swapped,newCol]=a,updatePlot(),curCol||(curCol=newCol),newCol[0]!==curCol[0]?(curCol[0]=newCol[0],setXRange($("#xInp").val())):newCol[1]!==curCol[1]?(curCol[1]=newCol[1],setYRange($("#yInp").val())):newCol[2]!==curCol[2]&&(curCol[2]=newCol[2],setZRange($("#zInp").val()))});var sIniData=[{type:"surface",hoverinfo:"x+y+z",colorscale:"Portland",showscale:!1,hoverlabel:{bgcolor:"#2ca02c"},z:[[1]],x:[[1]],y:[[1]]}],layout={height:window.innerHeight+68,width:window.innerWidth-17,margin:{t:0,r:50,b:0,l:25,pad:0},showlegend:!1,scene:{aspectmode:"cube",zaxis:{autorange:!0,spikesides:!1},yaxis:{spikesides:!1},xaxis:{spikesides:!1}}};Plotly.addTraces(figurecontainer,[{type:"surface",hoverinfo:"x+y+z",colorscale:"Viridis",showscale:!1,hoverlabel:{bgcolor:"#2ca02c"},z:[[1]],x:[[1]],y:[[1]]}]),Plotly.restyle(figurecontainer,{x:[data[0]],y:[data[1]],z:[data[6]]},1),Plotly.relayout(figurecontainer,{scene:{aspectmode:"manual",aspectratio:{x:1,y:.8,z:.5},zaxis:{showgrid:!1,zeroline:!1,showline:!0,title:"u (a.u.)",titlefont:{family:"Times New Roman",size:40},tickfont:{family:"Times New Roman",size:20},ticks:"outside"},yaxis:{showgrid:!1,zeroline:!1,showline:!0,automargin:!0,title:"R (a.u.)",titlefont:{family:"Times New Roman",size:40},dtick:1,tickfont:{family:"Times New Roman",size:20},ticks:"outside",tickprefix:"   "},xaxis:{showgrid:!1,zeroline:!1,showline:!0,title:"r (a.u.)",titlefont:{family:"Times New Roman",size:40},dtick:1,tickfont:{family:"Times New Roman",size:20},ticks:"outside"}}});var mode={modeBarButtonsToRemove:["toImage"],modeBarButtonsToAdd:[[{name:"test",icon:Plotly.Icons.camera,click:function(){alert("dhqwduh2qu")}}]]};Plotly.restyle(figurecontainer,{showscale:!1,contours:{x:{show:!1,start:1,end:10,size:.5,color:"#3a3a3a",width:1},y:{show:!1,start:0,end:10,size:.5,color:"#3a3a3a",width:1}}});var trace={type:"surface",hoverinfo:"x+y+z",colorscale:"Portland",hoverlabel:{bgcolor:"#2ca02c"},z:[[1]],x:[[1]],y:[[1]],showscale:!1,cmin:cmin,cmax:cmax,cauto:!1,colorbar:{thickness:30,dtick:5,tickfont:{family:"Times New Roman",size:20}},contours:{x:{show:!0,start:1,end:10,size:.5,color:"#000",usecolormap:!1,width:1},y:{show:!0,start:0,end:10,size:.5,color:"#000",usecolormap:!1,width:1},z:{show:!1,start:0,end:10,size:.5,color:"#000",usecolormap:!1,width:1}}},newLayout={height:window.innerHeight+68,width:window.innerWidth-17,margin:{t:0,r:50,b:0,l:25,pad:0},autorange:!0,spikesides:!1,showlegend:!1,scene:{aspectmode:"manual",aspectratio:{x:1,y:.8,z:.5},zaxis:{range:[],autorange:!0,spikesides:!1,showgrid:!1,zeroline:!1,showline:!0,title:"u (a.u.)",titlefont:{family:"Times New Roman",size:40},dtick:5,tickfont:{family:"Times New Roman",size:20},tickformat:"",ticks:"outside"},yaxis:{range:[],autorange:!0,spikesides:!1,showgrid:!1,zeroline:!1,showline:!0,automargin:!0,title:"R (a.u.)",titlefont:{family:"Times New Roman",size:40},dtick:2,tickfont:{family:"Times New Roman",size:20},ticks:"outside",tickformat:""},xaxis:{range:[],autorange:!0,spikesides:!1,showgrid:!1,zeroline:!1,showline:!0,title:"r (a.u.)",titlefont:{family:"Times New Roman",size:40},dtick:2,tickfont:{family:"Times New Roman",size:20},ticks:"outside",tickformat:""}}};