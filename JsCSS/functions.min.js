const fs=require("fs"),path=require("path"),req=require("request"),url=require("url"),{remote:remote,ipcRenderer:ipcRenderer,shell:shell}=require("electron"),{dialog:dialog,BrowserWindow:BrowserWindow,Menu:Menu,MenuItem:MenuItem,app:app}=remote;var undoStack=[],redoStack=[],editorWindow,viewer=[,,],recentLocation="",recentFiles=[],show=!1,saved=!0,compFName,home=process.env.HOME||process.env.USERPROFILE,oldX,oldCord,innd;function isDev(){const isEnvSet="ELECTRON_IS_DEV"in process.env,getFromEnv=1===parseInt(process.env.ELECTRON_IS_DEV,10);return isEnvSet?getFromEnv:!app.isPackaged}function versionCheck(){var today,today;(today=(today=new Date).getDate()+""+today.getMonth())!=JSON.parse(localStorage.getItem("today"))&&(localStorage.setItem("today",JSON.stringify(today)),req({url:"https://api.github.com/repos/Koushikphy/Interactive-Data-Editor/tags",headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1521.3 Safari/537.36});"}},function(err,resp,body){var new_ver=JSON.parse(body)[0].name;if(console.log(new_ver),"v2.1.0"!=new_ver){var txt=`A new version of the software ${new_ver} is available.\n Do you wnat to downlod it now?`,res;dialog.showMessageBox({type:"question",title:"Update available!!!",message:txt,buttons:["OK","Cancel"]})||shell.openExternal("https://github.com/Koushikphy/Interactive-Data-Editor/releases")}}))}function showStatus(msg){$("#status").html(msg),$("#status").delay("medium").fadeIn(),$("#status").delay(3e3).fadeOut()}function recentMenu(){var rrf=menu.getMenuItemById("rf").submenu;rrf.clear();for(let i=recentFiles.length-1;i>=0;i--){var fln,item={label:replaceWithHome(recentFiles[i].slice()),click(){ipcRenderer.send("rf",recentFiles[i])}};rrf.append(new MenuItem(item))}localStorage.setItem("files",JSON.stringify(recentFiles))}function updateData(){if(col.x=xCol.selectedIndex,col.y=yCol.selectedIndex,col.z=zCol.selectedIndex,th_in=0,ddd?($slider.slider({max:data.length-1,value:0}),$ch.text(xName+"="+data[0][col.x][0])):(col.z=col.y,col.y=col.x,col.x=0),updatePlot(1),startDragBehavior(),updateOnServer(),!swapped)if(ddd)localStorage.setItem("cols3d",JSON.stringify(col));else{var tmp={x:col.y,y:col.z,z:0,s:0};localStorage.setItem("cols2d",JSON.stringify(tmp))}var tmpl=[];for(let i of data)tmpl.push(i[col.x][0].toString().length);$ch.width(Math.floor(Math.max(...tmpl)/2+2)*em2px)}function thisJobs(){if($("#particle").remove(),$("#full").show(),xCol=document.getElementById("xCol"),yCol=document.getElementById("yCol"),ddd){var fl;$(".3D").show(),null!==(fl=JSON.parse(localStorage.getItem("cols3d")))&&(col=fl);var mn=["pax","wire","surf"];for(let i of mn)menu.getMenuItemById(i).enabled=!0}else{var fl;serve=0,$(".3D").hide(),null!==(fl=JSON.parse(localStorage.getItem("cols2d")))&&(col=fl);var mn=["pax","wire","surf"];for(let i of mn)menu.getMenuItemById(i).enabled=!1}for(var op="",i=1;i<=data[0].length;i++)op+="<option>"+i+"</option>";for(var tmp=$("#xCol, #yCol, #zCol, #sCol"),i=0;i<tmp.length;i++)tmp[i].innerHTML=op;resizePlot(),xCol.selectedIndex=col.x,yCol.selectedIndex=col.y,zCol.selectedIndex=col.z,sCol.selectedIndex=col.s,updateData()}function fileLoader(){const fname=dialog.showOpenDialog({defaultPath:recentLocation,properties:["openFile"]})[0];fileReader(fname)}function replaceWithHome(name){return name.includes(home)?name.replace(home,"~"):name}function fileReader(fname){swapped=0,refdat=0,xName="X";var dirname=path.dirname(fname),filename=path.basename(fname,path.extname(fname)),extn=path.extname(fname);save_name=path.join(dirname,filename+"_new"+extn),recentLocation=dirname,localStorage.setItem("recent",JSON.stringify(recentLocation)),data=fs.readFileSync(fname,"utf8"),data=parseData(data),ddd=1!=data.length,thisJobs(),showStatus("Data loaded ..."),document.title="Interactive Data Editor - "+replaceWithHome(fname),(recentFiles=recentFiles.filter(x=>x!=fname)).push(fname),recentFiles.length>10&&recentFiles.splice(0,1),recentMenu(),menu.getMenuItemById("pax").checked=!1,menu.getMenuItemById("pay").checked=!0,menu.getMenuItemById("compf").visible=!1,menu.getMenuItemById("swapen").visible=!0,menu.getMenuItemById("swapex").visible=!1,$("#sCol, #sColInp").hide(),swapper=!1,2==figurecontainer.data.length&&Plotly.deleteTraces(figurecontainer,1),Plotly.relayout(figurecontainer,{selectdirection:"any"});var mn=["save","saveas","cs","ma","cg","un","spr","openc","pamh","swapen","edat","fill","filter"];ddd&&mn.push("pax","wire","surf");for(let i of mn)menu.getMenuItemById(i).enabled=!0}function compfileLoader(){refdat=1;const fname=dialog.showOpenDialog({defaultPath:recentLocation,properties:["openFile"]})[0];compdata=fs.readFileSync(fname,"utf8"),compdata=parseData(compdata),swapped&&(compdata=expRotate(compdata)),showStatus((compFName=replaceWithHome(fname))+" loaded for comparison."),updatePlot(1),menu.getMenuItemById("compf").visible=!0}function transpose(m){return m[0].map((_,i)=>m.map(x=>x[i]))}function parseData(strDps){var newdat=[],blocks=[];strDps=strDps.trim().split(/\t\t\t|\n\n/);for(let i of strDps){blocks=i.trim().split("\n");for(var j=0;j<blocks.length;j++)blocks[j]=blocks[j].trim().split(/[\s\t]+/),blocks[j]=blocks[j].map(x=>parseFloat(x));newdat.push(transpose(blocks))}return newdat}function expRotate(tmpData){var issame=!0,b=(tmpData=tmpData.map(x=>transpose(x)))[0].length;for(let a of tmpData)if(a.length!=b){issame=!1;break}if(issame)return tmpData=(tmpData=transpose(tmpData)).map(x=>transpose(x));tmpData=[].concat(...tmpData).filter(x=>void 0!==x);var tmp=new Set;for(let a of tmpData)tmp.add(a[col.x]);tmp=[...tmp].sort((a,b)=>a-b);var newdat=[];for(let x of tmp){var tmpdat=[];for(let line of tmpData)x==line[col.x]&&tmpdat.push(line);tmpdat=tmpdat.sort((m,n)=>m[col.y]-n[col.y]),newdat.push(transpose(tmpdat))}return newdat}function rotateData(){data.length&&(data=expRotate(data),compdata.length&&(compdata=expRotate(compdata)))}function saveAs(){data.length?(save_name=dialog.showSaveDialog({title:"Save As:",defaultPath:save_name}),saveData()):alert("Nothing to save!")}function saveData(){if(data.length){var tmpData=data.map(x=>transpose(x));swapped&&(tmpData=transpose(tmpData));var txt="";for(let i of tmpData){for(let j of i)txt+=j.map(n=>parseFloat(n).toFixed(8)).join("\t")+"\n";txt+="\n"}fs.writeFileSync(save_name,txt),showStatus("Data Saved as "+replaceWithHome(save_name)),saved=!0}else alert("Nothing to save!")}function hotDKeys(e){"text"!=document.activeElement.type&&"m"==e.key&&updateOnServer()}function hotKeys(e){if("text"!=document.activeElement.type)switch(e.key){case" ":Plotly.relayout(figurecontainer,{"xaxis.autorange":!0,"yaxis.autorange":!0});break;case",":if(0==th_in)break;th_in-=1,sliderChanged();break;case".":if(th_in==data.length-1)break;th_in+=1,sliderChanged();break;case"s":e.ctrlKey||Plotly.relayout(figurecontainer,{dragmode:"select"});break;case"z":e.ctrlKey?unDo():Plotly.relayout(figurecontainer,{dragmode:"zoom"});break;case"Z":e.ctrlKey&&reDo();break;case"p":swapData()}}function editor(){(editorWindow=new BrowserWindow({minWidth:1200,show:!1,webPreferences:{nodeIntegration:!0}})).maximize(),editorWindow.loadURL(url.format({pathname:path.join(__dirname,"handtable.html"),protocol:"file:",slashes:!0})),editorWindow.setMenuBarVisibility(!1),editorWindow.show(),isDev()&&editorWindow.webContents.openDevTools(),editorWindow.webContents.once("dom-ready",function(){editorWindow.webContents.send("slider",[xName,col.x,data])})}function openViewer(x){serve=1;var target="3D_Viewer_Lines.html";x&&(target="3D_Viewer_Surface.html"),viewerWindow=new BrowserWindow({show:!1,minWidth:1200,webPreferences:{nodeIntegration:!0}}),viewerWindow.maximize(),setTimeout(function(){viewerWindow.loadURL(url.format({pathname:path.join(__dirname,target),protocol:"file:",slashes:!0}))},50),viewerWindow.on("closed",function(){delete viewer[target]}),viewerWindow.show(),viewerWindow.setMenuBarVisibility(!1),viewer[target]=viewerWindow,isDev()&&viewerWindow.webContents.openDevTools(),viewerWindow.webContents.once("dom-ready",function(){updateOnServer()})}function incRefData(){var mark;menu.getMenuItemById("compf").checked?(refdat=1,updatePlot(1),showStatus(compFName+" shown for comparison.")):(refdat=0,Plotly.deleteTraces(figurecontainer,1))}function isswap(){swapped=!swapped;var[n1,n2]=["Y","X"];swapped&&([n1,n2]=[n2,n1]),xName=n2,[xCol,yCol]=[yCol,xCol],[col.x,col.y]=[col.y,col.x],rotateData(),updateData(),th_in=0,$slider.slider("value",0),$ch.text(xName+"="+data[th_in][col.x][0]),$("#drag").html((_,html)=>html.replace(n1,n2))}function sliderChanged(){$slider.slider("value",th_in),$ch.text(xName+"="+data[th_in][col.x][0]),updatePlot(1),startDragBehavior()}function colsChanged(value){col.s=value,updatePlot()}function colChanged(value){col.z=value,updatePlot(1),updateOnServer(),startDragBehavior(),swapped||localStorage.setItem("cols3d",JSON.stringify(col))}function resizePlot(){var height=window.innerHeight-document.getElementById("header").offsetTop-document.getElementById("figurecontainer").offsetTop;$("#figurecontainer").height(height-2),Plotly.relayout(figurecontainer,{autosize:!0})}function sSwapper(){[col.s,col.z]=[col.z,col.s],sCol.selectedIndex=col.s,zCol.selectedIndex=col.z,updatePlot()}function initSwapper(){$("#sCol, #sColInp").show(),refdat=0,swapper=!0,2==figurecontainer.data.length&&Plotly.deleteTraces(figurecontainer,1),Plotly.addTraces(figurecontainer,iniPointsC),col.s=sCol.selectedIndex,Plotly.relayout(figurecontainer,{selectdirection:"h"}),updatePlot(),menu.getMenuItemById("swapen").visible=!1,menu.getMenuItemById("swapex").visible=!0}function delSwapper(){$("#sCol, #sColInp").hide(),swapper=!1,2==figurecontainer.data.length&&Plotly.deleteTraces(figurecontainer,1),Plotly.relayout(figurecontainer,{selectdirection:"any"}),updatePlot(),menu.getMenuItemById("swapen").visible=!0,menu.getMenuItemById("swapex").visible=!1}function swapData(){if(index.length){saveOldData();for(let ind of index)[data[th_in][col.z][ind],data[th_in][col.s][ind]]=[data[th_in][col.s][ind],data[th_in][col.z][ind]];updatePlot()}}function repeatMirror(){var last=parseFloat($("#einp").val()),times=parseFloat($("#etime").val()),mirror=$("#repSel")[0].selectedIndex,cols_wo_y=[],tmp=data[0].length,tmp;for(let i=0;i<tmp;i++)i!=col.y&&cols_wo_y.push(i);data=data.map(dat=>{var ind=dat[col.y].indexOf(last)+1;ind||alert("Endpoint must exist !!!");var newy=dat[col.y].slice(0,ind),tmp;(tmp=newy.slice()).splice(0,1);for(let time=0;time<times-1;time++)for(let i=0;i<tmp.length;i++)newy.push(tmp[i]+last*(1+time));for(let i of cols_wo_y){var new_dat=dat[i].slice(0,ind),tmp=new_dat.slice();for(let time=0;time<times-1;time++)ptmp=mirror?tmp.reverse().slice():tmp.slice(),ptmp.splice(0,1),new_dat.push(...ptmp);dat[i]=new_dat}return dat[col.y]=newy,dat}),$("#extend").slideUp(),updatePlot(),showStatus(`Data ${tmp=mirror?"mirrored":"repeated"} ${times} times...`),startDragBehavior(),updateOnServer(),saved=!1}function dataFiller(){var start=parseFloat($("#fstart").val()),stop=parseFloat($("#fend").val()),step=parseFloat($("#fstep").val()),cols_wo_y=[],tmp=data[0].length;for(let i=0;i<tmp;i++)i!=col.y&&cols_wo_y.push(i);var fullArr=[];for(let i=start;i<=stop;i+=step)fullArr.push(i);data=data.map(dat=>{if(fullArr.length==dat[0].length)return dat;var xs=dat[col.y].slice(),lInd=dat[col.y].length-1;for(let tc of cols_wo_y){newArr=[];var ys=dat[tc].slice();function spline(x){for(var i=1;xs[i]<x;)i++;var t=(x-xs[i-1])/(xs[i]-xs[i-1]),a=ks[i-1]*(xs[i]-xs[i-1])-(ys[i]-ys[i-1]),b=-ks[i]*(xs[i]-xs[i-1])+(ys[i]-ys[i-1]),q;return(1-t)*ys[i-1]+t*ys[i]+t*(1-t)*(a*(1-t)+b*t)}ks=getNaturalKs(xs,ys);for(let val of fullArr)ind=dat[col.y].indexOf(val),-1!=ind?newArr.push(dat[tc][ind]):val<=dat[col.y][0]?newArr.push(dat[tc][0]):val>=dat[col.y][lInd]?newArr.push(dat[tc][lInd]):newArr.push(spline(val));dat[tc]=newArr}return dat[col.y]=fullArr,dat}),$("#filler").slideUp(),updatePlot(),showStatus("Missing values are filled..."),startDragBehavior(),updateOnServer(),saved=!1}function filterData(){var condition=$("#flSel")[0].selectedIndex,thrsh=parseFloat($("#flc").val()),fillVal=parseFloat($("#flf").val()),colmn=$("#flcl").val().split(",").map(x=>parseFloat(x)-1);0==condition?data=data.map(dat=>{for(let tc of colmn)dat[tc]=dat[tc].map(x=>x<thrsh?fillVal:x);return dat}):1==condition?data=data.map(dat=>{for(let tc of colmn)dat[tc]=dat[tc].map(x=>x>thrsh?fillVal:x);return dat}):2==condition&&(data=data.map(dat=>{for(let tc of colmn)dat[tc]=dat[tc].map(x=>x==thrsh?fillVal:x);return dat})),$("#filter").slideUp(),updatePlot(),showStatus("Data filtered..."),startDragBehavior(),updateOnServer(),saved=!1}function getNaturalKs(xs,ys){for(var ks=new Array(xs.length).fill(0),n=xs.length-1,A=[],i=0;i<n+1;i++)A.push(new Array(n+2).fill(0));for(var i=1;i<n;i++)A[i][i-1]=1/(xs[i]-xs[i-1]),A[i][i]=2*(1/(xs[i]-xs[i-1])+1/(xs[i+1]-xs[i])),A[i][i+1]=1/(xs[i+1]-xs[i]),A[i][n+1]=3*((ys[i]-ys[i-1])/((xs[i]-xs[i-1])*(xs[i]-xs[i-1]))+(ys[i+1]-ys[i])/((xs[i+1]-xs[i])*(xs[i+1]-xs[i])));return A[0][0]=2/(xs[1]-xs[0]),A[0][1]=1/(xs[1]-xs[0]),A[0][n+1]=3*(ys[1]-ys[0])/((xs[1]-xs[0])*(xs[1]-xs[0])),A[n][n-1]=1/(xs[n]-xs[n-1]),A[n][n]=2/(xs[n]-xs[n-1]),A[n][n+1]=3*(ys[n]-ys[n-1])/((xs[n]-xs[n-1])*(xs[n]-xs[n-1])),solve(A,ks)}function solve(A,ks){for(var m=A.length,k=0;k<m;k++){for(var i_max=0,vali=Number.NEGATIVE_INFINITY,i=k;i<m;i++)A[i][k]>vali&&(i_max=i,vali=A[i][k]);var p=A[k];A[k]=A[i_max],A[i_max]=p;for(var i=k+1;i<m;i++)for(var j=k+1;j<m+1;j++)A[i][j]=A[i][j]-A[k][j]*(A[i][k]/A[k][k]),A[i][k]=0}for(var i=m-1;i>=0;i--){var v=A[i][m]/A[i][i];ks[i]=v;for(var j=i-1;j>=0;j--)A[j][m]-=A[j][i]*v,A[j][i]=0}return ks}function deleteInterpolate(){if(index.length){var xs=dpsx.slice(),ys=dpsy.slice();0==index[0]&&index.splice(0,1),index[index.length-1]==dpsx.length-1&&index.splice(-1,1);for(var i=index.length-1;i>=0;i--)xs.splice(index[i],1),ys.splice(index[i],1);ks=getNaturalKs(xs,ys),saveOldData();for(let ind of index)data[th_in][col.z][ind]=spline(data[th_in][col.y][ind]);updatePlot(),updateOnServer(),index=[],Plotly.restyle(figurecontainer,{selectedpoints:[null]}),saved=!1}function spline(x){for(var i=1;xs[i]<x;)i++;var t=(x-xs[i-1])/(xs[i]-xs[i-1]),a=ks[i-1]*(xs[i]-xs[i-1])-(ys[i]-ys[i-1]),b=-ks[i]*(xs[i]-xs[i-1])+(ys[i]-ys[i-1]),q;return(1-t)*ys[i-1]+t*ys[i]+t*(1-t)*(a*(1-t)+b*t)}}function autoSmooth(){if(ma&&(saveOldData(),ma=0),index.length){0==index[0]&&index.splice(0,1),index[index.length-1]==dpsx.length-1&&index.splice(-1,1);for(let i of index)dpsy[i]=(dpsy[i-1]+dpsy[i]+dpsy[i+1])/3;data[th_in][col.z]=dpsy,updatePlot(),saved=!1}}function changeSign(){if(index.length){saveOldData();for(let ind of index)data[th_in][col.z][ind]*=-1;updatePlot(),updateOnServer(),index=[],Plotly.restyle(figurecontainer,{selectedpoints:[null]}),saved=!1}}function selectEvent(event){if(index=[],del_dat=[],null==event)Plotly.restyle(figurecontainer,{selectedpoints:[null]}),ma=1;else{for(let pt of event.points)ind=dpsx.findIndex(n=>n==pt.x),dpsy[ind]==pt.y&&index.push(ind);index=[...new Set(index)]}}function updateFigure(){var y=[],x=[];if(lockXc){for(let i of points)y.push(i.handle.y);Plotly.restyle(figurecontainer,{y:[y]},0),dpsy=data[th_in][col.z]=y}else{for(let i of points)x.push(i.handle.x),y.push(i.handle.y);Plotly.restyle(figurecontainer,{x:[x],y:[y]},0),dpsy=data[th_in][col.z]=y,dpsx=data[th_in][col.y]=x}}function clamp(x,lower,upper){return Math.max(lower,Math.min(x,upper))}function startDragBehavior(){var d3=Plotly.d3,drag=d3.behavior.drag();drag.origin(function(){saveOldData();var transform=d3.select(this).attr("transform"),translate=transform.substring(10,transform.length-1).split(/,| /);return index.length&&(swapper?[_,_,_,oldX,oldCord,_]=JSON.parse(olddata):[_,_,oldX,oldCord]=JSON.parse(olddata),indd=oldX.indexOf(this.handle.x)),{x:translate[0],y:translate[1]}}),drag.on("drag",function(){var xmouse=d3.event.x,ymouse=d3.event.y;d3.select(this).attr("transform","translate("+[xmouse,ymouse]+")");var handle=this.handle,yaxis=figurecontainer._fullLayout.yaxis;if(handle.y=clamp(yaxis.p2l(ymouse),yaxis.range[0],yaxis.range[1]),index.length){var moved=handle.y-oldCord[indd];for(let ind of index)points[ind].handle.y=moved+oldCord[ind]}if(!lockXc){var xaxis=figurecontainer._fullLayout.xaxis;if(handle.x=clamp(xaxis.p2l(xmouse),xaxis.range[0],xaxis.range[1]),index.length){var moved=handle.x-oldX[indd];for(let ind of index)points[ind].handle.x=moved+oldX[ind]}}updateFigure()}),drag.on("dragend",function(){updateFigure(),updateOnServer(),saved=!1,d3.select(".scatterlayer .trace:first-of-type .points path:first-of-type").call(drag)}),d3.selectAll(".scatterlayer .trace:first-of-type .points path").call(drag)}function saveOldData(){data.length&&(redoStack=[],olddata=JSON.stringify([th_in,col,data[th_in]]),5==undoStack.length&&undoStack.splice(0,1),undoStack.push(olddata))}function reDo(){redoStack.length&&(olddata=redoStack.pop(),undoStack.push(JSON.stringify([th_in,col,data[th_in]])),doIt())}function unDo(){ma||(ma=1),undoStack.length&&(olddata=undoStack.pop(),redoStack.push(JSON.stringify([th_in,col,data[th_in]])),doIt())}function doIt(){var arr,tmp=th_in;[th_in,col,arr]=JSON.parse(olddata),zCol.selectedIndex=col.z,data[th_in]=arr,updatePlot(1),startDragBehavior(),updateOnServer(),saved=!1}function updateOnServer(){if(serve){var x_list=[],y_list=[],z_list=[];for(let i of data)x_list.push(i[col.x]),y_list.push(i[col.y]),z_list.push(i[col.z]);var s_data=[x_list,y_list,z_list];for(let w in viewer)viewer[w].webContents.send("sdata",s_data)}}function updatePlot(both=0){dpsy=data[th_in][col.z],dpsx=data[th_in][col.y],swapper?(dpsy2=data[th_in][col.s],Plotly.restyle(figurecontainer,{x:[dpsx,dpsx],y:[dpsy,dpsy2]})):both&&refdat&&compdata.length?(1==figurecontainer.data.length&&Plotly.addTraces(figurecontainer,iniPointsC),Plotly.restyle(figurecontainer,{x:[dpsx,compdata[th_in][col.y]],y:[dpsy,compdata[th_in][col.z]]})):Plotly.restyle(figurecontainer,{x:[dpsx],y:[dpsy]},0);for(var i=0;i<dpsx.length;i++)points[i].handle={x:dpsx[i],y:dpsy[i]}}ipcRenderer.on("rf",function(e,d){fileReader(d)}),ipcRenderer.on("back",function(e,d){data=d.map(x=>transpose(x)),updatePlot(1),startDragBehavior(),updateOnServer()}),ipcRenderer.on("checkClose",function(e,d){if(!saved)var res=dialog.showMessageBox({type:"warning",title:"Warning!!!",message:"There are some modified data, that you haven't saved yet.\n Are you sure to quit without saving?",buttons:["Yes","No"]});res||ipcRenderer.send("checkClose","closeIt")}),ipcRenderer.on("menuTrigger",function(e,d){switch(show&&console.log(e,d),d){case"open":fileLoader();break;case"save":saveData();break;case"saveas":saveAs();break;case"cs":deleteInterpolate();break;case"ma":autoSmooth();break;case"csign":changeSign();break;case"wire":openViewer(0);break;case"surface":openViewer(1);break;case"spread":editor();break;case"openc":compfileLoader();break;case"compf":incRefData();break;case"pa":isswap();break;case"pamh":lockXc=menu.getMenuItemById("pamh").checked?1:0;break;case"fullscreen":resizePlot();break;case"swapen":initSwapper();break;case"swapex":delSwapper();break;case"edat":$("#extend").slideDown();break;case"fill":$("#filler").slideDown();break;case"filter":$("#filter").slideDown()}});