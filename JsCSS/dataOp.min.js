var copyVar;function copyThis(){copyVar=JSON.stringify(data[th_in])}function pasteThis(){saveOldData();var e=JSON.parse(copyVar);for(let t=0;t<e.length;t++)t!=col.x&&(data[th_in][t]=e[t]);updatePlot(1),updateOnServer(),saved=!1,startDragBehavior()}function swapData(){if(index.length){saveOldData();for(let e of index)[data[th_in][col.z][e],data[th_in][col.s][e]]=[data[th_in][col.s][e],data[th_in][col.z][e]];updatePlot(),updateOnServer()}}function repeatMirror(){var e=parseFloat($("#einp").val()),t=parseFloat($("#etime").val()),a=$("#repSel")[0].selectedIndex,r=[],l=data[0].length;for(let e=0;e<l;e++)e!=col.y&&r.push(e);data=data.map(l=>{var n=l[col.y].indexOf(e)+1;if(!n)return alert("Endpoint must exist !!!"),l;var o=l[col.y].slice(0,n);(s=o.slice()).splice(0,1);for(let a=0;a<t-1;a++)for(let t=0;t<s.length;t++)o.push(s[t]+e*(1+a));for(let e of r){var i=l[e].slice(0,n),s=i.slice();for(let e=0;e<t-1;e++)ptmp=a?s.reverse().slice():s.slice(),ptmp.splice(0,1),i.push(...ptmp);l[e]=i}return l[col.y]=o,l}),$("#extend").slideUp(),updatePlot();l=a?"mirrored":"repeated";showStatus(`Data ${l} ${t} times...`),startDragBehavior(),updateOnServer(),saved=!1}function dataFiller(){var e=parseFloat($("#fstart").val()),t=parseFloat($("#fend").val()),a=parseFloat($("#fstep").val()),r=[],l=data[0].length;for(let e=0;e<l;e++)e!=col.y&&r.push(e);var n=[];for(let r=e;r<=t;r+=a)n.push(r);data=data.map(e=>{if(n.length==e[0].length)return e;var t=e[col.y].slice(),a=e[col.y].length-1;for(let i of r){newArr=[];var l=e[i].slice();function o(e){for(var a=1;t[a]<e;)a++;var r=(e-t[a-1])/(t[a]-t[a-1]),n=ks[a-1]*(t[a]-t[a-1])-(l[a]-l[a-1]),o=-ks[a]*(t[a]-t[a-1])+(l[a]-l[a-1]);return(1-r)*l[a-1]+r*l[a]+r*(1-r)*(n*(1-r)+o*r)}ks=getNaturalKs(t,l);for(let t of n)ind=e[col.y].indexOf(t),-1!=ind?newArr.push(e[i][ind]):t<=e[col.y][0]?newArr.push(e[i][0]):t>=e[col.y][a]?newArr.push(e[i][a]):newArr.push(o(t));e[i]=newArr}return e[col.y]=n,e}),$("#filler").slideUp(),updatePlot(),showStatus("Missing values are filled..."),startDragBehavior(),updateOnServer(),saved=!1}function filterData(){var e=$("#flSel")[0].selectedIndex,t=parseFloat($("#flc").val()),a=parseFloat($("#flf").val()),r=$("#flcl").val().split(",").map(e=>parseFloat(e)-1);0==e?data=data.map(e=>{for(let l of r)e[l]=e[l].map(e=>e<t?a:e);return e}):1==e?data=data.map(e=>{for(let l of r)e[l]=e[l].map(e=>e>t?a:e);return e}):2==e&&(data=data.map(e=>{for(let l of r)e[l]=e[l].map(e=>e==t?a:e);return e})),$("#filter").slideUp(),updatePlot(),showStatus("Data filtered..."),startDragBehavior(),updateOnServer(),saved=!1}function getNaturalKs(e,t){for(var a=new Array(e.length).fill(0),r=e.length-1,l=[],n=0;n<r+1;n++)l.push(new Array(r+2).fill(0));for(n=1;n<r;n++)l[n][n-1]=1/(e[n]-e[n-1]),l[n][n]=2*(1/(e[n]-e[n-1])+1/(e[n+1]-e[n])),l[n][n+1]=1/(e[n+1]-e[n]),l[n][r+1]=3*((t[n]-t[n-1])/((e[n]-e[n-1])*(e[n]-e[n-1]))+(t[n+1]-t[n])/((e[n+1]-e[n])*(e[n+1]-e[n])));return l[0][0]=2/(e[1]-e[0]),l[0][1]=1/(e[1]-e[0]),l[0][r+1]=3*(t[1]-t[0])/((e[1]-e[0])*(e[1]-e[0])),l[r][r-1]=1/(e[r]-e[r-1]),l[r][r]=2/(e[r]-e[r-1]),l[r][r+1]=3*(t[r]-t[r-1])/((e[r]-e[r-1])*(e[r]-e[r-1])),solve(l,a)}function solve(e,t){for(var a=e.length,r=0;r<a;r++){for(var l=0,n=Number.NEGATIVE_INFINITY,o=r;o<a;o++)e[o][r]>n&&(l=o,n=e[o][r]);var i=e[r];e[r]=e[l],e[l]=i;for(o=r+1;o<a;o++)for(var s=r+1;s<a+1;s++)e[o][s]=e[o][s]-e[r][s]*(e[o][r]/e[r][r]),e[o][r]=0}for(o=a-1;o>=0;o--){var d=e[o][a]/e[o][o];t[o]=d;for(s=o-1;s>=0;s--)e[s][a]-=e[s][o]*d,e[s][o]=0}return t}function deleteInterpolate(){if(index.length){var e=dpsx.slice(),t=dpsy.slice();0==index[0]&&index.splice(0,1),index[index.length-1]==dpsx.length-1&&index.splice(-1,1);for(var a=index.length-1;a>=0;a--)e.splice(index[a],1),t.splice(index[a],1);ks=getNaturalKs(e,t),saveOldData();for(let e of index)data[th_in][col.z][e]=r(data[th_in][col.y][e]);updatePlot(),updateOnServer(),index=[],Plotly.restyle(figurecontainer,{selectedpoints:[null]}),saved=!1}function r(a){for(var r=1;e[r]<a;)r++;var l=(a-e[r-1])/(e[r]-e[r-1]),n=ks[r-1]*(e[r]-e[r-1])-(t[r]-t[r-1]),o=-ks[r]*(e[r]-e[r-1])+(t[r]-t[r-1]);return(1-l)*t[r-1]+l*t[r]+l*(1-l)*(n*(1-l)+o*l)}}function autoSmooth(){if(ma&&(saveOldData(),ma=0),index.length){0==index[0]&&index.splice(0,1),index[index.length-1]==dpsx.length-1&&index.splice(-1,1);for(let e of index)dpsy[e]=(dpsy[e-1]+dpsy[e]+dpsy[e+1])/3;data[th_in][col.z]=dpsy,updatePlot(),saved=!1}}function changeSign(){if(index.length){saveOldData();for(let e of index)data[th_in][col.z][e]*=-1;updatePlot(),updateOnServer(),index=[],Plotly.restyle(figurecontainer,{selectedpoints:[null]}),saved=!1}}